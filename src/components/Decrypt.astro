---
type Props = {
  data?: string;
};

const { data } = Astro.props;
---

<div id="button-decrypt" data-data={data}>
  <slot />
</div>

<script>
  import { decrypt } from '../shared';

  async function decryptData(data: string, tip?: string) {
    try {
      // eslint-disable-next-line no-alert
      const password = prompt(tip || '请输入密码');
      if (!password) {
        return;
      }
      const result = await decrypt(data, password);
      return result;
    } catch (error) {
      return decryptData(data, '密码错误, 请重新输入密码');
    }
  }
  document.getElementById('button-decrypt')?.addEventListener('click', async function () {
    const result = await decryptData(`${this.dataset.data}`);
    if (result) {
      this.outerHTML = result;
    }
  });
  </script>

