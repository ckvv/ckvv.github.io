<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=Content-Language content="en"><meta name=theme-color content="#ffffff"><meta name=color-scheme content="light dark"><meta name=description content="sequence 号是数据库系统按照一定规则自增的数字序列 sequence 操作函数
Function Return Type Description currval(regclass) bigint Return value most recently obtained with nextval for specified sequence lastval() bigint Return value most recently obtained with nextval for any sequence nextval(regclass) bigint Advance sequence and return new value setval(regclass, bigint) bigint Set sequence's current value setval(regclass, bigint, boolean) bigint Set sequence's current value and is_called flag 创建 sequence postgre文档
sequence 操作函数定义
CREATE [ TEMPORARY | TEMP ] SEQUENCE [ IF NOT EXISTS ] name [ AS data_type ] [ INCREMENT [ BY ] increment ] [ MINVALUE minvalue | NO MINVALUE ] [ MAXVALUE maxvalue | NO MAXVALUE ] [ START [ WITH ] start ] [ CACHE cache ] [ [ NO ] CYCLE ] [ OWNED BY { table_name."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="postgresql中的sequence"><meta name=twitter:description content="sequence 号是数据库系统按照一定规则自增的数字序列 sequence 操作函数
Function Return Type Description currval(regclass) bigint Return value most recently obtained with nextval for specified sequence lastval() bigint Return value most recently obtained with nextval for any sequence nextval(regclass) bigint Advance sequence and return new value setval(regclass, bigint) bigint Set sequence's current value setval(regclass, bigint, boolean) bigint Set sequence's current value and is_called flag 创建 sequence postgre文档
sequence 操作函数定义
CREATE [ TEMPORARY | TEMP ] SEQUENCE [ IF NOT EXISTS ] name [ AS data_type ] [ INCREMENT [ BY ] increment ] [ MINVALUE minvalue | NO MINVALUE ] [ MAXVALUE maxvalue | NO MAXVALUE ] [ START [ WITH ] start ] [ CACHE cache ] [ [ NO ] CYCLE ] [ OWNED BY { table_name."><meta property="og:url" content="https://chenkai.life/database/pg-sequence/"><meta property="og:site_name" content="CK's Blog"><meta property="og:title" content="postgresql中的sequence"><meta property="og:description" content="sequence 号是数据库系统按照一定规则自增的数字序列 sequence 操作函数
Function Return Type Description currval(regclass) bigint Return value most recently obtained with nextval for specified sequence lastval() bigint Return value most recently obtained with nextval for any sequence nextval(regclass) bigint Advance sequence and return new value setval(regclass, bigint) bigint Set sequence's current value setval(regclass, bigint, boolean) bigint Set sequence's current value and is_called flag 创建 sequence postgre文档
sequence 操作函数定义
CREATE [ TEMPORARY | TEMP ] SEQUENCE [ IF NOT EXISTS ] name [ AS data_type ] [ INCREMENT [ BY ] increment ] [ MINVALUE minvalue | NO MINVALUE ] [ MAXVALUE maxvalue | NO MAXVALUE ] [ START [ WITH ] start ] [ CACHE cache ] [ [ NO ] CYCLE ] [ OWNED BY { table_name."><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="database"><meta property="article:published_time" content="2021-07-09T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-10T21:55:52+08:00"><meta property="article:tag" content="Database"><title>postgresql中的sequence · CK's Blog
</title><link rel=canonical href=https://chenkai.life/database/pg-sequence/><link rel=stylesheet href=/css/coder.min.0e0f0ac9929898ae6625ca3789e3f9e2e630ead0a5e0f1fe96c1ba7d8774342c.css integrity="sha256-Dg8KyZKYmK5mJco3ieP54uYw6tCl4PH+lsG6fYd0NCw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.d8f89ef09509afb63b9b2595ee174e53cc51ce02a6f6a2179e1621f9389e4340.css integrity="sha256-2Pie8JUJr7Y7myWV7hdOU8xRzgKm9qIXnhYh+TieQ0A=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/custom.min.d12542c00c198b6a07ca9ea5981102805aecab0f5dfd5e3273d8c179088712c4.css integrity="sha256-0SVCwAwZi2oHyp6lmBECgFrsqw9d/V4yc9jBeQiHEsQ=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/favicon.ico><link rel=apple-touch-icon type=image/png sizes=256x256 href=/images/favicon-512x512.png><meta name=generator content="Hugo 0.131.0"><link rel=manifest href=/manifest.webmanifest></head><body class="preload-transitions colorscheme-auto"><div class=float-container><span id=dark-mode-toggle class=colorscheme-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-anheimoshi"/></svg></span></div><details id=table-of-contents-wapper><summary><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></summary></details><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>CK's Blog
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/>Home</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/marks/>Marks</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/ckvv/ckvv.github.io/tree/main/content>Create</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item id=search-content><input class=search-int type=text placeholder=Search>
<button class=search-btn data-type=github>GitHub</button>
<button class=search-btn data-type=google>Google</button></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://chenkai.life/database/pg-sequence/>postgresql中的sequence</a></h1><div class=edit-link style=float:right;color:#0366d6><a class=title rel=noopener target=_blank href=https://github.com/ckvv/ckvv.github.io/edit/main/content/database/pg-sequence.md>编辑</a></div></header><div class=post-meta><div class=date><span class=posted-on><svg class="icon" aria-hidden="true"><use xlink:href="#icon-date"/></svg>
<time datetime=2021-07-09T00:00:00Z>2021-07-09</time></span></div><div class=tags><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"/></svg>
<span class=tag><a href=/tags/database/>Database</a></span></div></div><p>sequence 号是数据库系统按照一定规则自增的数字序列
sequence 操作函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>Function</span> <span style=color:#66d9ef>Return</span> <span style=color:#66d9ef>Type</span> Description
</span></span><span style=display:flex><span>currval(regclass) bigint <span style=color:#66d9ef>Return</span> value most recently obtained <span style=color:#66d9ef>with</span> nextval <span style=color:#66d9ef>for</span> specified sequence
</span></span><span style=display:flex><span>lastval() bigint <span style=color:#66d9ef>Return</span> value most recently obtained <span style=color:#66d9ef>with</span> nextval <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>any</span> sequence
</span></span><span style=display:flex><span>nextval(regclass) bigint Advance sequence <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> value
</span></span><span style=display:flex><span>setval(regclass, bigint) bigint <span style=color:#66d9ef>Set</span> sequence<span style=color:#e6db74>&#39;s current value
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setval(regclass, bigint, boolean) bigint Set sequence&#39;</span>s <span style=color:#66d9ef>current</span> value <span style=color:#66d9ef>and</span> is_called flag
</span></span></code></pre></div><h2 id=创建-sequence>创建 sequence
<a class=heading-link href=#%e5%88%9b%e5%bb%ba-sequence><i class="fa fa-link" aria-hidden=true></i></a></h2><p>postgre<a href=https://www.postgresql.org/docs/12/sql-createsequence.html>文档</a></p><p>sequence 操作函数定义</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> [ <span style=color:#66d9ef>TEMPORARY</span> <span style=color:#f92672>|</span> TEMP ] SEQUENCE [ <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> ] name
</span></span><span style=display:flex><span>    [ <span style=color:#66d9ef>AS</span> data_type ]
</span></span><span style=display:flex><span>    [ <span style=color:#66d9ef>INCREMENT</span> [ <span style=color:#66d9ef>BY</span> ] <span style=color:#66d9ef>increment</span> ]
</span></span><span style=display:flex><span>    [ <span style=color:#66d9ef>MINVALUE</span> <span style=color:#66d9ef>minvalue</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NO</span> <span style=color:#66d9ef>MINVALUE</span> ] [ <span style=color:#66d9ef>MAXVALUE</span> <span style=color:#66d9ef>maxvalue</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NO</span> <span style=color:#66d9ef>MAXVALUE</span> ]
</span></span><span style=display:flex><span>    [ <span style=color:#66d9ef>START</span> [ <span style=color:#66d9ef>WITH</span> ] <span style=color:#66d9ef>start</span> ] [ <span style=color:#66d9ef>CACHE</span> <span style=color:#66d9ef>cache</span> ] [ [ <span style=color:#66d9ef>NO</span> ] <span style=color:#66d9ef>CYCLE</span> ]
</span></span><span style=display:flex><span>    [ OWNED <span style=color:#66d9ef>BY</span> <span style=color:#960050;background-color:#1e0010>{</span> <span style=color:#66d9ef>table_name</span>.<span style=color:#66d9ef>column_name</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NONE</span> <span style=color:#960050;background-color:#1e0010>}</span> ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;!</span><span style=color:#75715e>-- 创建一个从101开始的增序列 --&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> SEQUENCE serial <span style=color:#66d9ef>START</span> <span style=color:#ae81ff>101</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;!</span><span style=color:#75715e>-- 选择下一个 --&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> nextval<span style=color:#960050;background-color:#1e0010>（</span><span style=color:#e6db74>&#39;serial&#39;</span><span style=color:#960050;background-color:#1e0010>）</span>;
</span></span></code></pre></div><h2 id=设置自增列>设置自增列
<a class=heading-link href=#%e8%ae%be%e7%bd%ae%e8%87%aa%e5%a2%9e%e5%88%97><i class="fa fa-link" aria-hidden=true></i></a></h2><p>sequence 是 postgre10 以前对自增列对实现方式，
数据库表添加一个自增类型我们可以设置类型添加为 bigserial，bigserial 是一个伪类型，我们直接用修改字段是不可以的，一般我们需要</p><ul><li>创建一个 sequence：<code>CREATE SEQUENCE ${sequenceName};</code></li><li>设置该字段的默认值为该 sequence 的下一个：<code>ALTER TABLE ${table} ALTER COLUMN ${field} SET DEFAULT nextval('${sequenceName}');</code></li><li>将该 sequence 与该表相关联，这样如果该表删除 sequence 也会被删除：<code>ALTER SEQUENCE ${sequenceName} OWNED BY ${table}.${field};</code></li><li>设置该 sequence 的起始值：<code>SELECT setval('${sequenceName}', COALESCE(max(${field}), 0)) FROM ${table};</code></li></ul><p>postgre10 后引入了 identity 标识符设置自增列,
create table 语法中，在列的类型后使用如下语法定义 identity 列。
ALWAYS，表示优先使用系统列生成的自增值,如果要覆盖系统产生的值，需要使用 OVERRIDING SYSTEM VALUE,否则会报错。
BY DEFAULT，表示优先使用用户输入的值，可以与自增值重复。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 创建一个含有IDENTITY的表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>public</span>.test
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    _id bigint <span style=color:#66d9ef>GENERATED</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>IDENTITY</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- To add an IDENTITY column to  table staff
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> staff <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>COLUMN</span> staff_id int <span style=color:#66d9ef>GENERATED</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>IDENTITY</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除test表中_id的IDENTITY
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> test <span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>COLUMN</span> _id <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>IDENTITY</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;!</span><span style=color:#75715e>-- 不能用删除默认值的方法删除IDENTITY --&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> test <span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>COLUMN</span> _id <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>DEFAULT</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改test表中_id的为IDENTITY
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> testta b le
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>COLUMN</span> _id <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>GENERATED</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>IDENTITY</span>;
</span></span></code></pre></div><div id=cusdis_thread data-host=https://cusdis.com data-app-id=c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd data-page-id=271f5f5f8435b18a692790961b4de94e data-page-url=https://chenkai.life/database/pg-sequence/ data-page-title=postgresql中的sequence data-iframe=/js/cusdis/iframe.umd.js data-style=/js/cusdis/style.css></div></article></section></div></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script><script src=/js/custom.js></script><script src=/js/font.min.js></script></body><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></html>