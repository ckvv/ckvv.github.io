<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=theme-color content="#ffffff"><meta name=color-scheme content="light dark"><meta name=description content="准备 demo 程序 index.js &#34;use strict&#34;; const express = require(&#34;express&#34;); // Constants const PORT = 6677; const HOST = &#34;0.0.0.0&#34;; // App const app = express(); app.get(&#34;/&#34;, (req, res) => { res.send(&#34;<h1>Hello world</h1>&#34;); }); app.listen(PORT, HOST); console.log(`Running on http://${HOST}:${PORT}`); 根目录新建Dockerfile文件 ## 定义我们需要从哪个镜像进行构建 FROM node:8 ## 在镜像中创建一个文件夹存放应用程序代码，这将是你的应用程序工作目录 WORKDIR /usr/src/app COPY package*.json ./ RUN npm install COPY . . EXPOSE 8080 CMD [ &#34;node&#34;, &#34;index.js&#34; ] .dockerignore 文件 这将避免你的本地模块以及调试日志被拷贝进入到你的 Docker 镜像中 node_modules npm-debug."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="node程序放入docker"><meta name=twitter:description content="准备 demo 程序 index.js &#34;use strict&#34;; const express = require(&#34;express&#34;); // Constants const PORT = 6677; const HOST = &#34;0.0.0.0&#34;; // App const app = express(); app.get(&#34;/&#34;, (req, res) => { res.send(&#34;<h1>Hello world</h1>&#34;); }); app.listen(PORT, HOST); console.log(`Running on http://${HOST}:${PORT}`); 根目录新建Dockerfile文件 ## 定义我们需要从哪个镜像进行构建 FROM node:8 ## 在镜像中创建一个文件夹存放应用程序代码，这将是你的应用程序工作目录 WORKDIR /usr/src/app COPY package*.json ./ RUN npm install COPY . . EXPOSE 8080 CMD [ &#34;node&#34;, &#34;index.js&#34; ] .dockerignore 文件 这将避免你的本地模块以及调试日志被拷贝进入到你的 Docker 镜像中 node_modules npm-debug."><meta property="og:title" content="node程序放入docker"><meta property="og:description" content="准备 demo 程序 index.js &#34;use strict&#34;; const express = require(&#34;express&#34;); // Constants const PORT = 6677; const HOST = &#34;0.0.0.0&#34;; // App const app = express(); app.get(&#34;/&#34;, (req, res) => { res.send(&#34;<h1>Hello world</h1>&#34;); }); app.listen(PORT, HOST); console.log(`Running on http://${HOST}:${PORT}`); 根目录新建Dockerfile文件 ## 定义我们需要从哪个镜像进行构建 FROM node:8 ## 在镜像中创建一个文件夹存放应用程序代码，这将是你的应用程序工作目录 WORKDIR /usr/src/app COPY package*.json ./ RUN npm install COPY . . EXPOSE 8080 CMD [ &#34;node&#34;, &#34;index.js&#34; ] .dockerignore 文件 这将避免你的本地模块以及调试日志被拷贝进入到你的 Docker 镜像中 node_modules npm-debug."><meta property="og:type" content="article"><meta property="og:url" content="https://chenkai.life/nodejs/node-docker/"><meta property="article:section" content="nodejs"><meta property="article:published_time" content="2021-07-09T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-25T18:40:37+08:00"><title>node程序放入docker · CK's Blog</title><link rel=canonical href=https://chenkai.life/nodejs/node-docker/><link rel=stylesheet href=/css/coder.min.0e0f0ac9929898ae6625ca3789e3f9e2e630ead0a5e0f1fe96c1ba7d8774342c.css integrity="sha256-Dg8KyZKYmK5mJco3ieP54uYw6tCl4PH+lsG6fYd0NCw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.d8f89ef09509afb63b9b2595ee174e53cc51ce02a6f6a2179e1621f9389e4340.css integrity="sha256-2Pie8JUJr7Y7myWV7hdOU8xRzgKm9qIXnhYh+TieQ0A=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/custom.min.56610f8c63ea4ca06cdac03f4fafe3e818c64566f988301b72895eb047082c51.css integrity="sha256-VmEPjGPqTKBs2sA/T6/j6BjGRWb5iDAbcolesEcILFE=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/favicon.ico><link rel=apple-touch-icon type=image/png sizes=256x256 href=/images/favicon-512x512.png><meta name=generator content="Hugo 0.101.0"><link rel=manifest href=/manifest.webmanifest></head><body class="preload-transitions colorscheme-auto"><div class=float-container><span id=dark-mode-toggle class=colorscheme-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-anheimoshi"/></svg></span></div><details id=table-of-contents-wapper><summary><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></summary></details><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>CK's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/>Home</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/marks/>Marks</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/ckvv/ckvv.github.io/new/main/content>Create</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item id=search-content><input class=search-int type=text placeholder=Search>
<button class=search-btn data-type=github>GitHub</button>
<button class=search-btn data-type=google>Google</button></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://chenkai.life/nodejs/node-docker/>node程序放入docker</a></h1><div class=edit-link style=float:right;color:#0366d6><a class=title rel=noopener target=_blank href=https://github.com/ckvv/ckvv.github.io/edit/main/content/nodejs/node-docker.md>编辑</a></div></header><div class=post-meta><div class=date><span class=posted-on><svg class="icon" aria-hidden="true"><use xlink:href="#icon-date"/></svg><time datetime=2021-07-09T00:00:00Z>2021-07-09</time></span></div><div class=tags><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"/></svg><span class=tag><a href=/tags/node.js/>Node.js</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/docker/>Docker</a></span></div></div><h2 id=准备-demo-程序>准备 demo 程序
<a class=heading-link href=#%e5%87%86%e5%a4%87-demo-%e7%a8%8b%e5%ba%8f><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li>index.js</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#e6db74>&#34;use strict&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;express&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Constants
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>6677</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>HOST</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// App
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>(<span style=color:#e6db74>&#34;&lt;h1&gt;Hello world&lt;/h1&gt;&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#a6e22e>PORT</span>, <span style=color:#a6e22e>HOST</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Running on http://</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>HOST</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>PORT</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span></code></pre></div><ul><li>根目录新建<code>Dockerfile</code>文件</li></ul><pre tabindex=0><code>## 定义我们需要从哪个镜像进行构建
FROM node:8

## 在镜像中创建一个文件夹存放应用程序代码，这将是你的应用程序工作目录
WORKDIR /usr/src/app


COPY package*.json ./

RUN npm install

COPY . .

EXPOSE 8080

CMD [ &#34;node&#34;, &#34;index.js&#34; ]
</code></pre><ul><li><code>.dockerignore</code> 文件
这将避免你的本地模块以及调试日志被拷贝进入到你的 Docker 镜像中</li></ul><pre tabindex=0><code>node_modules
npm-debug.log
</code></pre><h2 id=镜像>镜像
<a class=heading-link href=#%e9%95%9c%e5%83%8f><i class="fa fa-link" aria-hidden=true></i></a></h2><p>构建你的镜像
进入到 Dockerfile 所在的那个目录中，运行以下命令构建 Docker 镜像。开关符 -t 让你标记你的镜像</p><pre tabindex=0><code>//Don’t forget the . character at the end, which sets the build context to the current directory.
docker build -t chenkai/node-web-app:v1.0.0 .
</code></pre><p>检测镜像是否构建成功<code>docker images | grep node-web-app</code> 可以看到构建的镜像</p><p>运行镜像,使用 -d 模式运行镜像将以分离模式运行 Docker 容器，使得容器在后台自助运行。开关符 -p 在容器中把一个公共端口导向到私有的端口，请用以下命令运行你之前构建的镜像</p><pre tabindex=0><code>docker run -p 4444:6677 -d chenkai/node-web-app:v1.0.0
</code></pre><p><code>docker ps | grep node-web-app</code>可以看到启动的容器
<code>docker logs -f ${CONTAINER ID }</code>可以看到容器输出的日志</p><p>浏览器中输入通过容器暴露出的端口<code>http://localhost:4444/</code>即可访问镜像中的 node 程序</p><h2 id=注意事项>注意事项
<a class=heading-link href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9><i class="fa fa-link" aria-hidden=true></i></a></h2><h2 id=npm-包大小写>npm 包大小写
<a class=heading-link href=#npm-%e5%8c%85%e5%a4%a7%e5%b0%8f%e5%86%99><i class="fa fa-link" aria-hidden=true></i></a></h2><p>一次构建镜像后提示缺少 npm 包错误，原因是因为 mac 开发下对文件名大小写不敏感，程序可以正常跑通，打包成镜像后基础镜像基于 linux，对文件大小写敏感，找不到对应库</p><h2 id=dockerfile>dockerfile
<a class=heading-link href=#dockerfile><i class="fa fa-link" aria-hidden=true></i></a></h2><p>一次运行容器报<code>sh: app.js,: unknown operand</code>错误，原因是 dockerfile 文件里面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>CMD <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#39;app.js&#39;</span> <span style=color:#f92672>]</span>
</span></span></code></pre></div><p>js 养成了引号、双引号的习惯没检查出来，</p><div id=cusdis_thread data-host=https://cusdis.com data-app-id=c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd data-page-id=b9c860dcbef77ba66096f2790e0cd05e data-page-url=https://chenkai.life/nodejs/node-docker/ data-page-title=node程序放入docker data-iframe=/js/cusdis/iframe.umd.js data-style=/js/cusdis/style.css></div></article></section></div></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script>
<script src=/js/custom.js></script>
<script src=/js/font.min.js></script></body><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></html>