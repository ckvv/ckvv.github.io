import{w as C}from"./runtime-dom.esm-bundler.BY0Bn5Jo.js";import{_ as E}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as b,u as S,o as i,c,a as p,r as D,b as j,w as H,F,e as A,f as y,g as _,h as M,t as k}from"./runtime-core.esm-bundler.DKSusNuW.js";async function P(t){const s=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}function z(t,s=1){const e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(1024));return`${Number.parseFloat((t/1024**o).toFixed(s))} ${e[o]}`}function L(t){return["png","jpg","jpeg","gif","tif","tiff","svg"].includes(`${t.split(".").pop()}`)}async function w(t,s,n=6e3){const e=new AbortController,o=setTimeout(()=>e.abort(),n);return fetch(t,{...s,signal:e.signal}).then(a=>(clearTimeout(o),a)).catch(a=>{throw a.name==="AbortError"?new Error("Request timed out"):a})}const x={async upload(t){const s=(t.name.split(".").pop()||"").toLowerCase(),n=await P(t),e=new FormData;return e.append("file",t),(await w(`https://files.ckpavv.workers.dev/${n}.${s}`,{method:"POST",body:e})).json()},async list(t){return(await w(`https://files.ckpavv.workers.dev?${new URLSearchParams(t)}`)).json()},async del(t,s){return(await w(`https://files.ckpavv.workers.dev/${t}`,{headers:new Headers({Authorization:s}),method:"DELETE"})).json()}},U=b({__name:"Upload",emits:["change"],setup(t,{expose:s,emit:n}){s();const e=n,o=S("input");function a(){o.value?.click()}function r(f){const m=f.target,h=m?.files;h?.length&&(e("change",h[0]),m.value="")}const d={emits:e,inputRef:o,onClick:a,onInput:r};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}});function T(t,s,n,e,o,a){return i(),c("div",{onClick:e.onClick},[p("input",{ref:"input",type:"file",class:"hidden",onInput:e.onInput},null,544),D(t.$slots,"default")])}const N=E(U,[["render",T]]),B=20,$=b({__name:"Asstst",setup(t,{expose:s}){s();const n=_(!1),e=_(!1),o=_(!0),a=_(!1),r=_([]);async function d(l){try{a.value=!0;const u=await x.upload(l);r.value.push(u)}catch{}finally{a.value=!1}}async function f(){o.value=!0,n.value=!1,e.value=!1;try{const l={limit:B},u=r.value[r.value.length-1]?.key;u&&(l.startAfter=u);const v=await x.list(l);Array.isArray(v)&&(r.value=r.value.concat(v),v.length>=B&&(e.value=!0))}catch{n.value=!0,e.value=!1}finally{o.value=!1}}async function m(l,u,v){l.preventDefault();try{const g=prompt("请输入密码");if(!g)return;await x.del(u.key,g),r.value.splice(v,1)}catch{}}M(async()=>{f()});const h={limit:B,isHaveError:n,isHaveMore:e,isLoading:o,isUploading:a,files:r,onChange:d,search:f,handlerDel:m,get formatFileSize(){return z},get isPicture(){return L},Upload:N};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),I={class:"flex flex-col gap-4"},R={class:"px-4 py-2 text-blue-500 bg-gray-100 rounded hover:text-blue-600"},V={class:"flex flex-wrap justify-center items-center gap-6"},O=["href"],q=["src","alt"],G={key:1,class:""},K=["onClick"],Y={class:"select-none text-center cursor-pointer"},Z={key:0},J={key:3};function Q(t,s,n,e,o,a){return i(),c("div",I,[j(e.Upload,{class:"self-end",onChange:e.onChange},{default:H(()=>[p("button",R,k(e.isUploading?"正在上传...":"上传"),1)]),_:1}),p("div",V,[(i(!0),c(F,null,A(e.files,(r,d)=>(i(),c("a",{key:r.key,href:`https://files.ckpavv.workers.dev/${r.key}`,target:"_blank",class:"group w-full md:w-52 md:h-52 p-2 hover:shadow-md cursor-pointer flex justify-center items-center !bg-gray-100 rounded relative"},[e.isPicture(r.key)?(i(),c("img",{key:0,class:"max-w-full max-h-full",src:`https://files.ckpavv.workers.dev/${r.key}`,alt:`.${r.key.split(".").pop()}(${e.formatFileSize(r.size)})`},null,8,q)):(i(),c("div",G,k(`.${r.key.split(".").pop()}`)+"("+k(e.formatFileSize(r.size))+") ",1)),p("div",{class:"w-8 h-8 justify-center items-center text-red-500 absolute top-0 right-0 hidden group-hover:flex text-xl hover:text-2xl",onClick:C(f=>e.handlerDel(f,r,d),["stop"])},"x",8,K)],8,O))),128)),(i(),c(F,null,A(4,r=>p("div",{key:r,class:"w-52 h-0"})),64))]),p("div",Y,[e.isLoading?(i(),c("div",Z," 加载中... ")):y("",!0),e.isHaveError?(i(),c("div",{key:1,onClick:e.search}," 加载失败(需要 VPN 访问), 点击重试 ")):y("",!0),e.isHaveMore?(i(),c("div",{key:2,onClick:e.search}," 加载更多 ")):y("",!0),!e.isHaveMore&&!e.isLoading&&!e.isHaveError?(i(),c("div",J," --- 到底部了 --- ")):y("",!0)])])}const te=E($,[["render",Q]]);export{te as default};
