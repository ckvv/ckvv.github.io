import{w as S}from"./runtime-dom.esm-bundler.DT6uYpqB.js";import{g as L,i as U,f as j}from"./shared.C2hNlEjk.js";import{_ as A}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as B,c as l,o as u,a as m,r as H,u as P,b as z,w as M,F as E,e as D,f as k,g as y,h as T,i as I,t as w}from"./runtime-core.esm-bundler.BRLjdKdu.js";async function x(s,r,a=6e3){const e=new AbortController,i=setTimeout(()=>e.abort(),a);return fetch(s,{...r,signal:e.signal}).then(o=>(clearTimeout(i),o)).catch(o=>{throw o.name==="AbortError"?new Error("Request timed out"):o})}const F={async upload(s){const r=(s.name.split(".").pop()||"").toLowerCase(),a=await L(s),e=new FormData;return e.append("file",s),(await x(`https://api.ckvv.net/r2/${a}.${r}`,{method:"POST",body:e})).json()},async list(s){return(await x(`https://api.ckvv.net/r2?${new URLSearchParams(s)}`)).json()},async del(s,r){return(await x(`https://api.ckvv.net/r2/${s}`,{headers:new Headers({Authorization:r}),method:"DELETE"})).json()}},R=B({__name:"Upload",emits:["change"],setup(s,{expose:r,emit:a}){r();const e=a,i=P("input");function o(){i.value?.click()}function t(f){const _=f.target,h=_?.files;h?.length&&(e("change",h[0]),_.value="")}const p={emits:e,inputRef:i,onClick:o,onInput:t};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}});function N(s,r,a,e,i,o){return u(),l("div",{onClick:e.onClick},[m("input",{ref:"input",type:"file",class:"hidden",onInput:e.onInput},null,544),H(s.$slots,"default")])}const O=A(R,[["render",N]]),b=20,V=B({__name:"Asstst",setup(s,{expose:r}){r();const a=y(!1),e=y(!1),i=y(!0),o=y(!1),t=y([]);async function p(c){try{o.value=!0;const n=await F.upload(c);t.value.push(n)}catch{}finally{o.value=!1}}async function f(){i.value=!0,a.value=!1,e.value=!1;try{const c={limit:b},n=t.value[t.value.length-1]?.key;n&&(c.startAfter=n);const d=await F.list(c);Array.isArray(d)&&(t.value=t.value.concat(d),d.length>=b&&(e.value=!0))}catch{a.value=!0,e.value=!1}finally{i.value=!1}}async function _(c,n,d,g){c.preventDefault();try{const v=prompt(g||"请输入密码");if(!v)return;if((await F.del(n.key,v))?.success===!1)return _(c,n,d,"密码错误, 请重新输入密码");t.value.splice(d,1)}catch{}}async function h(c){c.preventDefault();const n=c.clipboardData;if(n&&n.items)for(let d=0;d<n.items.length;d++){const g=n.items[d];if(g.kind!=="file")continue;const v=g.getAsFile();await p(v)}}T(async()=>{f(),document.addEventListener("paste",h)}),I(()=>{document.removeEventListener("paste",h)});const C={limit:b,isHaveError:a,isHaveMore:e,isLoading:i,isUploading:o,files:t,onUpload:p,search:f,handlerDel:_,handlerPaste:h,get formatFileSize(){return j},get isPicture(){return U},Upload:O};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}}),q={class:"flex flex-col gap-4"},$={class:"px-4 py-2 text-blue-500 bg-gray-100 rounded hover:text-blue-600"},G={class:"flex flex-wrap justify-center items-center gap-6"},J=["href"],K=["src","alt"],Q={key:1,class:""},W=["onClick"],X={class:"select-none text-center cursor-pointer"},Y={key:0},Z={key:3};function ee(s,r,a,e,i,o){return u(),l("div",q,[z(e.Upload,{class:"self-end",onChange:e.onUpload},{default:M(()=>[m("button",$,w(e.isUploading?"正在上传...":"上传"),1)]),_:1}),m("div",G,[(u(!0),l(E,null,D(e.files,(t,p)=>(u(),l("a",{key:t.key,href:`https://r2.ckvv.net/${t.key}`,target:"_blank",class:"group w-full min-h-24 md:w-52 md:h-52 p-2 hover:shadow-md cursor-pointer flex justify-center items-center !bg-gray-100 rounded relative"},[e.isPicture(t.key)?(u(),l("img",{key:0,class:"max-w-full max-h-full",src:`https://r2.ckvv.net/${t.key}`,alt:`.${t.key.split(".").pop()}(${e.formatFileSize(t.size)})`},null,8,K)):(u(),l("div",Q,w(`.${t.key.split(".").pop()}`)+"("+w(e.formatFileSize(t.size))+") ",1)),m("div",{class:"w-8 h-8 justify-center items-center text-red-500 absolute top-0 right-0 hidden group-hover:flex text-xl hover:text-2xl",onClick:S(f=>e.handlerDel(f,t,p),["stop"])},"x",8,W)],8,J))),128)),(u(),l(E,null,D(4,t=>m("div",{key:t,class:"w-52 h-0"})),64))]),m("div",X,[e.isLoading?(u(),l("div",Y," 加载中... ")):k("",!0),e.isHaveError?(u(),l("div",{key:1,onClick:e.search}," 加载失败, 请点击重试 ")):k("",!0),e.isHaveMore?(u(),l("div",{key:2,onClick:e.search}," 加载更多 ")):k("",!0),!e.isHaveMore&&!e.isLoading&&!e.isHaveError?(u(),l("div",Z," --- 到底部了 --- ")):k("",!0)])])}const oe=A(V,[["render",ee]]);export{oe as default};
