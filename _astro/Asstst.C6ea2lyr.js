import{_ as F}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as A,u as b,o as i,c,a as p,r as E,b as S,w as C,F as k,e as w,f as v,g as d,h as j,t as m}from"./runtime-core.esm-bundler.DPwrVdfn.js";async function D(t){const r=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}function P(t,r=1){const e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(1024));return`${Number.parseFloat((t/1024**a).toFixed(r))} ${e[a]}`}function H(t){return["png","jpg","jpeg","gif","tif","tiff","svg"].includes(`${t.split(".").pop()}`)}async function B(t,r,n=6e3){const e=new AbortController,a=setTimeout(()=>e.abort(),n);return fetch(t,{...r,signal:e.signal}).then(o=>(clearTimeout(a),o)).catch(o=>{throw o.name==="AbortError"?new Error("Request timed out"):o})}const x={async upload(t){const r=(t.name.split(".").pop()||"").toLowerCase(),n=await D(t),e=new FormData;return e.append("file",t),(await B(`https://files.ckpavv.workers.dev/${n}.${r}`,{method:"POST",body:e})).json()},async list(t){return(await B(`https://files.ckpavv.workers.dev?${new URLSearchParams(t)}`)).json()}},M=A({__name:"Upload",emits:["change"],setup(t,{expose:r,emit:n}){r();const e=n,a=b("input");function o(){a.value?.click()}function s(_){const u=_.target,l=u?.files;l?.length&&(e("change",l[0]),u.value="")}const h={emits:e,inputRef:a,onClick:o,onInput:s};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}});function z(t,r,n,e,a,o){return i(),c("div",{onClick:e.onClick},[p("input",{ref:"input",type:"file",class:"hidden",onInput:e.onInput},null,544),E(t.$slots,"default")])}const U=F(M,[["render",z]]),g=20,L=A({__name:"Asstst",setup(t,{expose:r}){r();const n=d(!1),e=d(!1),a=d(!0),o=d(!1),s=d([]);async function h(l){try{o.value=!0;const f=await x.upload(l);s.value.push(f)}catch{}finally{o.value=!1}}async function _(){a.value=!0,n.value=!1,e.value=!1;try{const l={limit:g},f=s.value[s.value.length-1]?.key;f&&(l.startAfter=f);const y=await x.list(l);Array.isArray(y)&&(s.value=s.value.concat(y),y.length>=g&&(e.value=!0))}catch{n.value=!0,e.value=!1}finally{a.value=!1}}j(async()=>{_()});const u={limit:g,isHaveError:n,isHaveMore:e,isLoading:a,isUploading:o,files:s,onChange:h,search:_,get formatFileSize(){return P},get isPicture(){return H},Upload:U};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),N={class:"flex flex-col gap-4"},T={class:"px-4 py-2 text-blue-500 bg-gray-100 rounded hover:text-blue-600"},$={class:"flex flex-wrap justify-center items-center gap-6"},I=["href"],R=["src","alt"],V={key:1,class:""},O={class:"select-none text-center cursor-pointer"},q={key:0},G={key:3};function K(t,r,n,e,a,o){return i(),c("div",N,[S(e.Upload,{class:"self-end",onChange:e.onChange},{default:C(()=>[p("button",T,m(e.isUploading?"正在上传...":"上传"),1)]),_:1}),p("div",$,[(i(!0),c(k,null,w(e.files,s=>(i(),c("a",{key:s.key,href:`https://files.ckpavv.workers.dev/${s.key}`,target:"_blank",class:"w-52 h-52 p-2 hover:shadow-md cursor-pointer flex justify-center items-center !bg-gray-100 rounded"},[e.isPicture(s.key)?(i(),c("img",{key:0,class:"max-w-full max-h-full",src:`https://files.ckpavv.workers.dev/${s.key}`,alt:`.${s.key.split(".").pop()}(${e.formatFileSize(s.size)})`},null,8,R)):(i(),c("div",V,m(`.${s.key.split(".").pop()}`)+"("+m(e.formatFileSize(s.size))+") ",1))],8,I))),128)),(i(),c(k,null,w(4,s=>p("div",{key:s,class:"w-52 h-0"})),64))]),p("div",O,[e.isLoading?(i(),c("div",q," 加载中... ")):v("",!0),e.isHaveError?(i(),c("div",{key:1,onClick:e.search}," 加载失败(需要 VPN 访问), 点击重试 ")):v("",!0),e.isHaveMore?(i(),c("div",{key:2,onClick:e.search}," 加载更多 ")):v("",!0),!e.isHaveMore&&!e.isLoading&&!e.isHaveError?(i(),c("div",G," --- 到底部了 --- ")):v("",!0)])])}const J=F(L,[["render",K]]);export{J as default};
