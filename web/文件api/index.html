<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=theme-color content="#ffffff"><meta name=color-scheme content="light dark"><meta name=description content="File API 文件 API 对于传统的File API 当需要用户提供文件时，Web 应用程序可以使用文件 <input> 元素打开文件选择对话框来访问文件或者文件夹
fileInput.addEventListener(&#34;change&#34;, async () => { const [file] = fileInput.files; }); File System Access API 借助 File System Access API，开发者可以构建功能强大的 Web 应用， 用户本地设备上的文件，例如 IDE、照片和视频编辑器、文本编辑器等。更新后 当用户向 Web 应用授予访问权限时，此 API 可让用户直接读取或保存对文件的更改，以及 文件夹。除了读取和写入文件以外，File System Access API 还提供了 能够打开目录并枚举其内容。
File System Access API 的主要特性 请求文件权限 async function openFile() { const [fileHandle] = await window.showOpenFilePicker(); // 对文件进行处理 } async function openFolder() { const folderHandle = await window."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="文件系统访问(File System Access) API"><meta name=twitter:description content="File API 文件 API 对于传统的File API 当需要用户提供文件时，Web 应用程序可以使用文件 <input> 元素打开文件选择对话框来访问文件或者文件夹
fileInput.addEventListener(&#34;change&#34;, async () => { const [file] = fileInput.files; }); File System Access API 借助 File System Access API，开发者可以构建功能强大的 Web 应用， 用户本地设备上的文件，例如 IDE、照片和视频编辑器、文本编辑器等。更新后 当用户向 Web 应用授予访问权限时，此 API 可让用户直接读取或保存对文件的更改，以及 文件夹。除了读取和写入文件以外，File System Access API 还提供了 能够打开目录并枚举其内容。
File System Access API 的主要特性 请求文件权限 async function openFile() { const [fileHandle] = await window.showOpenFilePicker(); // 对文件进行处理 } async function openFolder() { const folderHandle = await window."><meta property="og:title" content="文件系统访问(File System Access) API"><meta property="og:description" content="File API 文件 API 对于传统的File API 当需要用户提供文件时，Web 应用程序可以使用文件 <input> 元素打开文件选择对话框来访问文件或者文件夹
fileInput.addEventListener(&#34;change&#34;, async () => { const [file] = fileInput.files; }); File System Access API 借助 File System Access API，开发者可以构建功能强大的 Web 应用， 用户本地设备上的文件，例如 IDE、照片和视频编辑器、文本编辑器等。更新后 当用户向 Web 应用授予访问权限时，此 API 可让用户直接读取或保存对文件的更改，以及 文件夹。除了读取和写入文件以外，File System Access API 还提供了 能够打开目录并枚举其内容。
File System Access API 的主要特性 请求文件权限 async function openFile() { const [fileHandle] = await window.showOpenFilePicker(); // 对文件进行处理 } async function openFolder() { const folderHandle = await window."><meta property="og:type" content="article"><meta property="og:url" content="https://chenkai.life/web/%E6%96%87%E4%BB%B6api/"><meta property="article:section" content="web"><meta property="article:published_time" content="2024-09-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-19T00:00:00+00:00"><title>文件系统访问(File System Access) API · CK's Blog</title><link rel=canonical href=https://chenkai.life/web/%E6%96%87%E4%BB%B6api/><link rel=stylesheet href=/css/coder.min.0e0f0ac9929898ae6625ca3789e3f9e2e630ead0a5e0f1fe96c1ba7d8774342c.css integrity="sha256-Dg8KyZKYmK5mJco3ieP54uYw6tCl4PH+lsG6fYd0NCw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.d8f89ef09509afb63b9b2595ee174e53cc51ce02a6f6a2179e1621f9389e4340.css integrity="sha256-2Pie8JUJr7Y7myWV7hdOU8xRzgKm9qIXnhYh+TieQ0A=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/custom.min.d12542c00c198b6a07ca9ea5981102805aecab0f5dfd5e3273d8c179088712c4.css integrity="sha256-0SVCwAwZi2oHyp6lmBECgFrsqw9d/V4yc9jBeQiHEsQ=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/favicon.ico><link rel=apple-touch-icon type=image/png sizes=256x256 href=/images/favicon-512x512.png><meta name=generator content="Hugo 0.119.0"><link rel=manifest href=/manifest.webmanifest></head><body class="preload-transitions colorscheme-auto"><div class=float-container><span id=dark-mode-toggle class=colorscheme-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-anheimoshi"/></svg></span></div><details id=table-of-contents-wapper><summary><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></summary></details><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>CK's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/>Home</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/marks/>Marks</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/ckvv/ckvv.github.io/tree/main/content>Create</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item id=search-content><input class=search-int type=text placeholder=Search>
<button class=search-btn data-type=github>GitHub</button>
<button class=search-btn data-type=google>Google</button></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://chenkai.life/web/%E6%96%87%E4%BB%B6api/>文件系统访问(File System Access) API</a></h1><div class=edit-link style=float:right;color:#0366d6><a class=title rel=noopener target=_blank href=https://github.com/ckvv/ckvv.github.io/edit/main/content/web/%e6%96%87%e4%bb%b6API.md>编辑</a></div></header><div class=post-meta><div class=date><span class=posted-on><svg class="icon" aria-hidden="true"><use xlink:href="#icon-date"/></svg><time datetime=2024-09-19T00:00:00Z>2024-09-19</time></span></div><div class=tags><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"/></svg><span class=tag><a href=/tags/web/>Web</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/file-api/>File API</a></span></div></div><h1 id=file-api-文件-api>File API 文件 API
<a class=heading-link href=#file-api-%e6%96%87%e4%bb%b6-api><i class="fa fa-link" aria-hidden=true></i></a></h1><p>对于传统的<code>File API</code> 当需要用户提供文件时，Web 应用程序可以使用文件 <code>&lt;input></code> 元素打开文件选择对话框来访问文件或者文件夹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>fileInput</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;change&#34;</span>, <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>file</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>fileInput</span>.<span style=color:#a6e22e>files</span>;
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h1 id=file-system-access-api>File System Access API
<a class=heading-link href=#file-system-access-api><i class="fa fa-link" aria-hidden=true></i></a></h1><p>借助 File System Access API，开发者可以构建功能强大的 Web 应用， 用户本地设备上的文件，例如 IDE、照片和视频编辑器、文本编辑器等。更新后 当用户向 Web 应用授予访问权限时，此 API 可让用户直接读取或保存对文件的更改，以及 文件夹。除了读取和写入文件以外，File System Access API 还提供了 能够打开目录并枚举其内容。</p><h2 id=file-system-access-api-的主要特性>File System Access API 的主要特性
<a class=heading-link href=#file-system-access-api-%e7%9a%84%e4%b8%bb%e8%a6%81%e7%89%b9%e6%80%a7><i class="fa fa-link" aria-hidden=true></i></a></h2><h3 id=请求文件权限>请求文件权限
<a class=heading-link href=#%e8%af%b7%e6%b1%82%e6%96%87%e4%bb%b6%e6%9d%83%e9%99%90><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>openFile</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>fileHandle</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> window.<span style=color:#a6e22e>showOpenFilePicker</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 对文件进行处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>openFolder</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>folderHandle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> window.<span style=color:#a6e22e>showDirectoryPicker</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 对文件夹进行处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h3 id=持久化访问权限>持久化访问权限
<a class=heading-link href=#%e6%8c%81%e4%b9%85%e5%8c%96%e8%ae%bf%e9%97%ae%e6%9d%83%e9%99%90><i class="fa fa-link" aria-hidden=true></i></a></h3><p>用户可以授予 Web 应用程序对特定文件或文件夹的。
一旦获得权限，应用程序可以在后续的访问中无需再次请求用户授权，直接访问这些文件或文件夹。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>DB</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 文件句柄和目录句柄是可序列化的，这意味着您可以保存文件或 将目录句柄添加到 IndexedDB，或调用 postMessage() 在同一顶级数据库之间发送这些路径和 来源。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getDB</span>(<span style=color:#a6e22e>DB_NAME</span>, <span style=color:#a6e22e>STORE_NAME</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dbPromise</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>openDB</span>(<span style=color:#a6e22e>DB_NAME</span>, <span style=color:#ae81ff>1</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>upgrade</span>(<span style=color:#a6e22e>db</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>createObjectStore</span>(<span style=color:#a6e22e>STORE_NAME</span>);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>STORE_NAME</span>, <span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>val</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>STORE_NAME</span>, <span style=color:#a6e22e>val</span>, <span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>del</span>(<span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dbPromise</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>STORE_NAME</span>, <span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>get</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>set</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>del</span>,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getDirHandler</span>(<span style=color:#a6e22e>DB_DIR_KEY</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;dir_handler&#39;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>DB</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>DB</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>getDB</span>(<span style=color:#a6e22e>DB_NAME</span>, <span style=color:#a6e22e>STORE_NAME</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>/** @type { FileSystemDirectoryHandle } */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dirHandler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>DB_DIR_KEY</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>dirHandler</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>dirHandler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> window.<span style=color:#a6e22e>showDirectoryPicker</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>mode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;readwrite&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>startIn</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;documents&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>DB_DIR_KEY</span>, <span style=color:#a6e22e>dirHandler</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 由于权限并非总是在会话之间持久保留，因此您应验证用户是否 已使用 queryPermission() 授予对文件或目录的权限。否则，请调用 requestPermission() 来（重新）请求该请求。这对文件和目录句柄是相同的。您 需要运行 fileOrDirectoryHandle.requestPermission(descriptor) 或 fileOrDirectoryHandle.queryPermission(descriptor)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>verifyPermission</span>(<span style=color:#a6e22e>dirHandler</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dirHandler</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=直接文件访问>直接文件访问
<a class=heading-link href=#%e7%9b%b4%e6%8e%a5%e6%96%87%e4%bb%b6%e8%ae%bf%e9%97%ae><i class="fa fa-link" aria-hidden=true></i></a></h3><p>可以通过编程方式直接打开、读取、写入和保存文件，无需依赖传统的文件选择对话框。
例如，可以使用 JavaScript 代码直接访问用户指定的文件，并对其内容进行处理</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>readFileContent</span>(<span style=color:#a6e22e>fileHandle</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fileHandle</span>.<span style=color:#a6e22e>getFile</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>reader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FileReader</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>onerror</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>reject</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> () =&gt; <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>readAsText</span>(<span style=color:#a6e22e>file</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=使用限制>使用限制
<a class=heading-link href=#%e4%bd%bf%e7%94%a8%e9%99%90%e5%88%b6><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li>只能访问基于选择文件的相对路径(既无法访问绝对路径目录)</li><li>为了帮助保护用户及其数据，浏览器可能会限制用户保存至特定 文件夹，例如 Windows 等核心操作系统文件夹、macOS“库”文件夹。 在这种情况下，浏览器会显示一条提示，要求用户选择其他 文件夹中。</li><li>如果用户想要保存对之前授予读取权限的文件所做的更改，浏览器 ，显示权限提示，请求网站将更改写入磁盘的权限。 权限请求只能通过用户手势触发，例如，通过点击“保存” 按钮。</li></ul><div id=cusdis_thread data-host=https://cusdis.com data-app-id=c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd data-page-id=8b2deaf4b2fece0cf601fcefa7ecf6f4 data-page-url=https://chenkai.life/web/%E6%96%87%E4%BB%B6api/ data-page-title="文件系统访问(File System Access) API" data-iframe=/js/cusdis/iframe.umd.js data-style=/js/cusdis/style.css></div></article></section></div></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script>
<script src=/js/custom.js></script>
<script src=/js/font.min.js></script></body><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></html>