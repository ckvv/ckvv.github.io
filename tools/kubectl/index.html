<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta name=description content="This page is an overview of the kubectl command.
 Kubectl Autocomplete Kubectl Context and Configuration Apply Creating Objects Viewing, Finding Resources Updating Resources Patching Resources Editing Resources Scaling Resources Deleting Resources Interacting with running Pods Interacting with Nodes and Cluster What&rsquo;s next  kubectl - Cheat Sheet    Kubectl Autocomplete    BASH    source <(kubectl completion bash) # setup autocomplete in bash into the current shell, bash-completion package should be installed first."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="kubectl命令"><meta name=twitter:description content="This page is an overview of the kubectl command.
 Kubectl Autocomplete Kubectl Context and Configuration Apply Creating Objects Viewing, Finding Resources Updating Resources Patching Resources Editing Resources Scaling Resources Deleting Resources Interacting with running Pods Interacting with Nodes and Cluster What&rsquo;s next  kubectl - Cheat Sheet    Kubectl Autocomplete    BASH    source <(kubectl completion bash) # setup autocomplete in bash into the current shell, bash-completion package should be installed first."><meta property="og:title" content="kubectl命令"><meta property="og:description" content="This page is an overview of the kubectl command.
 Kubectl Autocomplete Kubectl Context and Configuration Apply Creating Objects Viewing, Finding Resources Updating Resources Patching Resources Editing Resources Scaling Resources Deleting Resources Interacting with running Pods Interacting with Nodes and Cluster What&rsquo;s next  kubectl - Cheat Sheet    Kubectl Autocomplete    BASH    source <(kubectl completion bash) # setup autocomplete in bash into the current shell, bash-completion package should be installed first."><meta property="og:type" content="article"><meta property="og:url" content="https://chenkai.life/tools/kubectl/"><meta property="article:published_time" content="2021-07-09T15:37:56+08:00"><meta property="article:modified_time" content="2021-07-09T15:37:56+08:00"><title>kubectl命令 · CK's Blog</title><link rel=canonical href=https://chenkai.life/tools/kubectl/><link rel=stylesheet href=/css/coder.min.0e0f0ac9929898ae6625ca3789e3f9e2e630ead0a5e0f1fe96c1ba7d8774342c.css integrity="sha256-Dg8KyZKYmK5mJco3ieP54uYw6tCl4PH+lsG6fYd0NCw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.d8f89ef09509afb63b9b2595ee174e53cc51ce02a6f6a2179e1621f9389e4340.css integrity="sha256-2Pie8JUJr7Y7myWV7hdOU8xRzgKm9qIXnhYh+TieQ0A=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/custom.min.ffed55576b1fe8cd1a532c3c9691900c09813ce5a8e0fbf58a6e377169305cf3.css integrity="sha256-/+1VV2sf6M0aUyw8lpGQDAmBPOWo4Pv1im43cWkwXPM=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.72.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><span id=dark-mode-toggle class=colorscheme-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-anheimoshi"/></svg></span></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>CK's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/>Home</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/index.xml>RSS</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item id=search-content><input class=search-int type=text placeholder=Search>
<button class=search-btn data-type=google>Google</button>
<button class=search-btn data-type=github>GitHub</button></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://chenkai.life/tools/kubectl/>kubectl命令</a></h1><div class=edit-link style=float:right;color:#0366d6><a class=title target=_blank href=https://github.com/chenkai0520/chenkai0520.github.io/edit/main/content/tools/kubectl.md>编辑</a></div></header><div class=post-meta><div class=date><span class=posted-on><svg class="icon" aria-hidden="true"><use xlink:href="#icon-date"/></svg><time datetime=2021-07-09T15:37:56+08:00>2021-07-09</time></span></div><div class=tags><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"/></svg><span class=tag><a href=/tags/tool/>tool</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/docker/>docker</a></span></div></div><p>This page is an overview of the <code>kubectl</code> command.</p><ul><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-autocomplete>Kubectl Autocomplete</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-context-and-configuration>Kubectl Context and Configuration</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#apply>Apply</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#creating-objects>Creating Objects</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#viewing-finding-resources>Viewing, Finding Resources</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#updating-resources>Updating Resources</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#patching-resources>Patching Resources</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#editing-resources>Editing Resources</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#scaling-resources>Scaling Resources</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#deleting-resources>Deleting Resources</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods>Interacting with running Pods</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-nodes-and-cluster>Interacting with Nodes and Cluster</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/#what-s-next>What&rsquo;s next</a></li></ul><h2 id=kubectl---cheat-sheet>kubectl - Cheat Sheet
<a class=heading-link href=#kubectl---cheat-sheet><i class="fa fa-link" aria-hidden=true></i></a></h2><h2 id=kubectl-autocomplete>Kubectl Autocomplete
<a class=heading-link href=#kubectl-autocomplete><i class="fa fa-link" aria-hidden=true></i></a></h2><h3 id=bash>BASH
<a class=heading-link href=#bash><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>source &lt;<span style=color:#f92672>(</span>kubectl completion bash<span style=color:#f92672>)</span> <span style=color:#75715e># setup autocomplete in bash into the current shell, bash-completion package should be installed first.</span>
echo <span style=color:#e6db74>&#34;source &lt;(kubectl completion bash)&#34;</span> &gt;&gt; ~/.bashrc <span style=color:#75715e># add autocomplete permanently to your bash shell.</span>
</code></pre></div><p>You can also use a shorthand alias for <code>kubectl</code> that also works with completion:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>alias k<span style=color:#f92672>=</span>kubectl
complete -F __start_kubectl k
</code></pre></div><h3 id=zsh>ZSH
<a class=heading-link href=#zsh><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>source &lt;<span style=color:#f92672>(</span>kubectl completion zsh<span style=color:#f92672>)</span>  <span style=color:#75715e># setup autocomplete in zsh into the current shell</span>
echo <span style=color:#e6db74>&#34;if [ </span>$commands<span style=color:#e6db74>[kubectl] ]; then source &lt;(kubectl completion zsh); fi&#34;</span> &gt;&gt; ~/.zshrc <span style=color:#75715e># add autocomplete permanently to your zsh shell</span>
</code></pre></div><h2 id=kubectl-context-and-configuration>Kubectl Context and Configuration
<a class=heading-link href=#kubectl-context-and-configuration><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Set which Kubernetes cluster <code>kubectl</code> communicates with and modifies configuration information. See <a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>Authenticating Across Clusters with kubeconfig</a> documentation for detailed config file information.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl config view <span style=color:#75715e># Show Merged kubeconfig settings.</span>

<span style=color:#75715e>## use multiple kubeconfig files at the same time and view merged config</span>
KUBECONFIG<span style=color:#f92672>=</span>~/.kube/config:~/.kube/kubconfig2 

kubectl config view

<span style=color:#75715e>## get the password for the e2e user</span>
kubectl config view -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.users[?(@.name == &#34;e2e&#34;)].user.password}&#39;</span>

kubectl config view -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.users[].name}&#39;</span>    <span style=color:#75715e># display the first user</span>
kubectl config view -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.users[*].name}&#39;</span>   <span style=color:#75715e># get a list of users</span>
kubectl config get-contexts                          <span style=color:#75715e># display list of contexts</span> 
kubectl config current-context                       <span style=color:#75715e># display the current-context</span>
kubectl config use-context my-cluster-name           <span style=color:#75715e># set the default context to my-cluster-name</span>

<span style=color:#75715e>## add a new cluster to your kubeconf that supports basic auth</span>
kubectl config set-credentials kubeuser/foo.kubernetes.com --username<span style=color:#f92672>=</span>kubeuser --password<span style=color:#f92672>=</span>kubepassword

<span style=color:#75715e>## permanently save the namespace for all subsequent kubectl commands in that context.</span>
kubectl config set-context --current --namespace<span style=color:#f92672>=</span>ggckad-s2

<span style=color:#75715e>## set a context utilizing a specific username and namespace.</span>
kubectl config set-context gce --user<span style=color:#f92672>=</span>cluster-admin --namespace<span style=color:#f92672>=</span>foo <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> kubectl config use-context gce
 
kubectl config unset users.foo                       <span style=color:#75715e># delete user foo</span>
</code></pre></div><h2 id=apply>Apply
<a class=heading-link href=#apply><i class="fa fa-link" aria-hidden=true></i></a></h2><p><code>apply</code> manages applications through files defining Kubernetes resources. It creates and updates resources in a cluster through running <code>kubectl apply</code>. This is the recommended way of managing Kubernetes applications on production. See <a href=https://kubectl.docs.kubernetes.io/>Kubectl Book</a>.</p><h2 id=creating-objects>Creating Objects
<a class=heading-link href=#creating-objects><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Kubernetes manifests can be defined in YAML or JSON. The file extension <code>.yaml</code>, <code>.yml</code>, and <code>.json</code> can be used.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl apply -f ./my-manifest.yaml            <span style=color:#75715e># create resource(s)</span>
kubectl apply -f ./my1.yaml -f ./my2.yaml      <span style=color:#75715e># create from multiple files</span>
kubectl apply -f ./dir                         <span style=color:#75715e># create resource(s) in all manifest files in dir</span>
kubectl apply -f https://git.io/vPieo          <span style=color:#75715e># create resource(s) from url</span>
kubectl create deployment nginx --image<span style=color:#f92672>=</span>nginx  <span style=color:#75715e># start a single instance of nginx</span>
kubectl explain pods,svc                       <span style=color:#75715e># get the documentation for pod and svc manifests</span>

<span style=color:#75715e>## Create multiple YAML objects from stdin</span>
cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#e6db74>apiVersion: v1
</span><span style=color:#e6db74>kind: Pod
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: busybox-sleep
</span><span style=color:#e6db74>spec:
</span><span style=color:#e6db74>  containers:
</span><span style=color:#e6db74>  - name: busybox
</span><span style=color:#e6db74>    image: busybox
</span><span style=color:#e6db74>    args:
</span><span style=color:#e6db74>    - sleep
</span><span style=color:#e6db74>    - &#34;1000000&#34;
</span><span style=color:#e6db74>---
</span><span style=color:#e6db74>apiVersion: v1
</span><span style=color:#e6db74>kind: Pod
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: busybox-sleep-less
</span><span style=color:#e6db74>spec:
</span><span style=color:#e6db74>  containers:
</span><span style=color:#e6db74>  - name: busybox
</span><span style=color:#e6db74>    image: busybox
</span><span style=color:#e6db74>    args:
</span><span style=color:#e6db74>    - sleep
</span><span style=color:#e6db74>    - &#34;1000&#34;
</span><span style=color:#e6db74>EOF</span>

<span style=color:#75715e>## Create a secret with several keys</span>
cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#e6db74>apiVersion: v1
</span><span style=color:#e6db74>kind: Secret
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: mysecret
</span><span style=color:#e6db74>type: Opaque
</span><span style=color:#e6db74>data:
</span><span style=color:#e6db74>  password: $(echo -n &#34;s33msi4&#34; | base64 -w0)
</span><span style=color:#e6db74>  username: $(echo -n &#34;jane&#34; | base64 -w0)
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><h2 id=viewing-finding-resources>Viewing, Finding Resources
<a class=heading-link href=#viewing-finding-resources><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>## Get commands with basic output</span>
kubectl get services                          <span style=color:#75715e># List all services in the namespace</span>
kubectl get pods --all-namespaces             <span style=color:#75715e># List all pods in all namespaces</span>
kubectl get pods -o wide                      <span style=color:#75715e># List all pods in the namespace, with more details</span>
kubectl get deployment my-dep                 <span style=color:#75715e># List a particular deployment</span>
kubectl get pods                              <span style=color:#75715e># List all pods in the namespace</span>
kubectl get pod my-pod -o yaml                <span style=color:#75715e># Get a pod&#39;s YAML</span>
kubectl get pod my-pod -o yaml --export       <span style=color:#75715e># Get a pod&#39;s YAML without cluster specific information</span>

<span style=color:#75715e>## Describe commands with verbose output</span>
kubectl describe nodes my-node
kubectl describe pods my-pod

<span style=color:#75715e>## List Services Sorted by Name</span>
kubectl get services --sort-by<span style=color:#f92672>=</span>.metadata.name

<span style=color:#75715e>## List pods Sorted by Restart Count</span>
kubectl get pods --sort-by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;.status.containerStatuses[0].restartCount&#39;</span>

<span style=color:#75715e>## List PersistentVolumes in test namespace sorted by capacity</span>

kubectl get pv -n test --sort-by<span style=color:#f92672>=</span>.spec.capacity.storage

<span style=color:#75715e>## Get the version label of all pods with label app=cassandra</span>
kubectl get pods --selector<span style=color:#f92672>=</span>app<span style=color:#f92672>=</span>cassandra -o <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].metadata.labels.version}&#39;</span>

<span style=color:#75715e>## Get all worker nodes (use a selector to exclude results that have a label</span>
<span style=color:#75715e>## named &#39;node-role.kubernetes.io/master&#39;)</span>
kubectl get node --selector<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;!node-role.kubernetes.io/master&#39;</span>

<span style=color:#75715e>## Get all running pods in the namespace</span>
kubectl get pods --field-selector<span style=color:#f92672>=</span>status.phase<span style=color:#f92672>=</span>Running

<span style=color:#75715e>## Get ExternalIPs of all nodes</span>
kubectl get nodes -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].status.addresses[?(@.type==&#34;ExternalIP&#34;)].address}&#39;</span>

<span style=color:#75715e>## List Names of Pods that belong to Particular RC</span>
<span style=color:#75715e>## &#34;jq&#34; command useful for transformations that are too complex for jsonpath, it can be found at https://stedolan.github.io/jq/</span>
sel<span style=color:#f92672>=</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>$(</span>kubectl get rc my-rc --output<span style=color:#f92672>=</span>json | jq -j <span style=color:#e6db74>&#39;.spec.selector | to_entries | .[] | &#34;\(.key)=\(.value),&#34;&#39;</span><span style=color:#66d9ef>)</span>%?<span style=color:#e6db74>}</span>
echo <span style=color:#66d9ef>$(</span>kubectl get pods --selector<span style=color:#f92672>=</span>$sel --output<span style=color:#f92672>=</span>jsonpath<span style=color:#f92672>={</span>.items..metadata.name<span style=color:#f92672>}</span><span style=color:#66d9ef>)</span>

<span style=color:#75715e>## Show labels for all pods (or any other Kubernetes object that supports labelling)</span>
kubectl get pods --show-labels

<span style=color:#75715e>## Check which nodes are ready</span>
JSONPATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span> <span style=color:#f92672>&amp;&amp;</span> kubectl get nodes -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$JSONPATH<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;Ready=True&#34;</span>

<span style=color:#75715e>## List all Secrets currently in use by a pod</span>
kubectl get pods -o json | jq <span style=color:#e6db74>&#39;.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name&#39;</span> | grep -v null | sort | uniq

<span style=color:#75715e>## List Events sorted by timestamp</span>
kubectl get events --sort-by<span style=color:#f92672>=</span>.metadata.creationTimestamp
</code></pre></div><h2 id=updating-resources>Updating Resources
<a class=heading-link href=#updating-resources><i class="fa fa-link" aria-hidden=true></i></a></h2><p>As of version 1.11 <code>rolling-update</code> have been deprecated (see <a href=https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.11.md>CHANGELOG-1.11.md</a>), use <code>rollout</code> instead.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl set image deployment/frontend www<span style=color:#f92672>=</span>image:v2               <span style=color:#75715e># Rolling update &#34;www&#34; containers of &#34;frontend&#34; deployment, updating the image</span>
kubectl rollout history deployment/frontend                      <span style=color:#75715e># Check the history of deployments including the revision</span> 
kubectl rollout undo deployment/frontend                         <span style=color:#75715e># Rollback to the previous deployment</span>
kubectl rollout undo deployment/frontend --to-revision<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>         <span style=color:#75715e># Rollback to a specific revision</span>
kubectl rollout status -w deployment/frontend                    <span style=color:#75715e># Watch rolling update status of &#34;frontend&#34; deployment until completion</span>


<span style=color:#75715e>## deprecated starting version 1.11</span>
kubectl rolling-update frontend-v1 -f frontend-v2.json           <span style=color:#75715e># (deprecated) Rolling update pods of frontend-v1</span>
kubectl rolling-update frontend-v1 frontend-v2 --image<span style=color:#f92672>=</span>image:v2  <span style=color:#75715e># (deprecated) Change the name of the resource and update the image</span>
kubectl rolling-update frontend --image<span style=color:#f92672>=</span>image:v2                 <span style=color:#75715e># (deprecated) Update the pods image of frontend</span>
kubectl rolling-update frontend-v1 frontend-v2 --rollback        <span style=color:#75715e># (deprecated) Abort existing rollout in progress</span>

cat pod.json | kubectl replace -f -                              <span style=color:#75715e># Replace a pod based on the JSON passed into std</span>

<span style=color:#75715e>## Force replace, delete and then re-create the resource. Will cause a service outage.</span>
kubectl replace --force -f ./pod.json

<span style=color:#75715e>## Create a service for a replicated nginx, which serves on port 80 and connects to the containers on port 8000</span>
kubectl expose rc nginx --port<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span> --target-port<span style=color:#f92672>=</span><span style=color:#ae81ff>8000</span>

<span style=color:#75715e>## Update a single-container pod&#39;s image version (tag) to v4</span>
kubectl get pod mypod -o yaml | sed <span style=color:#e6db74>&#39;s/\(image: myimage\):.*$/\1:v4/&#39;</span> | kubectl replace -f -

kubectl label pods my-pod new-label<span style=color:#f92672>=</span>awesome                      <span style=color:#75715e># Add a Label</span>
kubectl annotate pods my-pod icon-url<span style=color:#f92672>=</span>http://goo.gl/XXBTWq       <span style=color:#75715e># Add an annotation</span>
kubectl autoscale deployment foo --min<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> --max<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>                <span style=color:#75715e># Auto scale a deployment &#34;foo&#34;</span>
</code></pre></div><h2 id=patching-resources>Patching Resources
<a class=heading-link href=#patching-resources><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>## Partially update a node</span>
kubectl patch node k8s-node-1 -p <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;unschedulable&#34;:true}}&#39;</span>

<span style=color:#75715e>## Update a container&#39;s image; spec.containers[*].name is required because it&#39;s a merge key</span>
kubectl patch pod valid-pod -p <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;containers&#34;:[{&#34;name&#34;:&#34;kubernetes-serve-hostname&#34;,&#34;image&#34;:&#34;new image&#34;}]}}&#39;</span>

<span style=color:#75715e>## Update a container&#39;s image using a json patch with positional arrays</span>
kubectl patch pod valid-pod --type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;json&#39;</span> -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/containers/0/image&#34;, &#34;value&#34;:&#34;new image&#34;}]&#39;</span>

<span style=color:#75715e>## Disable a deployment livenessProbe using a json patch with positional arrays</span>
kubectl patch deployment valid-deployment  --type json   -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[{&#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/livenessProbe&#34;}]&#39;</span>

<span style=color:#75715e>## Add a new element to a positional array</span>
kubectl patch sa default --type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;json&#39;</span> -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[{&#34;op&#34;: &#34;add&#34;, &#34;path&#34;: &#34;/secrets/1&#34;, &#34;value&#34;: {&#34;name&#34;: &#34;whatever&#34; } }]&#39;</span>
</code></pre></div><h2 id=editing-resources>Editing Resources
<a class=heading-link href=#editing-resources><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Edit any API resource in your preferred editor.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl edit svc/docker-registry                      <span style=color:#75715e># Edit the service named docker-registry</span>
KUBE_EDITOR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nano&#34;</span> kubectl edit svc/docker-registry   <span style=color:#75715e># Use an alternative editor</span>
</code></pre></div><h2 id=scaling-resources>Scaling Resources
<a class=heading-link href=#scaling-resources><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> rs/foo                                 <span style=color:#75715e># Scale a replicaset named &#39;foo&#39; to 3</span>
kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> -f foo.yaml                            <span style=color:#75715e># Scale a resource specified in &#34;foo.yaml&#34; to 3</span>
kubectl scale --current-replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> deployment/mysql  <span style=color:#75715e># If the deployment named mysql&#39;s current size is 2, scale mysql to 3</span>
kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> rc/foo rc/bar rc/baz                   <span style=color:#75715e># Scale multiple replication controllers</span>
</code></pre></div><h2 id=deleting-resources>Deleting Resources
<a class=heading-link href=#deleting-resources><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl delete -f ./pod.json                                              <span style=color:#75715e># Delete a pod using the type and name specified in pod.json</span>
kubectl delete pod,service baz foo                                        <span style=color:#75715e># Delete pods and services with same names &#34;baz&#34; and &#34;foo&#34;</span>
kubectl delete pods,services -l name<span style=color:#f92672>=</span>myLabel                              <span style=color:#75715e># Delete pods and services with label name=myLabel</span>
kubectl -n my-ns delete pod,svc --all                                      <span style=color:#75715e># Delete all pods and services in namespace my-ns,</span>
<span style=color:#75715e>## Delete all pods matching the awk pattern1 or pattern2</span>
kubectl get pods  -n mynamespace --no-headers<span style=color:#f92672>=</span>true | awk <span style=color:#e6db74>&#39;/pattern1|pattern2/{print $1}&#39;</span> | xargs  kubectl delete -n mynamespace pod
</code></pre></div><h2 id=interacting-with-running-pods>Interacting with running Pods
<a class=heading-link href=#interacting-with-running-pods><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl logs my-pod                                 <span style=color:#75715e># dump pod logs (stdout)</span>
kubectl logs -l name<span style=color:#f92672>=</span>myLabel                        <span style=color:#75715e># dump pod logs, with label name=myLabel (stdout)</span>
kubectl logs my-pod --previous                      <span style=color:#75715e># dump pod logs (stdout) for a previous instantiation of a container</span>
kubectl logs my-pod -c my-container                 <span style=color:#75715e># dump pod container logs (stdout, multi-container case)</span>
kubectl logs -l name<span style=color:#f92672>=</span>myLabel -c my-container        <span style=color:#75715e># dump pod logs, with label name=myLabel (stdout)</span>
kubectl logs my-pod -c my-container --previous      <span style=color:#75715e># dump pod container logs (stdout, multi-container case) for a previous instantiation of a container</span>
kubectl logs -f my-pod                              <span style=color:#75715e># stream pod logs (stdout)</span>
kubectl logs -f my-pod -c my-container              <span style=color:#75715e># stream pod container logs (stdout, multi-container case)</span>
kubectl logs -f -l name<span style=color:#f92672>=</span>myLabel --all-containers    <span style=color:#75715e># stream all pods logs with label name=myLabel (stdout)</span>
kubectl run -i --tty busybox --image<span style=color:#f92672>=</span>busybox -- sh  <span style=color:#75715e># Run pod as interactive shell</span>
kubectl run nginx --image<span style=color:#f92672>=</span>nginx --restart<span style=color:#f92672>=</span>Never -n 
mynamespace                                         <span style=color:#75715e># Run pod nginx in a specific namespace</span>
kubectl run nginx --image<span style=color:#f92672>=</span>nginx --restart<span style=color:#f92672>=</span>Never     <span style=color:#75715e># Run pod nginx and write its spec into a file called pod.yaml</span>
--dry-run -o yaml &gt; pod.yaml

kubectl attach my-pod -i                            <span style=color:#75715e># Attach to Running Container</span>
kubectl port-forward my-pod 5000:6000               <span style=color:#75715e># Listen on port 5000 on the local machine and forward to port 6000 on my-pod</span>
kubectl exec my-pod -- ls /                         <span style=color:#75715e># Run command in existing pod (1 container case)</span>
kubectl exec my-pod -c my-container -- ls /         <span style=color:#75715e># Run command in existing pod (multi-container case)</span>
kubectl top pod POD_NAME --containers               <span style=color:#75715e># Show metrics for a given pod and its containers</span>
</code></pre></div><h2 id=interacting-with-nodes-and-cluster>Interacting with Nodes and Cluster
<a class=heading-link href=#interacting-with-nodes-and-cluster><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl cordon my-node                                                <span style=color:#75715e># Mark my-node as unschedulable</span>
kubectl drain my-node                                                 <span style=color:#75715e># Drain my-node in preparation for maintenance</span>
kubectl uncordon my-node                                              <span style=color:#75715e># Mark my-node as schedulable</span>
kubectl top node my-node                                              <span style=color:#75715e># Show metrics for a given node</span>
kubectl cluster-info                                                  <span style=color:#75715e># Display addresses of the master and services</span>
kubectl cluster-info dump                                             <span style=color:#75715e># Dump current cluster state to stdout</span>
kubectl cluster-info dump --output-directory<span style=color:#f92672>=</span>/path/to/cluster-state   <span style=color:#75715e># Dump current cluster state to /path/to/cluster-state</span>

<span style=color:#75715e>## If a taint with that key and effect already exists, its value is replaced as specified.</span>
kubectl taint nodes foo dedicated<span style=color:#f92672>=</span>special-user:NoSchedule
</code></pre></div><h3 id=resource-types>Resource types
<a class=heading-link href=#resource-types><i class="fa fa-link" aria-hidden=true></i></a></h3><p>List all supported resource types along with their shortnames, <a href=https://kubernetes.io/docs/concepts/overview/kubernetes-api/#api-groups>API group</a>, whether they are <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces>namespaced</a>, and <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects>Kind</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl api-resources
</code></pre></div><p>Other operations for exploring API resources:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl api-resources --namespaced<span style=color:#f92672>=</span>true      <span style=color:#75715e># All namespaced resources</span>
kubectl api-resources --namespaced<span style=color:#f92672>=</span>false     <span style=color:#75715e># All non-namespaced resources</span>
kubectl api-resources -o name                <span style=color:#75715e># All resources with simple output (just the resource name)</span>
kubectl api-resources -o wide                <span style=color:#75715e># All resources with expanded (aka &#34;wide&#34;) output</span>
kubectl api-resources --verbs<span style=color:#f92672>=</span>list,get       <span style=color:#75715e># All resources that support the &#34;list&#34; and &#34;get&#34; request verbs</span>
kubectl api-resources --api-group<span style=color:#f92672>=</span>extensions <span style=color:#75715e># All resources in the &#34;extensions&#34; API group</span>
</code></pre></div><h3 id=formatting-output>Formatting output
<a class=heading-link href=#formatting-output><i class="fa fa-link" aria-hidden=true></i></a></h3><p>To output details to your terminal window in a specific format, add the <code>-o</code> (or <code>--output</code>) flag to a supported <code>kubectl</code> command.</p><table><thead><tr><th align=left>Output format</th><th align=left>Description</th></tr></thead><tbody><tr><td align=left><code>-o=custom-columns=</code></td><td align=left>Print a table using a comma separated list of custom columns</td></tr><tr><td align=left><code>-o=custom-columns-file=</code></td><td align=left>Print a table using the custom columns template in the `` file |</td></tr><tr><td align=left><code>-o=json</code></td><td align=left>Output a JSON formatted API object</td></tr><tr><td align=left>`-o=jsonpath= | Print the fields defined in a <a href=https://kubernetes.io/docs/reference/kubectl/jsonpath>jsonpath</a> expression |</td><td></td></tr><tr><td align=left><code>-o=jsonpath-file=</code></td><td align=left>Print the fields defined by the <a href=https://kubernetes.io/docs/reference/kubectl/jsonpath>jsonpath</a> expression in the `` file |</td></tr><tr><td align=left><code>-o=name</code></td><td align=left>Print only the resource name and nothing else</td></tr><tr><td align=left><code>-o=wide</code></td><td align=left>Output in the plain-text format with any additional information, and for pods, the node name is included</td></tr><tr><td align=left><code>-o=yaml</code></td><td align=left>Output a YAML formatted API object</td></tr></tbody></table><h3 id=kubectl-output-verbosity-and-debugging>Kubectl output verbosity and debugging
<a class=heading-link href=#kubectl-output-verbosity-and-debugging><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Kubectl verbosity is controlled with the <code>-v</code> or <code>--v</code> flags followed by an integer representing the log level. General Kubernetes logging conventions and the associated log levels are described <a href=https://github.com/kubernetes/community/blob/master/contributors/devel/sig-instrumentation/logging.md>here</a>.</p><table><thead><tr><th align=left>Verbosity</th><th align=left>Description</th></tr></thead><tbody><tr><td align=left><code>--v=0</code></td><td align=left>Generally useful for this to <em>always</em> be visible to a cluster operator.</td></tr><tr><td align=left><code>--v=1</code></td><td align=left>A reasonable default log level if you don’t want verbosity.</td></tr><tr><td align=left><code>--v=2</code></td><td align=left>Useful steady state information about the service and important log messages that may correlate to significant changes in the system. This is the recommended default log level for most systems.</td></tr><tr><td align=left><code>--v=3</code></td><td align=left>Extended information about changes.</td></tr><tr><td align=left><code>--v=4</code></td><td align=left>Debug level verbosity.</td></tr><tr><td align=left><code>--v=6</code></td><td align=left>Display requested resources.</td></tr><tr><td align=left><code>--v=7</code></td><td align=left>Display HTTP request headers.</td></tr><tr><td align=left><code>--v=8</code></td><td align=left>Display HTTP request contents.</td></tr><tr><td align=left><code>--v=9</code></td><td align=left>Display HTTP request contents without truncation of contents.</td></tr></tbody></table><h2 id=设置ingress白名单>设置ingress白名单
<a class=heading-link href=#%e8%ae%be%e7%bd%aeingress%e7%99%bd%e5%90%8d%e5%8d%95><i class="fa fa-link" aria-hidden=true></i></a></h2><pre><code>nginx.ingress.kubernetes.io/whitelist-source-range: &quot;36.110.118.82/24,121.69.105.41,121.69.105.42,121.69.105.43,121.69.105.44,121.69.105.45,121.69.105.46,219.238.3.216/29,219.238.3.215,116.228.226.134,112.64.125.48/28,218.70.10.74,121.35.249.161,202.103.151.81,121.69.79.18&quot;
</code></pre><div id=vcomments></div></article></section></div></main><script src=/js/coder.min.a350362441276ec5c1671926420497bb8e52b63ead1d51d3c9bc4342d0039526.js integrity="sha256-o1A2JEEnbsXBZxkmQgSXu45Stj6tHVHTybxDQtADlSY="></script><script src=/js/custom.js></script><script src=/js/font.min.js></script></body></html>