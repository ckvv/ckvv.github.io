---
title: "virtual-list-implementation.mdx"
tags: ['JavaScript']
date: "2025/01/21"
---

虚拟滚动 是一种优化页面性能的技术，用于处理大量列表或表格数据时，提升用户体验并减少浏览器资源消耗。  
传统的滚动方式是将所有数据一次性渲染到页面上，即使用户只查看其中的一小部分数据。这样会导致页面加载速度慢、内存占用高，特别是在数据量非常大的情况下, 一次性创建大量 DOM 节点，会导致浏览器性能下降。
而虚拟滚动的核心思想是只渲染当前可视区域内的数据，而不是将所有数据都渲染到页面中。当用户滚动页面时，新的数据会动态加载和渲染，同时不再显示已滚动出视窗的数据。这种方式能够显著减少DOM元素的数量

## 虚拟列表实现

+ 仅渲染可视区域的元素：仅渲染用户可见的部分，而其余部分不被渲染。
+ 动态加载数据：当用户滚动页面时，新的元素会被添加到可视区域，旧的元素会被移除。
+ 计算元素的高度/宽度：虚拟滚动需要了解每个元素的高度或宽度，通常会采用“预占位”技术，即为不可见的元素分配空间，保持页面的布局
+ 滚动事件监听：监听滚动条位置，根据视口的位置决定加载哪些数据并更新 DOM 结构。


## 虚拟滚动组件代码

下方是一个简单的虚拟滚动组件代码实现

```vue
<script setup lang="ts">
import { computed, ref } from 'vue';

const props = defineProps<{
  items: any[];
  itemSize: number;
  buffer: number;
}>();

const startIndex = ref(0);

const pool = computed(() => {
  return props.items.slice(startIndex.value, startIndex.value + props.buffer);
});

const computedTotalHeight = computed(() => {
  return props.items.length * props.itemSize;
});

const computedTop = computed(() => {
  return startIndex.value * props.itemSize;
});

function handleScroll(e: Event) {
  const target = e.target as HTMLElement
  if (target) {
    startIndex.value = target.scrollTop / props.itemSize;
  }
}
</script>

<template>
  <div class="recycle-scroller" @scroll="handleScroll">
    <div :style="{ height: `${computedTotalHeight}px` }">
      <div :style="{ transform: `translateY(${computedTop}px)` }">
        <template v-for="item in pool">
          <slot :item="item" />
        </template>
      </div>
    </div>
  </div>
</template>
```
## 测试代码

```vue
<script setup lang="ts">
import { computed, ref } from 'vue';

const length = ref(10000);

const items = computed(() => {
  return Array.from({length: length.value}).map((v, index) => ({ id: index, value: Math.random()}));
});
</script>

<template>
  <RecycleScroller
    v-slot="{ item }"
    class="h-[240px] overflow-auto"
    :buffer="20"
    :items="items"
    :item-size="24"
  >
    <div class="color-red h-[24px]">
      <span>
        {{ item.id }}: {{ item.value }}
      </span>
    </div>
  </RecycleScroller>
</template>
```

## 你可以打开下方的链接中查看效果  
https://ckvv.github.io/vue-project/#/virtualscroller









