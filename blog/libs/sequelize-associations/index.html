<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><meta name="generator" content="Astro v5.1.1"><!-- Canonical URL --><link rel="canonical" href="https://chenkai.life/blog/libs/sequelize-associations/"><!-- Primary Meta Tags --><title>sequelize建立表关系</title><meta name="title" content="sequelize建立表关系"><meta name="description" content="Welcome to my website!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://chenkai.life/blog/libs/sequelize-associations/"><meta property="og:title" content="sequelize建立表关系"><meta property="og:description" content="Welcome to my website!"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://chenkai.life/blog/libs/sequelize-associations/"><meta property="twitter:title" content="sequelize建立表关系"><meta property="twitter:description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/about.BEGiXST_.css">
<style>[data-astro-image]{width:100%;height:auto;-o-object-fit:var(--fit);object-fit:var(--fit);-o-object-position:var(--pos);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body class="flex flex-col"> <header class="sticky top-0 px-4 bg-white opacity-1 z-10 shadow-md"> <nav class="w-full max-w-6xl m-auto elect-none flex justify-between items-center text-2xl my-4"> <div class="flex gap-2 md:gap-4 items-center"> <h2><a href="/">CK&#39;s Blog</a></h2> </div> <div class="flex gap-2 md:gap-4"> <a href="/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Home <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/tag" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Tag <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/assets" class="group clink cursor-pointer shrink-0 select-none relative flex items-center hidden md:inline"> Assets <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/about" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> About <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="https://github.com/ckvv/ckvv.github.io" target="_blank" aria-label="GitHub" class="hidden md:inline"> <svg viewBox="0 0 32 32" role="img" width="32" height="32" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16 0C7.16 0 0 7.16 0 16C0 23.08 4.58 29.06 10.94 31.18C11.74 31.32 12.04 30.84 12.04 30.42C12.04 30.04 12.02 28.78 12.02 27.44C8 28.18 6.96 26.46 6.64 25.56C6.46 25.1 5.68 23.68 5 23.3C4.44 23 3.64 22.26 4.98 22.24C6.24 22.22 7.14 23.4 7.44 23.88C8.88 26.3 11.18 25.62 12.1 25.2C12.24 24.16 12.66 23.46 13.12 23.06C9.56 22.66 5.84 21.28 5.84 15.16C5.84 13.42 6.46 11.98 7.48 10.86C7.32 10.46 6.76 8.82 7.64 6.62C7.64 6.62 8.98 6.2 12.04 8.26C13.32 7.9 14.68 7.72 16.04 7.72C17.4 7.72 18.76 7.9 20.04 8.26C23.1 6.18 24.44 6.62 24.44 6.62C25.32 8.82 24.76 10.46 24.6 10.86C25.62 11.98 26.24 13.4 26.24 15.16C26.24 21.3 22.5 22.66 18.94 23.06C19.52 23.56 20.02 24.52 20.02 26.02C20.02 28.16 20 29.88 20 30.42C20 30.84 20.3 31.34 21.1 31.18C27.42 29.06 32 23.06 32 16C32 7.16 24.84 0 16 0V0Z" fill="#24292E" />
</svg> </a> </div> </nav> </header> <main class="w-full max-w-5xl mx-auto px-4 py-8 flex-grow">  <h1 class="text-4xl font-bold my-4">sequelize建立表关系</h1> <div class="my-2 flex justify-between"> <div class="flex gap-4">  </div> <span> 2021/07/06 </span> </div> <div class="content"> <h1 id="associations">Associations</h1>
<p>Sequelize supports the standard associations: <a href="https://en.wikipedia.org/wiki/One-to-one_(data_model)">One-To-One</a>, <a href="https://en.wikipedia.org/wiki/One-to-many_(data_model)">One-To-Many</a> and <a href="https://en.wikipedia.org/wiki/Many-to-many_(data_model)">Many-To-Many</a>.</p>
<p>To do this, Sequelize provides <strong>four</strong> types of associations that should be combined to create them:</p>
<ul>
<li>The <code>HasOne</code> association</li>
<li>The <code>BelongsTo</code> association</li>
<li>The <code>HasMany</code> association</li>
<li>The <code>BelongsToMany</code> association</li>
</ul>
<p>The guide will start explaining how to define these four types of associations, and then will follow up to explain how to combine those to define the three standard association types (<a href="https://en.wikipedia.org/wiki/One-to-one_(data_model)">One-To-One</a>, <a href="https://en.wikipedia.org/wiki/One-to-many_(data_model)">One-To-Many</a> and <a href="https://en.wikipedia.org/wiki/Many-to-many_(data_model)">Many-To-Many</a>).</p>
<h2 id="defining-the-sequelize-associations">Defining the Sequelize associations</h2>
<p>The four association types are defined in a very similar way. Let’s say we have two models, <code>A</code> and <code>B</code>. Telling Sequelize that you want an association between the two needs just a function call:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> A</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'A'</span><span style="color:#6A737D"> /* ... */</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> B</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'B'</span><span style="color:#6A737D"> /* ... */</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// A HasOne B</span></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// A BelongsTo B</span></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">hasMany</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// A HasMany B</span></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">, { through: </span><span style="color:#9ECBFF">'C'</span><span style="color:#E1E4E8"> }); </span><span style="color:#6A737D">// A BelongsToMany B through the junction table C</span></span></code></pre>
<p>They all accept an options object as a second parameter (optional for the first three, mandatory for <code>belongsToMany</code> containing at least the <code>through</code> property):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#6A737D">  /* options */</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#6A737D">  /* options */</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">hasMany</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#6A737D">  /* options */</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#79B8FF">A</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">B</span><span style="color:#E1E4E8">, { through: </span><span style="color:#9ECBFF">'C'</span><span style="color:#6A737D"> /* options */</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<p>The order in which the association is defined is relevant. In other words, the order matters, for the four cases. In all examples above, <code>A</code> is called the <strong>source</strong> model and <code>B</code> is called the <strong>target</strong> model. This terminology is important.</p>
<p>The <code>A.hasOne(B)</code> association means that a One-To-One relationship exists between <code>A</code> and <code>B</code>, with the foreign key being defined in the target model (<code>B</code>).</p>
<p>The <code>A.belongsTo(B)</code> association means that a One-To-One relationship exists between <code>A</code> and <code>B</code>, with the foreign key being defined in the source model (<code>A</code>).</p>
<p>The <code>A.hasMany(B)</code> association means that a One-To-Many relationship exists between <code>A</code> and <code>B</code>, with the foreign key being defined in the target model (<code>B</code>).</p>
<p>These three calls will cause Sequelize to automatically add foreign keys to the appropriate models (unless they are already present).</p>
<p>The <code>A.belongsToMany(B, { through: 'C' })</code> association means that a Many-To-Many relationship exists between <code>A</code> and <code>B</code>, using table <code>C</code> as <a href="https://en.wikipedia.org/wiki/Associative_entity">junction table</a>, which will have the foreign keys (<code>aId</code> and <code>bId</code>, for example). Sequelize will automatically create this model <code>C</code> (unless it already exists) and define the appropriate foreign keys on it.</p>
<p><em>Note: In the examples above for <code>belongsToMany</code>, a string (<code>'C'</code>) was passed to the through option. In this case, Sequelize automatically generates a model with this name. However, you can also pass a model directly, if you have already defined it.</em></p>
<p>These are the main ideas involved in each type of association. However, these relationships are often used in pairs, in order to enable better usage with Sequelize. This will be seen later on.</p>
<h2 id="creating-the-standard-relationships">Creating the standard relationships</h2>
<p>As mentioned, usually the Sequelize associations are defined in pairs. In summary:</p>
<ul>
<li>
<p>To create a <strong>One-To-One</strong> relationship, the <code>hasOne</code> and <code>belongsTo</code> associations are used together;</p>
</li>
<li>
<p>To create a <strong>One-To-Many</strong> relationship, the <code>hasMany</code> and <code>belongsTo</code> associations are used together;</p>
</li>
<li>
<p>To create a</p>
<p>Many-To-Many</p>
<p>relationship, two</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>belongsToMany</span></span></code></pre>
<p>calls are used together.</p>
<ul>
<li>Note: there is also a <em>Super Many-To-Many</em> relationship, which uses six associations at once, and will be discussed in the <a href="https://sequelize.org/master/manual/advanced-many-to-many.html">Advanced Many-to-Many relationships guide</a>.</li>
</ul>
</li>
</ul>
<p>This will all be seen in detail next. The advantages of using these pairs instead of one single association will be discussed in the end of this chapter.</p>
<h2 id="one-to-one-relationships">One-To-One relationships</h2>
<h3 id="philosophy">Philosophy</h3>
<p>Before digging into the aspects of using Sequelize, it is useful to take a step back to consider what happens with a One-To-One relationship.</p>
<p>Let’s say we have two models, <code>Foo</code> and <code>Bar</code>. We want to establish a One-To-One relationship between Foo and Bar. We know that in a relational Database, this will be done by establishing a foreign key in one of the tables. So in this case, a very relevant question is: in which table do we want this foreign key to be? In other words, do we want <code>Foo</code> to have a <code>barId</code> column, or should <code>Bar</code> have a <code>fooId</code> column instead?</p>
<p>In principle, both options are a valid way to establish a One-To-One relationship between Foo and Bar. However, when we say something like <em>“there is a One-To-One relationship between Foo and Bar”</em>, it is unclear whether or not the relationship is <em>mandatory</em> or optional. In other words, can a Foo exist without a Bar? Can a Bar exist without a Foo? The answers to these questions helps figuring out where we want the foreign key column to be.</p>
<h3 id="goal">Goal</h3>
<p>For the rest of this example, let’s assume that we have two models, <code>Foo</code> and <code>Bar</code>. We want to setup a One-To-One relationship between them such that <code>Bar</code> gets a <code>fooId</code> column.</p>
<h3 id="implementation">Implementation</h3>
<p>The main setup to achieve the goal is as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar);</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo);</span></span></code></pre>
<p>Since no option was passed, Sequelize will infer what to do from the names of the models. In this case, Sequelize knows that a <code>fooId</code> column must be added to <code>Bar</code>.</p>
<p>This way, calling <code>Bar.sync()</code> after the above will yield the following SQL (on PostgreSQL, for example):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#F97583">CREATE</span><span style="color:#F97583"> TABLE</span><span style="color:#B392F0"> IF</span><span style="color:#F97583"> NOT</span><span style="color:#F97583"> EXISTS</span><span style="color:#9ECBFF"> "foos"</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#6A737D">  /* ... */</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">CREATE</span><span style="color:#F97583"> TABLE</span><span style="color:#B392F0"> IF</span><span style="color:#F97583"> NOT</span><span style="color:#F97583"> EXISTS</span><span style="color:#9ECBFF"> "bars"</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#6A737D">  /* ... */</span></span>
<span class="line"><span style="color:#9ECBFF">  "fooId"</span><span style="color:#F97583"> INTEGER</span><span style="color:#F97583"> REFERENCES</span><span style="color:#9ECBFF"> "foos"</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">ON DELETE</span><span style="color:#F97583"> SET</span><span style="color:#F97583"> NULL</span><span style="color:#F97583"> ON</span><span style="color:#F97583"> UPDATE</span><span style="color:#E1E4E8"> CASCADE</span></span>
<span class="line"><span style="color:#6A737D">  /* ... */</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<h3 id="options">Options</h3>
<p>Various options can be passed as a second parameter of the association call.</p>
<h4 id="ondelete-and-onupdate"><code>onDelete</code> and <code>onUpdate</code></h4>
<p>For example, to configure the <code>ON DELETE</code> and <code>ON UPDATE</code> behaviors, you can do:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar, {</span></span>
<span class="line"><span style="color:#E1E4E8">  onDelete: </span><span style="color:#9ECBFF">'RESTRICT'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  onUpdate: </span><span style="color:#9ECBFF">'RESTRICT'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo);</span></span></code></pre>
<p>The possible choices are <code>RESTRICT</code>, <code>CASCADE</code>, <code>NO ACTION</code>, <code>SET DEFAULT</code> and <code>SET NULL</code>.</p>
<p>The defaults for the One-To-One associations is <code>SET NULL</code> for <code>ON DELETE</code> and <code>CASCADE</code> for <code>ON UPDATE</code>.</p>
<h4 id="customizing-the-foreign-key">Customizing the foreign key</h4>
<p>Both the <code>hasOne</code> and <code>belongsTo</code> calls shown above will infer that the foreign key to be created should be called <code>fooId</code>. To use a different name, such as <code>myFooId</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// Option 1</span></span>
<span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: </span><span style="color:#9ECBFF">'myFooId'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Option 2</span></span>
<span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: </span><span style="color:#9ECBFF">'myFooId'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Option 3</span></span>
<span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar);</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: </span><span style="color:#9ECBFF">'myFooId'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Option 4</span></span>
<span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar);</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: </span><span style="color:#9ECBFF">'myFooId'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>As shown above, the <code>foreignKey</code> option accepts a string or an object. When receiving an object, this object will be used as the definition for the column just like it would do in a standard <code>sequelize.define</code> call. Therefore, specifying options such as <code>type</code>, <code>allowNull</code>, <code>defaultValue</code>, etc, just work.</p>
<p>For example, to use <code>UUID</code> as the foreign key data type instead of the default (<code>INTEGER</code>), you can simply do:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">DataTypes</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#B392F0"> require</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Sequelize'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: {</span></span>
<span class="line"><span style="color:#6A737D">    // name: 'myFooId'</span></span>
<span class="line"><span style="color:#E1E4E8">    type: DataTypes.</span><span style="color:#79B8FF">UUID</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Foo);</span></span></code></pre>
<h4 id="mandatory-versus-optional-associations">Mandatory versus optional associations</h4>
<p>By default, the association is considered optional. In other words, in our example, the <code>fooId</code> is allowed to be null, meaning that one Bar can exist without a Foo. Changing this is just a matter of specifying <code>allowNull: false</code> in the foreign key options:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: {</span></span>
<span class="line"><span style="color:#E1E4E8">    allowNull: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#6A737D">// "fooId" INTEGER NOT NULL REFERENCES "foos" ("id") ON DELETE RESTRICT ON UPDATE RESTRICT</span></span></code></pre>
<h2 id="one-to-many-relationships">One-To-Many relationships</h2>
<h3 id="philosophy-1">Philosophy</h3>
<p>One-To-Many associations are connecting one source with multiple targets, while all these targets are connected only with this single source.</p>
<p>This means that, unlike the One-To-One association, in which we had to choose where the foreign key would be placed, there is only one option in One-To-Many associations. For example, if one Foo has many Bars (and this way each Bar belongs to one Foo), then the only sensible implementation is to have a <code>fooId</code> column in the <code>Bar</code> table. The opposite is impossible, since one Foo has many Bars.</p>
<h3 id="goal-1">Goal</h3>
<p>In this example, we have the models <code>Team</code> and <code>Player</code>. We want to tell Sequelize that there is a One-To-Many relationship between them, meaning that one Team has many Players, while each Player belongs to a single Team.</p>
<h3 id="implementation-1">Implementation</h3>
<p>The main way to do this is as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Team.</span><span style="color:#B392F0">hasMany</span><span style="color:#E1E4E8">(Player);</span></span>
<span class="line"><span style="color:#E1E4E8">Player.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Team);</span></span></code></pre>
<p>Again, as mentioned, the main way to do it used a pair of Sequelize associations (<code>hasMany</code> and <code>belongsTo</code>).</p>
<p>For example, in PostgreSQL, the above setup will yield the following SQL upon <code>sync()</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#F97583">CREATE</span><span style="color:#F97583"> TABLE</span><span style="color:#B392F0"> IF</span><span style="color:#F97583"> NOT</span><span style="color:#F97583"> EXISTS</span><span style="color:#9ECBFF"> "Teams"</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#6A737D">  /* ... */</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">CREATE</span><span style="color:#F97583"> TABLE</span><span style="color:#B392F0"> IF</span><span style="color:#F97583"> NOT</span><span style="color:#F97583"> EXISTS</span><span style="color:#9ECBFF"> "Players"</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#6A737D">  /* ... */</span></span>
<span class="line"><span style="color:#9ECBFF">  "TeamId"</span><span style="color:#F97583"> INTEGER</span><span style="color:#F97583"> REFERENCES</span><span style="color:#9ECBFF"> "Teams"</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">ON DELETE</span><span style="color:#F97583"> SET</span><span style="color:#F97583"> NULL</span><span style="color:#F97583"> ON</span><span style="color:#F97583"> UPDATE</span><span style="color:#E1E4E8"> CASCADE,</span></span>
<span class="line"><span style="color:#6A737D">  /* ... */</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<h3 id="options-1">Options</h3>
<p>The options to be applied in this case are the same from the One-To-One case. For example, to change the name of the foreign key and make sure that the relationship is mandatory, we can do:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Team.</span><span style="color:#B392F0">hasMany</span><span style="color:#E1E4E8">(Player, {</span></span>
<span class="line"><span style="color:#E1E4E8">  foreignKey: </span><span style="color:#9ECBFF">'clubId'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">Player.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Team);</span></span></code></pre>
<p>Like One-To-One relationships, <code>ON DELETE</code> defaults to <code>SET NULL</code> and <code>ON UPDATE</code> defaults to <code>CASCADE</code>.</p>
<h2 id="many-to-many-relationships">Many-To-Many relationships</h2>
<h3 id="philosophy-2">Philosophy</h3>
<p>Many-To-Many associations connect one source with multiple targets, while all these targets can in turn be connected to other sources beyond the first.</p>
<p>This cannot be represented by adding one foreign key to one of the tables, like the other relationships did. Instead, the concept of a <a href="https://en.wikipedia.org/wiki/Associative_entity">Junction Model</a> is used. This will be an extra model (and extra table in the Database) which will have two foreign key columns and will keep track of the associations. The junction table is also sometimes called <em>join table</em> or <em>through table</em>.</p>
<h3 id="goal-2">Goal</h3>
<p>For this example, we will consider the models <code>Movie</code> and <code>Actor</code>. One actor may have participated in many movies, and one movie had many actors involved with its production. The junction table that will keep track of the associations will be called <code>ActorMovies</code>, which will contain the foreign keys <code>movieId</code> and <code>actorId</code>.</p>
<h3 id="implementation-2">Implementation</h3>
<p>The main way to do this in Sequelize is as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Movie</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Movie'</span><span style="color:#E1E4E8">, { name: DataTypes.</span><span style="color:#79B8FF">STRING</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Actor</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Actor'</span><span style="color:#E1E4E8">, { name: DataTypes.</span><span style="color:#79B8FF">STRING</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">Movie.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Actor, { through: </span><span style="color:#9ECBFF">'ActorMovies'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">Actor.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Movie, { through: </span><span style="color:#9ECBFF">'ActorMovies'</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<p>Since a string was given in the <code>through</code> option of the <code>belongsToMany</code> call, Sequelize will automatically create the <code>ActorMovies</code> model which will act as the junction model. For example, in PostgreSQL:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#F97583">CREATE</span><span style="color:#F97583"> TABLE</span><span style="color:#B392F0"> IF</span><span style="color:#F97583"> NOT</span><span style="color:#F97583"> EXISTS</span><span style="color:#9ECBFF"> "ActorMovies"</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">  "createdAt"</span><span style="color:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#F97583"> NOT NULL</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "updatedAt"</span><span style="color:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#F97583"> NOT NULL</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "MovieId"</span><span style="color:#F97583"> INTEGER</span><span style="color:#F97583"> REFERENCES</span><span style="color:#9ECBFF"> "Movies"</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">ON DELETE CASCADE</span><span style="color:#F97583"> ON</span><span style="color:#F97583"> UPDATE</span><span style="color:#E1E4E8"> CASCADE,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ActorId"</span><span style="color:#F97583"> INTEGER</span><span style="color:#F97583"> REFERENCES</span><span style="color:#9ECBFF"> "Actors"</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">ON DELETE CASCADE</span><span style="color:#F97583"> ON</span><span style="color:#F97583"> UPDATE</span><span style="color:#E1E4E8"> CASCADE,</span></span>
<span class="line"><span style="color:#F97583">  PRIMARY KEY</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"MovieId"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"ActorId"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<p>Instead of a string, passing a model directly is also supported, and in that case the given model will be used as the junction model (and no model will be created automatically). For example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Movie</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Movie'</span><span style="color:#E1E4E8">, { name: DataTypes.</span><span style="color:#79B8FF">STRING</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Actor</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Actor'</span><span style="color:#E1E4E8">, { name: DataTypes.</span><span style="color:#79B8FF">STRING</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ActorMovies</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ActorMovies'</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">  MovieId: {</span></span>
<span class="line"><span style="color:#E1E4E8">    type: DataTypes.</span><span style="color:#79B8FF">INTEGER</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    references: {</span></span>
<span class="line"><span style="color:#E1E4E8">      model: Movie, </span><span style="color:#6A737D">// 'Movies' would also work</span></span>
<span class="line"><span style="color:#E1E4E8">      key: </span><span style="color:#9ECBFF">'id'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  ActorId: {</span></span>
<span class="line"><span style="color:#E1E4E8">    type: DataTypes.</span><span style="color:#79B8FF">INTEGER</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    references: {</span></span>
<span class="line"><span style="color:#E1E4E8">      model: Actor, </span><span style="color:#6A737D">// 'Actors' would also work</span></span>
<span class="line"><span style="color:#E1E4E8">      key: </span><span style="color:#9ECBFF">'id'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">Movie.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Actor, { through: ActorMovies });</span></span>
<span class="line"><span style="color:#E1E4E8">Actor.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Movie, { through: ActorMovies });</span></span></code></pre>
<p>The above yields the following SQL in PostgreSQL, which is equivalent to the one shown above:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#F97583">CREATE</span><span style="color:#F97583"> TABLE</span><span style="color:#B392F0"> IF</span><span style="color:#F97583"> NOT</span><span style="color:#F97583"> EXISTS</span><span style="color:#9ECBFF"> "ActorMovies"</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">  "MovieId"</span><span style="color:#F97583"> INTEGER</span><span style="color:#F97583"> NOT NULL</span><span style="color:#F97583"> REFERENCES</span><span style="color:#9ECBFF"> "Movies"</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">ON DELETE</span><span style="color:#E1E4E8"> RESTRICT </span><span style="color:#F97583">ON</span><span style="color:#F97583"> UPDATE</span><span style="color:#E1E4E8"> CASCADE,</span></span>
<span class="line"><span style="color:#9ECBFF">  "ActorId"</span><span style="color:#F97583"> INTEGER</span><span style="color:#F97583"> NOT NULL</span><span style="color:#F97583"> REFERENCES</span><span style="color:#9ECBFF"> "Actors"</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">ON DELETE</span><span style="color:#E1E4E8"> RESTRICT </span><span style="color:#F97583">ON</span><span style="color:#F97583"> UPDATE</span><span style="color:#E1E4E8"> CASCADE,</span></span>
<span class="line"><span style="color:#9ECBFF">  "createdAt"</span><span style="color:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#F97583"> NOT NULL</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  "updatedAt"</span><span style="color:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#F97583"> NOT NULL</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#F97583">  UNIQUE</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"MovieId"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"ActorId"</span><span style="color:#E1E4E8">),     </span><span style="color:#6A737D">-- Note: Sequelize generated this UNIQUE constraint but</span></span>
<span class="line"><span style="color:#F97583">  PRIMARY KEY</span><span style="color:#E1E4E8"> (</span><span style="color:#9ECBFF">"MovieId"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"ActorId"</span><span style="color:#E1E4E8">)  </span><span style="color:#6A737D">-- it is irrelevant since it's also a PRIMARY KEY</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<h3 id="options-2">Options</h3>
<p>Unlike One-To-One and One-To-Many relationships, the defaults for both <code>ON UPDATE</code> and <code>ON DELETE</code> are <code>CASCADE</code> for Many-To-Many relationships.</p>
<p>Belongs-To-Many creates a unique key on through model. This unique key name can be overridden using <strong>uniqueKey</strong> option. To prevent creating this unique key, use the <strong>*unique: false*</strong> option.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Project.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(User, {</span></span>
<span class="line"><span style="color:#E1E4E8">  through: UserProjects,</span></span>
<span class="line"><span style="color:#E1E4E8">  uniqueKey: </span><span style="color:#9ECBFF">'my_custom_unique'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="basics-of-queries-involving-associations">Basics of queries involving associations</h2>
<p>With the basics of defining associations covered, we can look at queries involving associations. The most common queries on this matter are the <em>read</em> queries (i.e. SELECTs). Later on, other types of queries will be shown.</p>
<p>In order to study this, we will consider an example in which we have Ships and Captains, and a one-to-one relationship between them. We will allow null on foreign keys (the default), meaning that a Ship can exist without a Captain and vice-versa.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// This is the setup of our models for the examples below</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'ship'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    crewCapacity: DataTypes.</span><span style="color:#79B8FF">INTEGER</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    amountOfSails: DataTypes.</span><span style="color:#79B8FF">INTEGER</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Captain</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'captain'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    skillLevel: {</span></span>
<span class="line"><span style="color:#E1E4E8">      type: DataTypes.</span><span style="color:#79B8FF">INTEGER</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      validate: { min: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, max: </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">Captain.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Ship);</span></span>
<span class="line"><span style="color:#E1E4E8">Ship.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Captain);</span></span></code></pre>
<h3 id="fetching-associations---eager-loading-vs-lazy-loading">Fetching associations - Eager Loading vs Lazy Loading</h3>
<p>The concepts of Eager Loading and Lazy Loading are fundamental to understand how fetching associations work in Sequelize. Lazy Loading refers to the technique of fetching the associated data only when you really want it; Eager Loading, on the other hand, refers to the technique of fetching everything at once, since the beginning, with a larger query.</p>
<h4 id="lazy-loading-example">Lazy Loading example</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> awesomeCaptain</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Captain.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  where: {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: </span><span style="color:#9ECBFF">'Jack Sparrow'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#6A737D">// Do stuff with the fetched captain</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Name:'</span><span style="color:#E1E4E8">, awesomeCaptain.name);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Skill Level:'</span><span style="color:#E1E4E8">, awesomeCaptain.skillLevel);</span></span>
<span class="line"><span style="color:#6A737D">// Now we want information about his ship!</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> hisShip</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> awesomeCaptain.</span><span style="color:#B392F0">getShip</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">// Do stuff with the ship</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Ship Name:'</span><span style="color:#E1E4E8">, hisShip.name);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Amount of Sails:'</span><span style="color:#E1E4E8">, hisShip.amountOfSails);</span></span></code></pre>
<p>Observe that in the example above, we made two queries, only fetching the associated ship when we wanted to use it. This can be especially useful if we may or may not need the ship, perhaps we want to fetch it conditionally, only in a few cases; this way we can save time and memory by only fetching it when necessary.</p>
<p>Note: the <code>getShip()</code> instance method used above is one of the methods Sequelize automatically adds to <code>Captain</code> instances. There are others. You will learn more about them later in this guide.</p>
<h4 id="eager-loading-example">Eager Loading Example</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> awesomeCaptain</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Captain.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  where: {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: </span><span style="color:#9ECBFF">'Jack Sparrow'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  include: Ship,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#6A737D">// Now the ship comes with it</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Name:'</span><span style="color:#E1E4E8">, awesomeCaptain.name);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Skill Level:'</span><span style="color:#E1E4E8">, awesomeCaptain.skillLevel);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Ship Name:'</span><span style="color:#E1E4E8">, awesomeCaptain.ship.name);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Amount of Sails:'</span><span style="color:#E1E4E8">, awesomeCaptain.ship.amountOfSails);</span></span></code></pre>
<p>As shown above, Eager Loading is performed in Sequelize by using the <code>include</code> option. Observe that here only one query was performed to the Database (which brings the associated data along with the instance).</p>
<p>This was just a quick introduction to Eager Loading in Sequelize. There is a lot more to it, which you can learn at <a href="https://sequelize.org/master/manual/eager-loading.html">the dedicated guide on Eager Loading</a>.</p>
<h3 id="creating-updating-and-deleting">Creating, updating and deleting</h3>
<p>The above showed the basics on queries for fetching data involving associations. For creating, updating and deleting, you can either:</p>
<ul>
<li>
<p>Use the standard model queries directly:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// Example: creating an associated model using the standard methods</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'My Bar'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  fooId: </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#6A737D">// This creates a Bar belonging to the Foo of ID 5 (since fooId is</span></span>
<span class="line"><span style="color:#6A737D">// a regular column, after all). Nothing very clever going on here.</span></span></code></pre>
</li>
<li>
<p>Or use the <em><a href="https://sequelize.org/master/manual/assocs.html#special-methods-mixins-added-to-instances">special methods/mixins</a></em> available for associated models, which are explained later on this page.</p>
</li>
</ul>
<p><strong>Note:</strong> The <a href="https://sequelize.org/master/class/lib/model.js~Model.html#instance-method-save"><code>save()</code> instance method</a> is not aware of associations. In other words, if you change a value from a <em>child</em> object that was eager loaded along a <em>parent</em> object, calling <code>save()</code> on the parent will completely ignore the change that happened on the child.</p>
<h2 id="association-aliases--custom-foreign-keys">Association Aliases &#x26; Custom Foreign Keys</h2>
<p>In all the above examples, Sequelize automatically defined the foreign key names. For example, in the Ship and Captain example, Sequelize automatically defined a <code>captainId</code> field on the Ship model. However, it is easy to specify a custom foreign key.</p>
<p>Let’s consider the models Ship and Captain in a simplified form, just to focus on the current topic, as shown below (less fields):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'ship'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  { name: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Captain</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'captain'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  { name: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<p>There are three ways to specify a different name for the foreign key:</p>
<ul>
<li>By providing the foreign key name directly</li>
<li>By defining an Alias</li>
<li>By doing both things</li>
</ul>
<h3 id="recap-the-default-setup">Recap: the default setup</h3>
<p>By using simply <code>Ship.belongsTo(Captain)</code>, sequelize will generate the foreign key name automatically:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Ship.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Captain); </span><span style="color:#6A737D">// This creates the `captainId` foreign key in Ship.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Eager Loading is done by passing the model to `include`:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: Captain })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#6A737D">// Or by providing the associated model name:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: </span><span style="color:#9ECBFF">'captain'</span><span style="color:#E1E4E8"> })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Also, instances obtain a `getCaptain()` method for Lazy Loading:</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> ship.</span><span style="color:#B392F0">getCaptain</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span></code></pre>
<h3 id="providing-the-foreign-key-name-directly">Providing the foreign key name directly</h3>
<p>The foreign key name can be provided directly with an option in the association definition, as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Ship.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Captain, { foreignKey: </span><span style="color:#9ECBFF">'bossId'</span><span style="color:#E1E4E8"> }); </span><span style="color:#6A737D">// This creates the `bossId` foreign key in Ship.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Eager Loading is done by passing the model to `include`:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: Captain })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#6A737D">// Or by providing the associated model name:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: </span><span style="color:#9ECBFF">'Captain'</span><span style="color:#E1E4E8"> })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Also, instances obtain a `getCaptain()` method for Lazy Loading:</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> ship.</span><span style="color:#B392F0">getCaptain</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span></code></pre>
<h3 id="defining-an-alias">Defining an Alias</h3>
<p>Defining an Alias is more powerful than simply specifying a custom name for the foreign key. This is better understood with an example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Ship.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Captain, { as: </span><span style="color:#9ECBFF">'leader'</span><span style="color:#E1E4E8"> }); </span><span style="color:#6A737D">// This creates the `leaderId` foreign key in Ship.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Eager Loading no longer works by passing the model to `include`:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: Captain })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// Throws an error</span></span>
<span class="line"><span style="color:#6A737D">// Instead, you have to pass the alias:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: </span><span style="color:#9ECBFF">'leader'</span><span style="color:#E1E4E8"> })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#6A737D">// Or you can pass an object specifying the model and alias:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      include: {</span></span>
<span class="line"><span style="color:#E1E4E8">        model: Captain,</span></span>
<span class="line"><span style="color:#E1E4E8">        as: </span><span style="color:#9ECBFF">'leader'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">  ).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Also, instances obtain a `getLeader()` method for Lazy Loading:</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> ship.</span><span style="color:#B392F0">getLeader</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span></code></pre>
<p>Aliases are especially useful when you need to define two different associations between the same models. For example, if we have the models <code>Mail</code> and <code>Person</code>, we may want to associate them twice, to represent the <code>sender</code> and <code>receiver</code> of the Mail. In this case we must use an alias for each association, since otherwise a call like <code>mail.getPerson()</code> would be ambiguous. With the <code>sender</code> and <code>receiver</code> aliases, we would have the two methods available and working: <code>mail.getSender()</code> and <code>mail.getReceiver()</code>, both of them returning a <code>Promise&#x3C;Person></code>.</p>
<p>When defining an alias for a <code>hasOne</code> or <code>belongsTo</code> association, you should use the singular form of a word (such as <code>leader</code>, in the example above). On the other hand, when defining an alias for <code>hasMany</code> and <code>belongsToMany</code>, you should use the plural form. Defining aliases for Many-to-Many relationships (with <code>belongsToMany</code>) is covered in the <a href="https://sequelize.org/master/manual/advanced-many-to-many.html">Advanced Many-to-Many Associations guide</a>.</p>
<h3 id="doing-both-things">Doing both things</h3>
<p>We can define and alias and also directly define the foreign key:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Ship.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Captain, { as: </span><span style="color:#9ECBFF">'leader'</span><span style="color:#E1E4E8">, foreignKey: </span><span style="color:#9ECBFF">'bossId'</span><span style="color:#E1E4E8"> }); </span><span style="color:#6A737D">// This creates the `bossId` foreign key in Ship.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Since an alias was defined, eager Loading doesn't work by simply passing the model to `include`:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: Captain })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// Throws an error</span></span>
<span class="line"><span style="color:#6A737D">// Instead, you have to pass the alias:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({ include: </span><span style="color:#9ECBFF">'leader'</span><span style="color:#E1E4E8"> })).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#6A737D">// Or you can pass an object specifying the model and alias:</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      include: {</span></span>
<span class="line"><span style="color:#E1E4E8">        model: Captain,</span></span>
<span class="line"><span style="color:#E1E4E8">        as: </span><span style="color:#9ECBFF">'leader'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">  ).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Also, instances obtain a `getLeader()` method for Lazy Loading:</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> ship.</span><span style="color:#B392F0">getLeader</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">());</span></span></code></pre>
<h2 id="special-methodsmixins-added-to-instances">Special methods/mixins added to instances</h2>
<p>When an association is defined between two models, the instances of those models gain special methods to interact with their associated counterparts.</p>
<p>For example, if we have two models, <code>Foo</code> and <code>Bar</code>, and they are associated, their instances will have the following methods/mixins available, depending on the association type:</p>
<h3 id="foohasonebar"><code>Foo.hasOne(Bar)</code></h3>
<ul>
<li><code>fooInstance.getBar()</code></li>
<li><code>fooInstance.setBar()</code></li>
<li><code>fooInstance.createBar()</code></li>
</ul>
<p>Example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> foo</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Foo.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'the-foo'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> bar1</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'some-bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> bar2</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'another-bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">getBar</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// null</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">setBar</span><span style="color:#E1E4E8">(bar1);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">getBar</span><span style="color:#E1E4E8">()).name); </span><span style="color:#6A737D">// 'some-bar'</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">createBar</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'yet-another-bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> newlyAssociatedBar</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">getBar</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(newlyAssociatedBar.name); </span><span style="color:#6A737D">// 'yet-another-bar'</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">setBar</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// Un-associate</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">getBar</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// null</span></span></code></pre>
<h3 id="foobelongstobar"><code>Foo.belongsTo(Bar)</code></h3>
<p>The same ones from <code>Foo.hasOne(Bar)</code>:</p>
<ul>
<li><code>fooInstance.getBar()</code></li>
<li><code>fooInstance.setBar()</code></li>
<li><code>fooInstance.createBar()</code></li>
</ul>
<h3 id="foohasmanybar"><code>Foo.hasMany(Bar)</code></h3>
<ul>
<li><code>fooInstance.getBars()</code></li>
<li><code>fooInstance.countBars()</code></li>
<li><code>fooInstance.hasBar()</code></li>
<li><code>fooInstance.hasBars()</code></li>
<li><code>fooInstance.setBars()</code></li>
<li><code>fooInstance.addBar()</code></li>
<li><code>fooInstance.addBars()</code></li>
<li><code>fooInstance.removeBar()</code></li>
<li><code>fooInstance.removeBars()</code></li>
<li><code>fooInstance.createBar()</code></li>
</ul>
<p>Example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> foo</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Foo.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'the-foo'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> bar1</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'some-bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> bar2</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'another-bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">getBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// []</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">countBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// 0</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">hasBar</span><span style="color:#E1E4E8">(bar1)); </span><span style="color:#6A737D">// false</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">addBars</span><span style="color:#E1E4E8">([bar1, bar2]);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">countBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// 2</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">addBar</span><span style="color:#E1E4E8">(bar1);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">countBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// 2</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">hasBar</span><span style="color:#E1E4E8">(bar1)); </span><span style="color:#6A737D">// true</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">removeBar</span><span style="color:#E1E4E8">(bar2);</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">countBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// 1</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">createBar</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'yet-another-bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">countBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// 2</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">setBars</span><span style="color:#E1E4E8">([]); </span><span style="color:#6A737D">// Un-associate all previously associated bars</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> foo.</span><span style="color:#B392F0">countBars</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// 0</span></span></code></pre>
<p>The getter method accepts options just like the usual finder methods (such as <code>findAll</code>):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> easyTasks</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> project.</span><span style="color:#B392F0">getTasks</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  where: {</span></span>
<span class="line"><span style="color:#E1E4E8">    difficulty: {</span></span>
<span class="line"><span style="color:#E1E4E8">      [Op.lte]: </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> taskTitles</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> project.</span><span style="color:#B392F0">getTasks</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    attributes: [</span><span style="color:#9ECBFF">'title'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    raw: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  })</span></span>
<span class="line"><span style="color:#E1E4E8">).</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">task</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> task.title);</span></span></code></pre>
<h3 id="foobelongstomanybar--through-baz"><code>Foo.belongsToMany(Bar, { through: Baz })</code></h3>
<p>The same ones from <code>Foo.hasMany(Bar)</code>:</p>
<ul>
<li><code>fooInstance.getBars()</code></li>
<li><code>fooInstance.countBars()</code></li>
<li><code>fooInstance.hasBar()</code></li>
<li><code>fooInstance.hasBars()</code></li>
<li><code>fooInstance.setBars()</code></li>
<li><code>fooInstance.addBar()</code></li>
<li><code>fooInstance.addBars()</code></li>
<li><code>fooInstance.removeBar()</code></li>
<li><code>fooInstance.removeBars()</code></li>
<li><code>fooInstance.createBar()</code></li>
</ul>
<h3 id="note-method-names">Note: Method names</h3>
<p>As shown in the examples above, the names Sequelize gives to these special methods are formed by a prefix (e.g. <code>get</code>, <code>add</code>, <code>set</code>) concatenated with the model name (with the first letter in uppercase). When necessary, the plural is used, such as in <code>fooInstance.setBars()</code>. Again, irregular plurals are also handled automatically by Sequelize. For example, <code>Person</code> becomes <code>People</code> and <code>Hypothesis</code> becomes <code>Hypotheses</code>.</p>
<p>If an alias was defined, it will be used instead of the model name to form the method names. For example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Task.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(User, { as: </span><span style="color:#9ECBFF">'Author'</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<ul>
<li><code>taskInstance.getAuthor()</code></li>
<li><code>taskInstance.setAuthor()</code></li>
<li><code>taskInstance.createAuthor()</code></li>
</ul>
<h2 id="why-associations-are-defined-in-pairs">Why associations are defined in pairs?</h2>
<p>As mentioned earlier and shown in most examples above, usually associations in Sequelize are defined in pairs:</p>
<ul>
<li>To create a <strong>One-To-One</strong> relationship, the <code>hasOne</code> and <code>belongsTo</code> associations are used together;</li>
<li>To create a <strong>One-To-Many</strong> relationship, the <code>hasMany</code> and <code>belongsTo</code> associations are used together;</li>
<li>To create a <strong>Many-To-Many</strong> relationship, two <code>belongsToMany</code> calls are used together.</li>
</ul>
<p>When a Sequelize association is defined between two models, only the <em>source</em> model <em>knows about it</em>. So, for example, when using <code>Foo.hasOne(Bar)</code> (so <code>Foo</code> is the source model and <code>Bar</code> is the target model), only <code>Foo</code> knows about the existence of this association. This is why in this case, as shown above, <code>Foo</code> instances gain the methods <code>getBar()</code>, <code>setBar()</code> and <code>createBar()</code>, while on the other hand <code>Bar</code> instances get nothing.</p>
<p>Similarly, for <code>Foo.hasOne(Bar)</code>, since <code>Foo</code> knows about the relationship, we can perform eager loading as in <code>Foo.findOne({ include: Bar })</code>, but we can’t do <code>Bar.findOne({ include: Foo })</code>.</p>
<p>Therefore, to bring full power to Sequelize usage, we usually setup the relationship in pairs, so that both models get to <em>know about it</em>.</p>
<p>Practical demonstration:</p>
<ul>
<li>
<p>If we do not define the pair of associations, calling for example just <code>Foo.hasOne(Bar)</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// This works...</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Foo.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({ include: Bar });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// But this throws an error:</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({ include: Foo });</span></span>
<span class="line"><span style="color:#6A737D">// SequelizeEagerLoadingError: foo is not associated to bar!</span></span></code></pre>
</li>
<li>
<p>If we define the pair as recommended, i.e., both <code>Foo.hasOne(Bar)</code> and <code>Bar.belongsTo(Foo)</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// This works!</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Foo.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({ include: Bar });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// This also works!</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({ include: Foo });</span></span></code></pre>
</li>
</ul>
<h2 id="multiple-associations-involving-the-same-models">Multiple associations involving the same models</h2>
<p>In Sequelize, it is possible to define multiple associations between the same models. You just have to define different aliases for them:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Team.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Game, { as: </span><span style="color:#9ECBFF">'HomeTeam'</span><span style="color:#E1E4E8">, foreignKey: </span><span style="color:#9ECBFF">'homeTeamId'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">Team.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Game, { as: </span><span style="color:#9ECBFF">'AwayTeam'</span><span style="color:#E1E4E8">, foreignKey: </span><span style="color:#9ECBFF">'awayTeamId'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">Game.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Team);</span></span></code></pre>
<h2 id="creating-associations-referencing-a-field-which-is-not-the-primary-key">Creating associations referencing a field which is not the primary key</h2>
<p>In all the examples above, the associations were defined by referencing the primary keys of the involved models (in our case, their IDs). However, Sequelize allows you to define an association that uses another field, instead of the primary key field, to establish the association.</p>
<p>This other field must have a unique constraint on it (otherwise, it wouldn’t make sense).</p>
<h3 id="for-belongsto-relationships">For <code>belongsTo</code> relationships</h3>
<p>First, recall that the <code>A.belongsTo(B)</code> association places the foreign key in the <em>source model</em> (i.e., in <code>A</code>).</p>
<p>Let’s again use the example of Ships and Captains. Additionally, we will assume that Captain names are unique:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Ship</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'ship'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  { name: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Captain</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'captain'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: { type: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">, unique: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<p>This way, instead of keeping the <code>captainId</code> on our Ships, we could keep a <code>captainName</code> instead and use it as our association tracker. In other words, instead of referencing the <code>id</code> from the target model (Captain), our relationship will reference another column on the target model: the <code>name</code> column. To specify this, we have to define a <em>target key</em>. We will also have to specify a name for the foreign key itself:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Ship.</span><span style="color:#B392F0">belongsTo</span><span style="color:#E1E4E8">(Captain, { targetKey: </span><span style="color:#9ECBFF">'name'</span><span style="color:#E1E4E8">, foreignKey: </span><span style="color:#9ECBFF">'captainName'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#6A737D">// This creates a foreign key called `captainName` in the source model (Ship)</span></span>
<span class="line"><span style="color:#6A737D">// which references the `name` field from the target model (Captain).</span></span></code></pre>
<p>Now we can do things like:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Captain.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({ name: </span><span style="color:#9ECBFF">'Jack Sparrow'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ship</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Ship.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'Black Pearl'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  captainName: </span><span style="color:#9ECBFF">'Jack Sparrow'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> ship.</span><span style="color:#B392F0">getCaptain</span><span style="color:#E1E4E8">()).name); </span><span style="color:#6A737D">// "Jack Sparrow"</span></span></code></pre>
<h3 id="for-hasone-and-hasmany-relationships">For <code>hasOne</code> and <code>hasMany</code> relationships</h3>
<p>The exact same idea can be applied to the <code>hasOne</code> and <code>hasMany</code> associations, but instead of providing a <code>targetKey</code>, we provide a <code>sourceKey</code> when defining the association. This is because unlike <code>belongsTo</code>, the <code>hasOne</code> and <code>hasMany</code> associations keep the foreign key on the target model:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Foo</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'foo'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: { type: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">, unique: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Bar</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'bar'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    title: { type: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">, unique: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Baz</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'baz'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  { summary: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">hasOne</span><span style="color:#E1E4E8">(Bar, { sourceKey: </span><span style="color:#9ECBFF">'name'</span><span style="color:#E1E4E8">, foreignKey: </span><span style="color:#9ECBFF">'fooName'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">Bar.</span><span style="color:#B392F0">hasMany</span><span style="color:#E1E4E8">(Baz, { sourceKey: </span><span style="color:#9ECBFF">'title'</span><span style="color:#E1E4E8">, foreignKey: </span><span style="color:#9ECBFF">'barTitle'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#6A737D">// [...]</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Bar.</span><span style="color:#B392F0">setFoo</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Foo</span><span style="color:#79B8FF">\'</span><span style="color:#9ECBFF">s Name Here'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> Baz.</span><span style="color:#B392F0">addBar</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Bar</span><span style="color:#79B8FF">\'</span><span style="color:#9ECBFF">s Title Here'</span><span style="color:#E1E4E8">);</span></span></code></pre>
<h3 id="for-belongstomany-relationships">For <code>belongsToMany</code> relationships</h3>
<p>The same idea can also be applied to <code>belongsToMany</code> relationships. However, unlike the other situations, in which we have only one foreign key involved, the <code>belongsToMany</code> relationship involves two foreign keys which are kept on an extra table (the junction table).</p>
<p>Consider the following setup:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Foo</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'foo'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    name: { type: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">, unique: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Bar</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> sequelize.</span><span style="color:#B392F0">define</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'bar'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    title: { type: DataTypes.</span><span style="color:#79B8FF">TEXT</span><span style="color:#E1E4E8">, unique: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  { timestamps: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<p>There are four cases to consider:</p>
<ul>
<li>We might want a many-to-many relationship using the default primary keys for both <code>Foo</code> and <code>Bar</code>:</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Bar, { through: </span><span style="color:#9ECBFF">'foo_bar'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#6A737D">// This creates a junction table `foo_bar` with fields `fooId` and `barId`</span></span></code></pre>
<ul>
<li>We might want a many-to-many relationship using the default primary key for <code>Foo</code> but a different field for <code>Bar</code>:</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Bar, { through: </span><span style="color:#9ECBFF">'foo_bar'</span><span style="color:#E1E4E8">, targetKey: </span><span style="color:#9ECBFF">'title'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#6A737D">// This creates a junction table `foo_bar` with fields `fooId` and `barTitle`</span></span></code></pre>
<ul>
<li>We might want a many-to-many relationship using the a different field for <code>Foo</code> and the default primary key for <code>Bar</code>:</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Bar, { through: </span><span style="color:#9ECBFF">'foo_bar'</span><span style="color:#E1E4E8">, sourceKey: </span><span style="color:#9ECBFF">'name'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#6A737D">// This creates a junction table `foo_bar` with fields `fooName` and `barId`</span></span></code></pre>
<ul>
<li>We might want a many-to-many relationship using different fields for both <code>Foo</code> and <code>Bar</code>:</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">Foo.</span><span style="color:#B392F0">belongsToMany</span><span style="color:#E1E4E8">(Bar, {</span></span>
<span class="line"><span style="color:#E1E4E8">  through: </span><span style="color:#9ECBFF">'foo_bar'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  sourceKey: </span><span style="color:#9ECBFF">'name'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  targetKey: </span><span style="color:#9ECBFF">'title'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#6A737D">// This creates a junction table `foo_bar` with fields `fooName` and `barTitle`</span></span></code></pre>
<h3 id="notes">Notes</h3>
<p>Don’t forget that the field referenced in the association must have a unique constraint placed on it. Otherwise, an error will be thrown (and sometimes with a mysterious error message - such as <code>SequelizeDatabaseError: SQLITE_ERROR: foreign key mismatch - "ships" referencing "captains"</code> for SQLite).</p>
<p>The trick to deciding between <code>sourceKey</code> and <code>targetKey</code> is just to remember where each relationship places its foreign key. As mentioned in the beginning of this guide:</p>
<ul>
<li><code>A.belongsTo(B)</code> keeps the foreign key in the source model (<code>A</code>), therefore the referenced key is in the target model, hence the usage of <code>targetKey</code>.</li>
<li><code>A.hasOne(B)</code> and <code>A.hasMany(B)</code> keep the foreign key in the target model (<code>B</code>), therefore the referenced key is in the source model, hence the usage of <code>sourceKey</code>.</li>
<li><code>A.belongsToMany(B)</code> involves an extra table (the junction table), therefore both <code>sourceKey</code> and <code>targetKey</code> are usable, with <code>sourceKey</code> corresponding to some field in <code>A</code> (the source) and <code>targetKey</code> corresponding to some field in <code>B</code> (the target).</li>
</ul> </div> <div id="cusdis_thread" class="mt-12" data-host="https://cusdis.com" data-app-id="c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd" data-page-id="content/libs/sequelize-associations.md" data-page-url="content/libs/sequelize-associations.md" data-page-title="sequelize建立表关系" data-iframe="/js/cusdis/iframe.umd.js" data-style="/js/cusdis/style.css"></div> <script>
window.CUSDIS_LOCALE = {
  powered_by: '',
  post_comment: '发送',
  loading: '加载中...',
  // comment
  email: '邮箱(可选)',
  nickname: '昵称',
  reply_placeholder: '内容',
  reply_btn: '回复',
  sending: '发送中...',
  // reply
  mod_badge: '管理员',
  content_is_required: '内容不能为空',
  nickname_is_required: '昵称不能为空',
  comment_has_been_sent: '评论已发送, 管理员审核通过后会展示',
};
</script> <script async src="/js/cusdis/cusdis.min.js"></script>  </main> </body></html>