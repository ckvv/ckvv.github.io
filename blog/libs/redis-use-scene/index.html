<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><meta name="generator" content="Astro v5.1.5"><!-- Canonical URL --><link rel="canonical" href="https://ckvv.net/blog/libs/redis-use-scene/"><!-- Primary Meta Tags --><title>Redis的五种数据结构及其使用场景</title><meta name="title" content="Redis的五种数据结构及其使用场景"><meta name="description" content="Welcome to my website!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://ckvv.net/blog/libs/redis-use-scene/"><meta property="og:title" content="Redis的五种数据结构及其使用场景"><meta property="og:description" content="Welcome to my website!"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://ckvv.net/blog/libs/redis-use-scene/"><meta property="twitter:title" content="Redis的五种数据结构及其使用场景"><meta property="twitter:description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/about.BQcBO4Xu.css">
<style>.outline-item-active[data-astro-cid-v2nb7cev]{font-weight:700;color:#075985}
</style></head> <body class="flex flex-col"> <header class="sticky top-0 px-4 bg-white opacity-1 z-10 shadow-md"> <nav class="w-full max-w-6xl m-auto elect-none flex justify-between items-center text-2xl my-4"> <div class="flex gap-2 md:gap-4 items-center font-bold"> <h2><a href="/">CK Blog</a></h2> </div> <div class="flex gap-2 md:gap-4"> <a href="/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Home <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/tag/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Tag <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/assets/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center hidden md:inline"> Assets <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/about/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> About <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="https://github.com/ckvv/ckvv.github.io" target="_blank" aria-label="GitHub" class="hidden md:inline"> <svg viewBox="0 0 32 32" role="img" width="32" height="32" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16 0C7.16 0 0 7.16 0 16C0 23.08 4.58 29.06 10.94 31.18C11.74 31.32 12.04 30.84 12.04 30.42C12.04 30.04 12.02 28.78 12.02 27.44C8 28.18 6.96 26.46 6.64 25.56C6.46 25.1 5.68 23.68 5 23.3C4.44 23 3.64 22.26 4.98 22.24C6.24 22.22 7.14 23.4 7.44 23.88C8.88 26.3 11.18 25.62 12.1 25.2C12.24 24.16 12.66 23.46 13.12 23.06C9.56 22.66 5.84 21.28 5.84 15.16C5.84 13.42 6.46 11.98 7.48 10.86C7.32 10.46 6.76 8.82 7.64 6.62C7.64 6.62 8.98 6.2 12.04 8.26C13.32 7.9 14.68 7.72 16.04 7.72C17.4 7.72 18.76 7.9 20.04 8.26C23.1 6.18 24.44 6.62 24.44 6.62C25.32 8.82 24.76 10.46 24.6 10.86C25.62 11.98 26.24 13.4 26.24 15.16C26.24 21.3 22.5 22.66 18.94 23.06C19.52 23.56 20.02 24.52 20.02 26.02C20.02 28.16 20 29.88 20 30.42C20 30.84 20.3 31.34 21.1 31.18C27.42 29.06 32 23.06 32 16C32 7.16 24.84 0 16 0V0Z" fill="#24292E" />
</svg> </a> </div> </nav> </header> <main class="w-full max-w-5xl mx-auto px-4 py-8 flex-grow">  <h1 class="text-4xl font-bold my-4">Redis的五种数据结构及其使用场景</h1> <div class="my-2 flex justify-between"> <div class="flex gap-4"> <a href="/tag/redis/" class="bg-gray-100 hover:bg-gray-300 text-sky-700 px-2 py-1 rounded cursor-pointer"> redis </a> </div> <span> 2021/07/09 </span> </div> <div class="content"> <script type="module">function m(t,o){let e,n;return(...r)=>{n?(clearTimeout(e),e=setTimeout(()=>{Date.now()-n>=o&&(t(...r),n=Date.now())},o-(Date.now()-n))):(t(...r),n=Date.now())}}function a(){const t=document.getElementById("menu-button"),o=document.getElementById("md-outline-content"),e=t.getAttribute("aria-expanded")==="true";t.setAttribute("aria-expanded",`${!e}`),o.style.display=e?"none":"block"}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("menu-button");t.onclick=a,document.onclick=c=>{const i=document.getElementById("md-outline-content");c.target.id!=="menu-button"&&!i.contains(c.target)&&t.getAttribute("aria-expanded")==="true"&&a()};const o=document.querySelector(".content").querySelectorAll("h1, h2, h3"),e=document.querySelectorAll(".outline-item"),n={root:null,rootMargin:"0px",threshold:.6},r=m(c=>{c.forEach(i=>{if(i.isIntersecting){const d=i.target.getAttribute("id");e.forEach(s=>{const u=`#${d}`;s.classList.remove("outline-item-active"),s.getAttribute("href")===u&&(s.classList.add("outline-item-active"),history.replaceState(null,"",u))})}})},200),l=new IntersectionObserver(r,n);o.forEach(c=>{l.observe(c)})});</script> <p>from <a href="https://www.cnblogs.com/ottll/p/9470480.html">https://www.cnblogs.com/ottll/p/9470480.html</a></p>
<ol>
<li>String</li>
</ol>
<p>常用命令：</p>
<p>get、set、incr、decr、mget等</p>
<p>应用场景：</p>
<p>String是最常用的数据类型，普通的key/value都可以归为此类，value其实不仅是String，也可以是数字。</p>
<p>比如想知道什么时候封锁一个IP地址(访问超过几次)。INCRBY命令让这些变得很容易，通过原子递增保持计数。</p>
<p>实现方式：</p>
<p>m,decr等操作时会转成数值型进行计算，此时redisObject的encoding字段为int。</p>
<p>2.Hash</p>
<p>常用命令：</p>
<p>hget、hset、hgetall等</p>
<p>应用场景：</p>
<p>比如我们要存储一个用户的信息，包含以下信息：</p>
<p>用户ID，为查找的key</p>
<p>存储的value用户对象包含姓名name，年龄age，生日birthday 等信息</p>
<p>如果以普通的key/value结构存储，主要有以下两种存储方式：</p>
<p>第一种方式将用户id作为key，其他信息封装成对象以序列化的方式存储，如</p>
<p>set u001 “李三,18,20010101”</p>
<p>这种方式的缺点，增加了序列化/反序列化的开销；需要修改其中一项信息时，需要把整个对象取回，修改操作需要对并发进行保护，引入CAS等复杂问题。</p>
<p>第二种方式是这个用户信息有多少成员就存成多少个key-value对，用用户id+对应属性名称作为唯一的标识来取得对应属性的值，如：</p>
<p>mset user:001:name “李三 “user:001:age18 user:001:birthday “20010101”</p>
<p>虽然省去了序列化开销和并发问题，但是用户ID为重复存储，如果存在大量这样的数据，内存浪费较大。</p>
<p>redis提供的hash很好的解决了这个问题，redis的hash实际是内部存储的value为一个HashMap，并且提供了直接存取这个map的成员接口。如</p>
<p>hmset user:001 name “李三” age 18 birthday “20010101”</p>
<p>也就是说，key仍然是用户id，value是一个map，这个map的key是成员的属性名，value是属性值。</p>
<p>这里同时需要注意，Redis提供了接口(hgetall)可以直接取到全部的属性数据,但是如果内部Map的成员很多，那么涉及到遍历整个内部Map的操作，由于Redis单线程模型的缘故，这个遍历操作可能会比较耗时，而另其它客户端的请求完全不响应，这点需要格外注意。</p>
<p>实现方式：</p>
<p>Redis的Hash对应的Value内部实际就是一个HashMap，实际有两种不同的实现，如果成员较少时，Redis为了节省内存会采用类似一维数组方式存储，对应的value RedisObject的encoding为zipmap，当成员数量增大时会自动转成真正的HashMap，此时encoding为ht。</p>
<p>3.List</p>
<p>常用命令：</p>
<p>lpush,rpush,lpop,rpop,lrange,BLPOP(阻塞版)等。</p>
<p>应用场景：</p>
<p>最新消息排行。</p>
<p>消息队列。利用Lists的push的操作，将任务存储在list中，然后工作线程再用pop操作将任务取出进行执行。</p>
<p>实现方式：</p>
<p>redis list的实现是一个双向链表，可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销，redis内部的很多实现，包括发送缓冲队列等也都用的是这个数据结构。</p>
<ol start="4">
<li>Set</li>
</ol>
<p>常用命令：</p>
<p>sadd,srem,spop,sdiff ,smembers,sunion 等。</p>
<p>应用场景：</p>
<p>set类似list，特殊之处是set可以自动排重。</p>
<p>set还提供了某个成员是否在一个set内的接口，这个也是list没有的。</p>
<p>比如在微博应用中，每个人的好友存在一个集合（set）中，这样求两个人的共同好友的操作，可能就只需要用求交集命令即可。</p>
<p>Redis还为集合提供了求交集、并集、差集等操作。</p>
<p>实现方式：</p>
<p>set内部实现是一个value永远为null的HashMap，实际就是通过hash的方式快速排重的。</p>
<ol start="5">
<li>Sort Set</li>
</ol>
<p>常用命令：</p>
<p>zadd,zrange,zrem,zcard等</p>
<p>使用场景：</p>
<p>sorted set的使用场景与set类似，区别是set不是自动有序的，而sorted set可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。</p>
<p>比如:twitter 的public timeline可以以发表时间作为score来存储，这样获取时就是自动按时间排好序的。</p>
<p>比如:全班同学成绩的SortedSets，value可以是同学的学号，而score就可以是其考试得分，这样数据插入集合的，就已经进行了天然的排序。</p>
<p>另外还可以用Sorted Sets来做带权重的队列，比如普通消息的score为1，重要消息的score为2，然后工作线程可以选择按score的倒序来获取工作任务。让重要的任务优先执行。</p>
<p>需要精准设定过期时间的应用</p>
<p>比如你可以把上面说到的sorted set的score值设置成过期时间的时间戳，那么就可以简单地通过过期时间排序，定时清除过期数据了，不仅是清除Redis中的过期数据，你完全可以把Redis里这个过期时间当成是对数据库中数据的索引，用Redis来找出哪些数据需要过期删除，然后再精准地从数据库中删除相应的记录。</p>
<p>实现方式：</p>
<p>Redis sorted set的内部使用HashMap和跳跃表(SkipList)来保证数据的存储和有序，HashMap里放的是成员到score的映射，而跳跃表里存放的是所有的成员，排序依据是HashMap里存的score,使用跳跃表的结构可以获得比较高的查找效率，并且在实现上比较简单。</p>
<p>此外，redis还有两个特性</p>
<ol>
<li>消息订阅</li>
</ol>
<p>Pub/Sub 从字面上理解就是发布（Publish）与订阅（Subscribe），在Redis中，你可以设定对某一个key值进行消息发布及消息订阅，</p>
<p>当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p>
<p>客户端1：subscribe  rain</p>
<p>客户端2：PUBLISH  rain “my love!!!”</p>
<p>(integer) 2 代表有几个客户端订阅了这个消息</p>
<ol start="2">
<li>transaction</li>
</ol>
<p>Redis的Transactions提供的并不是严格的ACID的事务（比如一串用EXEC提交执行的命令，在执行中服务器宕机，那么会有一部分命令执行了，剩下的没执行），但是这个Transactions还是提供了基本的命令打包执行的功能（在服务器不出问题的情况下，可以保证一连串的命令是顺序在一起执行的，中间有会有其它客户端命令插进来执行）。</p>
<p>Redis还提供了一个Watch功能，你可以对一个key进行Watch，然后再执行Transactions，在这过程中，如果这个Watched的值进行了修改，那么这个Transactions会发现并拒绝执行</p> </div> <div id="cusdis_thread" class="mt-12" data-host="https://cusdis.com" data-app-id="c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd" data-page-id="content/libs/redis-use-scene.md" data-page-url="content/libs/redis-use-scene.md" data-page-title="Redis的五种数据结构及其使用场景" data-iframe="/js/cusdis/iframe.umd.js" data-style="/js/cusdis/style.css"></div> <script>
window.CUSDIS_LOCALE = {
  powered_by: '',
  post_comment: '发送',
  loading: '加载中...',
  // comment
  email: '邮箱(可选)',
  nickname: '昵称',
  reply_placeholder: '内容',
  reply_btn: '回复',
  sending: '发送中...',
  // reply
  mod_badge: '管理员',
  content_is_required: '内容不能为空',
  nickname_is_required: '昵称不能为空',
  comment_has_been_sent: '评论已发送, 管理员审核通过后会展示',
};
</script> <script async src="/js/cusdis/cusdis.min.js"></script>  </main> </body></html>