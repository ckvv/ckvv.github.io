<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><meta name="generator" content="Astro v5.1.5"><!-- Canonical URL --><link rel="canonical" href="https://ckvv.net/blog/javascript/js-iterator/"><!-- Primary Meta Tags --><title>js的迭代器</title><meta name="title" content="js的迭代器"><meta name="description" content="Welcome to my website!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://ckvv.net/blog/javascript/js-iterator/"><meta property="og:title" content="js的迭代器"><meta property="og:description" content="Welcome to my website!"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://ckvv.net/blog/javascript/js-iterator/"><meta property="twitter:title" content="js的迭代器"><meta property="twitter:description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/about.DFhfNKfr.css">
<style>.outline-item-active[data-astro-cid-v2nb7cev]{font-weight:700;color:#075985}
</style></head> <body class="flex flex-col"> <header class="sticky top-0 px-4 bg-white opacity-1 z-10 shadow-md"> <nav class="w-full max-w-6xl m-auto elect-none flex justify-between items-center text-2xl my-4"> <div class="flex gap-2 md:gap-4 items-center font-bold"> <h2><a href="/">CK Blog</a></h2> </div> <div class="flex gap-2 md:gap-4"> <a href="/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Home <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/tag/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Tag <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/assets/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center hidden md:inline"> Assets <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/about/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> About <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="https://github.com/ckvv/ckvv.github.io" target="_blank" aria-label="GitHub" class="hidden md:inline"> <svg viewBox="0 0 32 32" role="img" width="32" height="32" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16 0C7.16 0 0 7.16 0 16C0 23.08 4.58 29.06 10.94 31.18C11.74 31.32 12.04 30.84 12.04 30.42C12.04 30.04 12.02 28.78 12.02 27.44C8 28.18 6.96 26.46 6.64 25.56C6.46 25.1 5.68 23.68 5 23.3C4.44 23 3.64 22.26 4.98 22.24C6.24 22.22 7.14 23.4 7.44 23.88C8.88 26.3 11.18 25.62 12.1 25.2C12.24 24.16 12.66 23.46 13.12 23.06C9.56 22.66 5.84 21.28 5.84 15.16C5.84 13.42 6.46 11.98 7.48 10.86C7.32 10.46 6.76 8.82 7.64 6.62C7.64 6.62 8.98 6.2 12.04 8.26C13.32 7.9 14.68 7.72 16.04 7.72C17.4 7.72 18.76 7.9 20.04 8.26C23.1 6.18 24.44 6.62 24.44 6.62C25.32 8.82 24.76 10.46 24.6 10.86C25.62 11.98 26.24 13.4 26.24 15.16C26.24 21.3 22.5 22.66 18.94 23.06C19.52 23.56 20.02 24.52 20.02 26.02C20.02 28.16 20 29.88 20 30.42C20 30.84 20.3 31.34 21.1 31.18C27.42 29.06 32 23.06 32 16C32 7.16 24.84 0 16 0V0Z" fill="#24292E" />
</svg> </a> </div> </nav> </header> <main class="w-full max-w-5xl mx-auto px-4 py-8 flex-grow">  <h1 class="text-4xl font-bold my-4">js的迭代器</h1> <div class="my-2 flex justify-between"> <div class="flex gap-4"> <a href="/tag/javascript/" class="bg-gray-100 hover:bg-gray-300 text-sky-700 px-2 py-1 rounded cursor-pointer"> javascript </a> </div> <span> 2021/07/09 </span> </div> <div class="content"> <div class="2xl:hidden sticky top-20 inline-block text-left w-full" data-astro-cid-v2nb7cev><div class="flex justify-end" data-astro-cid-v2nb7cev><button type="button" class="inline-flex justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 hover:bg-gray-50" id="menu-button" aria-expanded="false" aria-haspopup="true" data-astro-cid-v2nb7cev>
On this page
<svg class="-mr-1 size-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" data-astro-cid-v2nb7cev><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" data-astro-cid-v2nb7cev></path></svg></button></div><div id="md-outline-content" class="hidden absolute right-0 z-10 mt-2 max-w-full origin-top-right rounded-md bg-white ring-1 shadow-lg ring-black/5 focus:outline-hidden" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" data-astro-cid-v2nb7cev><a class="outline-item block px-4 py-1 text-sm" href="#什么是迭代器" data-astro-cid-v2nb7cev>什么是迭代器</a><a class="outline-item block px-4 py-1 text-sm" href="#可迭代协议" data-astro-cid-v2nb7cev>可迭代协议</a><a class="outline-item block px-4 py-1 text-sm" href="#迭代器协议" data-astro-cid-v2nb7cev>迭代器协议</a><a class="outline-item block px-4 py-1 text-sm" href="#常见的迭代器" data-astro-cid-v2nb7cev>常见的迭代器</a><a class="outline-item block px-4 py-1 text-sm" href="#string-是一个内置的可迭代对象" data-astro-cid-v2nb7cev>String 是一个内置的可迭代对象</a><a class="outline-item block px-4 py-1 text-sm" href="#接受可迭代对象的内置-api" data-astro-cid-v2nb7cev>接受可迭代对象的内置 API</a><a class="outline-item block px-4 py-1 text-sm" href="#用于可迭代对象的语法" data-astro-cid-v2nb7cev>用于可迭代对象的语法</a><a class="outline-item block px-4 py-1 text-sm" href="#自定义迭代器" data-astro-cid-v2nb7cev>自定义迭代器</a><a class="outline-item block px-4 py-1 text-sm" href="#迭代器示例" data-astro-cid-v2nb7cev>迭代器示例</a><a class="outline-item block px-4 py-1 text-sm" href="#生成器式的迭代器" data-astro-cid-v2nb7cev>生成器式的迭代器</a></div></div>

  <div class="hidden 2xl:flex outline-list sticky flex-col 2xl:top-20 2xl:float-right 2xl:translate-x-full 2xl:px-8 2xl:max-w-[calc(50vw-500px)]" data-astro-cid-v2nb7cev><h4 data-astro-cid-v2nb7cev>On this page</h4><a class="outline-item" href="#什么是迭代器" data-astro-cid-v2nb7cev>什么是迭代器</a><a class="outline-item" href="#可迭代协议" data-astro-cid-v2nb7cev>可迭代协议</a><a class="outline-item" href="#迭代器协议" data-astro-cid-v2nb7cev>迭代器协议</a><a class="outline-item" href="#常见的迭代器" data-astro-cid-v2nb7cev>常见的迭代器</a><a class="outline-item" href="#string-是一个内置的可迭代对象" data-astro-cid-v2nb7cev>String 是一个内置的可迭代对象</a><a class="outline-item" href="#接受可迭代对象的内置-api" data-astro-cid-v2nb7cev>接受可迭代对象的内置 API</a><a class="outline-item" href="#用于可迭代对象的语法" data-astro-cid-v2nb7cev>用于可迭代对象的语法</a><a class="outline-item" href="#自定义迭代器" data-astro-cid-v2nb7cev>自定义迭代器</a><a class="outline-item" href="#迭代器示例" data-astro-cid-v2nb7cev>迭代器示例</a><a class="outline-item" href="#生成器式的迭代器" data-astro-cid-v2nb7cev>生成器式的迭代器</a></div><script>
function throttle(func, limit) {
  let lastFunc;
  let lastRan;
  return function (...args) {
    if (!lastRan) {
      func.apply(this, args);
      lastRan = Date.now();
    } else {
      clearTimeout(lastFunc);
      lastFunc = setTimeout(() => {
        if (Date.now() - lastRan >= limit) {
          func.apply(this, args);
          lastRan = Date.now();
        }
      }, limit - (Date.now() - lastRan));
    }
  };
}

function toggleMenu() {
  const button = document.getElementById('menu-button');
  const menu = document.getElementById('md-outline-content');
  const isExpanded = button.getAttribute('aria-expanded') === 'true';

  // 切换状态
  button.setAttribute('aria-expanded', !isExpanded);
  menu.style.display = isExpanded ? 'none' : 'block';
}

document.addEventListener('DOMContentLoaded', () => {
  const menuButton = document.getElementById('menu-button');
  menuButton.onclick = toggleMenu;

  document.onclick = (event) => {
    const menu = document.getElementById('md-outline-content');
    if (event.target.id !== 'menu-button' && !menu.contains(event.target) && menuButton.getAttribute('aria-expanded') === 'true') {
      toggleMenu();
    }
  };

  const sections = document.querySelector('.content').querySelectorAll('h1, h2, h3'); // 替换为你的锚点元素
  const navLinks = document.querySelectorAll('.outline-item'); // 替换为你的导航链接

  const observerOptions = {
    root: null, // viewport
    rootMargin: '0px',
    threshold: 0.6, // 60%可见时触发
  };

  const observerCallback = throttle((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');
        navLinks.forEach((link) => {
          const activeHash = `#${id}`;
          link.classList.remove('outline-item-active');
          if (link.getAttribute('href') === activeHash) {
            link.classList.add('outline-item-active');
            history.replaceState(null, '', activeHash);
          }
        });
      }
    });
  }, 200);

  const observer = new IntersectionObserver(observerCallback, observerOptions);

  sections.forEach((section) => {
    observer.observe(section);
  });
});
</script> <h2 id="什么是迭代器">什么是迭代器</h2>
<p>ECMAScript 2015的几个补充，并不是新的内置实现或语法，而是协议。这些协议可以被任何遵循某些约定的对象来实现。有两个协议：可迭代协议和迭代器协议。
JavaScript 提供了许多迭代集合的方法，从简单的 for 循环到 map() 和 filter()，迭代器和生成器将迭代的概念直接带入核心语言，并提供了一种机制来自定义 for…of 循环的行为</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> myIterator</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  [Symbol.iterator]() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<h2 id="可迭代协议">可迭代协议</h2>
<p>为了变成可迭代对象， 一个对象必须实现 @@iterator 方法, 意思是这个对象（或者它原型链 prototype chain 上的某个对象）必须有一个名字是 Symbol.iterator 的属性:</p>
<blockquote>
<p>[Symbol.iterator]
返回一个对象的无参函数，被返回对象符合迭代器协议。</p>
</blockquote>
<p>当一个对象需要被迭代的时候（比如开始用于一个for..of循环中），它的@@iterator方法被调用并且无参数，然后返回一个用于在迭代中获得值的迭代器。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> people</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">index</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> index;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.index</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      done: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      value: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  [Symbol.iterator]() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> a</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> people</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> val</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> a) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(val);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 缺失[Symbol.iterator]会报错误a is not iterable</span></span></code></pre>
<p>或者</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> myIterator </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    num: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">    next</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> () {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">            value: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.num </span><span style="color:#F97583">*=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            done: </span><span style="color:#79B8FF">false</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">    [Symbol.iterator]: </span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 生成器</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> People</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">index</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> index;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">[Symbol.iterator](){</span></span>
<span class="line"><span style="color:#F97583">    do</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#E1E4E8">.index</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      yield</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.index;</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">while</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 异步生成器</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> People</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">index</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> index;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">[Symbol.asyncIterator](){</span></span>
<span class="line"><span style="color:#F97583">    do</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#E1E4E8">.index</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      yield</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resolve</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index);</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">while</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="迭代器协议">迭代器协议</h2>
<p>该迭代器协议定义了一种标准的方式来产生一个有限或无限序列的值，并且当所有的值都已经被迭代后，就会有一个默认的返回值。
当一个对象只有满足下述条件才会被认为是一个迭代器：
它实现了一个 next() 的方法并且拥有以下含义：</p>
<blockquote>
<p>next
返回一个对象的无参函数，被返回对象拥有两个属性：
done (boolean)
true:迭代器已经超过了可迭代次数。这种情况下,value的值可以被省略
如果迭代器可以产生序列中的下一个值，则为 false。这等效于没有指定done这个属性。
value - 迭代器返回的任何 JavaScript 值。done 为 true 时可省略。
next 方法必须要返回一一个对象，该对象有两个必要的属性： done和value，如果返回一个非对象值（比如false和undefined) 会展示一个 TypeError (“iterator.next() returned a non-object value”) 的错误</p>
</blockquote>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> people</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">index</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> index;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  next</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.index</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      done: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      value: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.index</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> a</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> people</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> val</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> a) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(val);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="常见的迭代器">常见的迭代器</h2>
<p>String, Array, TypedArray, Map and Set 是所有内置可迭代对象， 因为它们的原型对象都有一个 @@iterator 方法.</p>
<h2 id="string-是一个内置的可迭代对象">String 是一个内置的可迭代对象</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> iterator </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'some'</span><span style="color:#E1E4E8">[Symbol.iterator]();</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> val </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> iterator){</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">val</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">,iterator.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">s { </span><span style="color:#B392F0">value</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'o'</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">done</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">m { </span><span style="color:#B392F0">value</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'e'</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">done</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span></code></pre>
<h2 id="接受可迭代对象的内置-api">接受可迭代对象的内置 API</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> myObj</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#F97583">new</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">([[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">], [</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'b'</span><span style="color:#E1E4E8">], [</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'c'</span><span style="color:#E1E4E8">]]).</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// "b"</span></span>
<span class="line"><span style="color:#F97583">new</span><span style="color:#B392F0"> WeakMap</span><span style="color:#E1E4E8">([[{}, </span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">], [myObj, </span><span style="color:#9ECBFF">'b'</span><span style="color:#E1E4E8">], [{}, </span><span style="color:#9ECBFF">'c'</span><span style="color:#E1E4E8">]]).</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(myObj); </span><span style="color:#6A737D">// "b"</span></span>
<span class="line"><span style="color:#F97583">new</span><span style="color:#B392F0"> Set</span><span style="color:#E1E4E8">([</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">has</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// true</span></span>
<span class="line"><span style="color:#F97583">new</span><span style="color:#B392F0"> Set</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'123'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">has</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'2'</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// true</span></span>
<span class="line"><span style="color:#F97583">new</span><span style="color:#B392F0"> WeakSet</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function*</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> myObj;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#E1E4E8">}()).</span><span style="color:#B392F0">has</span><span style="color:#E1E4E8">(myObj);</span></span></code></pre>
<p>另外还有 Promise.all(iterable), Promise.race(iterable) 以及 Array.from().</p>
<h2 id="用于可迭代对象的语法">用于可迭代对象的语法</h2>
<p>一些语句和表达式是预料会用于可迭代对象，比如 for-of 循环，spread operator, yield* 和 destructuring assignment</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> value</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'b'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'c'</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(value);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#6A737D">// "a"</span></span>
<span class="line"><span style="color:#6A737D">// "b"</span></span>
<span class="line"><span style="color:#6A737D">// "c"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[</span><span style="color:#F97583">...</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">]; </span><span style="color:#6A737D">// ["a", "b", "c"]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function*</span><span style="color:#B392F0"> gen</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'b'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'c'</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">gen</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value:"a", done:false }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[a, b, c] </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Set</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'b'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'c'</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#E1E4E8">a; </span><span style="color:#6A737D">// "a"</span></span></code></pre>
<h2 id="自定义迭代器">自定义迭代器</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> myIterable</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#E1E4E8">myIterable[Symbol.iterator] </span><span style="color:#F97583">=</span><span style="color:#F97583"> function*</span><span style="color:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#E1E4E8">[</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">myIterable]; </span><span style="color:#6A737D">// [1, 2, 3]</span></span></code></pre>
<h2 id="迭代器示例">迭代器示例</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> makeIterator</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">array</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> nextIndex </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    next</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#E1E4E8"> nextIndex </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> array.</span><span style="color:#79B8FF">length</span></span>
<span class="line"><span style="color:#F97583">        ?</span><span style="color:#E1E4E8"> { value: array[nextIndex</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">], done: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#F97583">        :</span><span style="color:#E1E4E8"> { done: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> it</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeIterator</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">'yo'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'ya'</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(it.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">().value); </span><span style="color:#6A737D">// 'yo'</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(it.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">().value); </span><span style="color:#6A737D">// 'ya'</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(it.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">().done); </span><span style="color:#6A737D">// true</span></span></code></pre>
<h2 id="生成器式的迭代器">生成器式的迭代器</h2>
<p>生成器对象是由一个 generator function 返回的,并且它符合可迭代协议和迭代器协议</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">function*</span><span style="color:#B392F0"> anotherGenerator</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">i</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function*</span><span style="color:#B392F0"> generator</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">i</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> i;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  //   yield* 表达式用于委托给另一个generator 或可迭代对象</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#F97583"> *</span><span style="color:#B392F0"> anotherGenerator</span><span style="color:#E1E4E8">(i);</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> gen</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> generator</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>生成器对象 既是迭代器也是可迭代对象:就像前面所说的，一个良好的迭代即实现了迭代器协议，又实现了可迭代协议，方式就是可迭代协议返回的是自身</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> aGeneratorObject</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">function*</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  yield</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}());</span></span>
<span class="line"><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> aGeneratorObject.next;</span></span>
<span class="line"><span style="color:#6A737D">// "function", because it has a next method, so it's an iterator</span></span>
<span class="line"><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> aGeneratorObject[Symbol.iterator];</span></span>
<span class="line"><span style="color:#6A737D">// "function", because it has an @@iterator method, so it's an iterable</span></span>
<span class="line"><span style="color:#E1E4E8">aGeneratorObject[Symbol.iterator]() </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> aGeneratorObject;</span></span>
<span class="line"><span style="color:#6A737D">// true, because its @@iterator method return its self (an iterator), so it's an well-formed iterable</span></span>
<span class="line"><span style="color:#E1E4E8">[</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">aGeneratorObject];</span></span>
<span class="line"><span style="color:#6A737D">// [1, 2, 3]</span></span></code></pre> </div> <div id="cusdis_thread" class="mt-12" data-host="https://cusdis.com" data-app-id="c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd" data-page-id="content/javascript/js-iterator.md" data-page-url="content/javascript/js-iterator.md" data-page-title="js的迭代器" data-iframe="/js/cusdis/iframe.umd.js" data-style="/js/cusdis/style.css"></div> <script>
window.CUSDIS_LOCALE = {
  powered_by: '',
  post_comment: '发送',
  loading: '加载中...',
  // comment
  email: '邮箱(可选)',
  nickname: '昵称',
  reply_placeholder: '内容',
  reply_btn: '回复',
  sending: '发送中...',
  // reply
  mod_badge: '管理员',
  content_is_required: '内容不能为空',
  nickname_is_required: '昵称不能为空',
  comment_has_been_sent: '评论已发送, 管理员审核通过后会展示',
};
</script> <script async src="/js/cusdis/cusdis.min.js"></script>  </main> </body></html>