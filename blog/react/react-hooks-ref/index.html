<!DOCTYPE html><html lang="en" class="h-full bg-white"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><meta name="generator" content="Astro v5.7.3"><!-- Canonical URL --><link rel="canonical" href="https://ckvv.net/blog/react/react-hooks-ref/"><!-- Primary Meta Tags --><title>React Hook Ref</title><meta name="title" content="React Hook Ref"><meta name="description" content="Welcome to my website!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://ckvv.net/blog/react/react-hooks-ref/"><meta property="og:title" content="React Hook Ref"><meta property="og:description" content="Welcome to my website!"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://ckvv.net/blog/react/react-hooks-ref/"><meta property="twitter:title" content="React Hook Ref"><meta property="twitter:description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/about.CAaTz6gG.css">
<style>.outline-item-active[data-astro-cid-v2nb7cev]{color:var(--color-sky-700)}
</style></head> <body class="flex flex-col min-h-full"> <header class="sticky top-0 px-4 bg-white z-10 shadow-md"> <nav class="w-full max-w-6xl m-auto elect-none flex justify-between items-center text-2xl my-4"> <div class="flex gap-2 md:gap-4 items-center font-bold"> <h2><a href="/">CK Blog</a></h2> </div> <div class="flex gap-2 md:gap-4"> <a href="/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Home <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/tag/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> Tag <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/assets/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center hidden md:inline"> Assets <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="/about/" class="group clink cursor-pointer shrink-0 select-none relative flex items-center px-1"> About <div class="h-1 bg-blue-500 w-0 group-hover:w-full transition-width duration-500 ease-in-out absolute -bottom-1 left-0" style=""></div> </a> <a href="https://github.com/ckvv/ckvv.github.io" target="_blank" aria-label="GitHub" class="hidden md:inline"> <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16 0C7.16 0 0 7.16 0 16C0 23.08 4.58 29.06 10.94 31.18C11.74 31.32 12.04 30.84 12.04 30.42C12.04 30.04 12.02 28.78 12.02 27.44C8 28.18 6.96 26.46 6.64 25.56C6.46 25.1 5.68 23.68 5 23.3C4.44 23 3.64 22.26 4.98 22.24C6.24 22.22 7.14 23.4 7.44 23.88C8.88 26.3 11.18 25.62 12.1 25.2C12.24 24.16 12.66 23.46 13.12 23.06C9.56 22.66 5.84 21.28 5.84 15.16C5.84 13.42 6.46 11.98 7.48 10.86C7.32 10.46 6.76 8.82 7.64 6.62C7.64 6.62 8.98 6.2 12.04 8.26C13.32 7.9 14.68 7.72 16.04 7.72C17.4 7.72 18.76 7.9 20.04 8.26C23.1 6.18 24.44 6.62 24.44 6.62C25.32 8.82 24.76 10.46 24.6 10.86C25.62 11.98 26.24 13.4 26.24 15.16C26.24 21.3 22.5 22.66 18.94 23.06C19.52 23.56 20.02 24.52 20.02 26.02C20.02 28.16 20 29.88 20 30.42C20 30.84 20.3 31.34 21.1 31.18C27.42 29.06 32 23.06 32 16C32 7.16 24.84 0 16 0V0Z" fill="#24292E" />
</svg> </a> </div> </nav> </header> <main class="w-full max-w-5xl mx-auto px-4 py-8 flex-grow font-tabular-nums">  <h1 class="text-4xl font-bold my-4">React Hook Ref</h1>
  <div class="my-2 flex justify-between items-center"><div class="flex gap-4"><a href="/tag/react/" class="bg-gray-100 hover:bg-gray-300 text-sky-700 px-2 py-1 rounded cursor-pointer"> react </a></div><span class="tabular-nums"> 2024/08/24 </span></div>
  <div class="sticky z-10 top-20 inline-block text-left w-full" data-astro-cid-v2nb7cev><div class="2xl:hidden flex justify-end" data-astro-cid-v2nb7cev><button type="button" class="inline-flex justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 hover:bg-gray-50" id="menu-button" aria-expanded="false" aria-haspopup="true" data-astro-cid-v2nb7cev>
On this page
<svg class="-mr-1 size-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" data-astro-cid-v2nb7cev><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" data-astro-cid-v2nb7cev></path></svg></button></div><div id="md-outline-content" class="max-h-[calc(100vh-200px)] overflow-auto hidden absolute right-0 py-2 mt-2 min-w-48 max-w-full origin-top-right rounded-md bg-white ring-1 shadow-lg ring-black/5 focus:outline-hidden 2xl:-right-12 2xl:float-right 2xl:translate-x-full 2xl:max-w-[min(calc(50vw-580px),320px)]" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" data-astro-cid-v2nb7cev><a class="outline-item block px-4 py-1 text-sm break-all" href="#useref" data-astro-cid-v2nb7cev>useRef</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#å‚è€ƒ" data-astro-cid-v2nb7cev>å‚è€ƒ</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#é€šè¿‡-ref-æ“ä½œ-dom" data-astro-cid-v2nb7cev>é€šè¿‡ ref æ“ä½œ DOM</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#ä¿å­˜å®ä¾‹å˜é‡" data-astro-cid-v2nb7cev>ä¿å­˜å®ä¾‹å˜é‡</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#è·å–ä¸Šä¸€è½®çš„-props-æˆ–-state" data-astro-cid-v2nb7cev>è·å–ä¸Šä¸€è½®çš„ props æˆ– state</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#å›è°ƒref" data-astro-cid-v2nb7cev>å›è°ƒRef</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#æ›´æ–°-state-åç«‹å³è®¿é—®-ref-dom" data-astro-cid-v2nb7cev>æ›´æ–° state åç«‹å³è®¿é—® ref Dom</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#è®¿é—®å¦ä¸€ä¸ªç»„ä»¶çš„-dom-èŠ‚ç‚¹" data-astro-cid-v2nb7cev>è®¿é—®å¦ä¸€ä¸ªç»„ä»¶çš„ DOM èŠ‚ç‚¹</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å–å†™å…¥-ref" data-astro-cid-v2nb7cev>ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å–ã€å†™å…¥ ref</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#é¿å…é‡å¤åˆ›å»º-ref-çš„å†…å®¹" data-astro-cid-v2nb7cev>é¿å…é‡å¤åˆ›å»º ref çš„å†…å®¹</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#è‡ªå®šä¹‰ç»„ä»¶çš„-ref" data-astro-cid-v2nb7cev>è‡ªå®šä¹‰ç»„ä»¶çš„ ref</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#useimperativehandle" data-astro-cid-v2nb7cev>useImperativeHandle</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#å‚è€ƒ-1" data-astro-cid-v2nb7cev>å‚è€ƒ</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#åŸºç¡€ç”¨æ³•" data-astro-cid-v2nb7cev>åŸºç¡€ç”¨æ³•</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#createhandle-æ¡ä»¶æ‰§è¡Œ" data-astro-cid-v2nb7cev>createHandle æ¡ä»¶æ‰§è¡Œ</a><a class="outline-item block px-4 py-1 text-sm break-all" href="#æ³¨æ„äº‹é¡¹" data-astro-cid-v2nb7cev>æ³¨æ„äº‹é¡¹</a></div></div><script type="module">function f(n,o){let r,t;return(...c)=>{t?(clearTimeout(r),r=setTimeout(()=>{Date.now()-t>=o&&(n(...c),t=Date.now())},o-(Date.now()-t))):(n(...c),t=Date.now())}}function u(n){const o=document.getElementById("menu-button"),r=document.getElementById("md-outline-content"),t=n===void 0?o.getAttribute("aria-expanded")==="true":!n;o.setAttribute("aria-expanded",`${!t}`),r.style.display=t?"none":"block"}function l(){window.innerWidth>=1536&&u(!0)}window.addEventListener("resize",l);document.addEventListener("DOMContentLoaded",()=>{l();const n=document.getElementById("md-outline-content");n.onclick=e=>{e.preventDefault();const i=document.querySelector(e.target.getAttribute("href"));i&&window.scrollTo({top:i.offsetTop-64,behavior:"smooth"})};const o=document.getElementById("menu-button");o.onclick=()=>u(),document.onclick=e=>{if(window.innerWidth>=1536)return;const i=document.getElementById("md-outline-content");e.target.id!=="menu-button"&&!i.contains(e.target)&&o.getAttribute("aria-expanded")==="true"&&u()};const r=document.querySelector(".content").querySelectorAll("h1, h2, h3"),t=document.querySelectorAll(".outline-item"),c={root:null,rootMargin:"0px",threshold:.6},a=f(e=>{e.forEach(i=>{if(i.isIntersecting){const b=i.target.getAttribute("id");t.forEach(s=>{const d=`#${b}`;s.classList.remove("outline-item-active"),s.getAttribute("href")===d&&(s.classList.add("outline-item-active"),history.replaceState(null,"",d))})}})},200),m=new IntersectionObserver(a,c);r.forEach(e=>{m.observe(e)})});</script><div class="content"> <h2 id="useref">useRef</h2>
<p><code>useRef</code> è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå…¶ <code>.current</code> å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°<code>initialValue</code>ã€‚è¿”å›çš„ ref å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜, ref å…è®¸ç»„ä»¶ ä¿å­˜ä¸€äº›ä¸ç”¨äºæ¸²æŸ“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ DOM èŠ‚ç‚¹æˆ– timeout IDã€‚ä¸<code>state</code>ä¸åŒï¼Œæ›´æ–° <code>ref</code> ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ref</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">(initialValue);</span></span></code></pre>
<p>å‚æ•°</p>
<ul>
<li><code>initialValue</code>: ref å¯¹è±¡çš„ current å±æ€§çš„åˆå§‹å€¼ã€‚å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ã€‚è¿™ä¸ªå‚æ•°åœ¨é¦–æ¬¡æ¸²æŸ“åè¢«å¿½ç•¥</li>
</ul>
<p>è¿”å›å€¼</p>
<ul>
<li><code>ref</code>: è¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ª<code>current</code>å±æ€§çš„å¯¹è±¡, åˆå§‹å€¼ä¸ºä¼ é€’çš„ initialValueã€‚ä¹‹åå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼ã€‚å¦‚æœå°† ref å¯¹è±¡ä½œä¸ºä¸€ä¸ª JSX èŠ‚ç‚¹çš„ ref å±æ€§ä¼ é€’ç»™ Reactï¼ŒReact å°†ä¸ºå®ƒè®¾ç½® current å±æ€§ã€‚
åœ¨åç»­çš„æ¸²æŸ“ä¸­ï¼ŒuseRef å°†è¿”å›åŒä¸€ä¸ªå¯¹è±¡ã€‚</li>
</ul>
<p>æ³¨æ„äº‹é¡¹</p>
<ul>
<li>ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å– ref.current</li>
<li>æ”¹å˜ ref.current å±æ€§æ—¶ï¼ŒReact ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶</li>
<li>é™¤äº† åˆå§‹åŒ– å¤–ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å– ref.current</li>
<li>åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact å°†ä¼š è°ƒç”¨ä¸¤æ¬¡ç»„ä»¶æ–¹æ³•</li>
</ul>
<h3 id="é€šè¿‡-ref-æ“ä½œ-dom">é€šè¿‡ ref æ“ä½œ DOM</h3>
<p>ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹ä¾¿æ˜¯å‘½ä»¤å¼åœ°è®¿é—®å­ç»„ä»¶</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> TextInputWithFocusButton</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> inputRef</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> onButtonClick</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // å½“ React åˆ›å»º DOM èŠ‚ç‚¹å¹¶å°†å…¶æ¸²æŸ“åˆ°å±å¹•æ—¶ï¼ŒReact å°†ä¼šæŠŠ DOM èŠ‚ç‚¹è®¾ç½®ä¸º ref å¯¹è±¡çš„ current å±æ€§</span></span>
<span class="line"><span style="color:#6A737D">    // å½“èŠ‚ç‚¹ä»å±å¹•ä¸Šç§»é™¤æ—¶ï¼ŒReact å°†æŠŠ current å±æ€§è®¾ç½®å› null</span></span>
<span class="line"><span style="color:#6A737D">    // `current` æŒ‡å‘å·²æŒ‚è½½åˆ° DOM ä¸Šçš„æ–‡æœ¬è¾“å…¥å…ƒç´ </span></span>
<span class="line"><span style="color:#E1E4E8">    inputRef.current.</span><span style="color:#B392F0">focus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">input</span><span style="color:#B392F0"> ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{inputRef} </span><span style="color:#B392F0">type</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"text"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{onButtonClick}>Focus the input&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="ä¿å­˜å®ä¾‹å˜é‡">ä¿å­˜å®ä¾‹å˜é‡</h3>
<p><a href="https://react.docschina.org/docs/hooks-reference.html#useref"><code>useRef()</code></a> Hook ä¸ä»…å¯ä»¥ç”¨äº DOM refsã€‚æœ¬è´¨ä¸Šï¼Œ<code>useRef</code> å°±åƒæ˜¯å¯ä»¥åœ¨å…¶ <code>.current</code> å±æ€§ä¸­ä¿å­˜ä¸€ä¸ªå¯å˜å€¼çš„â€œç›’å­â€, ç±»ä¼¼äºä¸€ä¸ª class çš„å®ä¾‹å±æ€§ã€‚<code>useRef()</code> å’Œè‡ªå»ºä¸€ä¸ª <code>{current: ...}</code> å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ<code>useRef</code> ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡.</p>
<p>å½“ ref å¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>useRef</code> å¹¶<em>ä¸ä¼š</em>é€šçŸ¥ä½ ã€‚å³å˜æ›´ <code>.current</code> å±æ€§ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> TextInputWithFocusButton</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> countRes</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(countRes.current);</span></span>
<span class="line"><span style="color:#E1E4E8">        countRes.current </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> countRes.current </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#E1E4E8">      ></span></span>
<span class="line"><span style="color:#E1E4E8">        Focus the input</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      {countRes.current}</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="è·å–ä¸Šä¸€è½®çš„-props-æˆ–-state">è·å–ä¸Šä¸€è½®çš„ props æˆ– state</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> usePrevious</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> ref</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    ref.current </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> value;</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> ref.current;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> Counter</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">count</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setCount</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> prevCount</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> usePrevious</span><span style="color:#E1E4E8">(count);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        Now:</span></span>
<span class="line"><span style="color:#E1E4E8">        {count}</span></span>
<span class="line"><span style="color:#E1E4E8">        , before:</span></span>
<span class="line"><span style="color:#E1E4E8">        {prevCount}</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> setCount</span><span style="color:#E1E4E8">(count </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">)}>Add&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="å›è°ƒref">å›è°ƒRef</h3>
<p>å¦‚æœæƒ³è¦åœ¨ React ç»‘å®šæˆ–è§£ç»‘ DOM èŠ‚ç‚¹çš„ ref æ—¶è¿è¡ŒæŸäº›ä»£ç ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸­æ¥å— React ç»„ä»¶å®ä¾‹æˆ– HTML DOM å…ƒç´ ä½œä¸ºå‚æ•°,å®ƒèƒ½åŠ©ä½ æ›´ç²¾ç»†åœ°æ§åˆ¶ä½•æ—¶ refs è¢«è®¾ç½®å’Œè§£é™¤ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> TextInput</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> textInput </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">  // ä¸éœ€è¦ä½¿ç”¨useRef</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> inputRef</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">ele</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ele);</span></span>
<span class="line"><span style="color:#E1E4E8">    textInput </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ele;</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">input</span><span style="color:#B392F0"> ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{inputRef} </span><span style="color:#B392F0">type</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"text"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(textInput);</span></span>
<span class="line"><span style="color:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#E1E4E8">      ></span></span>
<span class="line"><span style="color:#E1E4E8">        Focus the input</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ä½¿ç”¨ ref å›è°ƒç®¡ç† ref åˆ—è¡¨</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> itemsRef</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> getMap</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">itemsRef.current) {</span></span>
<span class="line"><span style="color:#6A737D">    // é¦–æ¬¡è¿è¡Œæ—¶åˆå§‹åŒ– Mapã€‚</span></span>
<span class="line"><span style="color:#E1E4E8">    itemsRef.current </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> itemsRef.current;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">li</span></span>
<span class="line"><span style="color:#B392F0">    key</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{cat.id}</span></span>
<span class="line"><span style="color:#B392F0">    ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{</span><span style="color:#FFAB70">node</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> map</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> getMap</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (node) {</span></span>
<span class="line"><span style="color:#6A737D">        // Add to the Map</span></span>
<span class="line"><span style="color:#E1E4E8">        map.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(cat, node);</span></span>
<span class="line"><span style="color:#E1E4E8">      } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">        // Remove from the Map</span></span>
<span class="line"><span style="color:#E1E4E8">        map.</span><span style="color:#B392F0">delete</span><span style="color:#E1E4E8">(cat);</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    }}</span></span>
<span class="line"><span style="color:#E1E4E8">  ></span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span></code></pre>
<p>æˆ–è€…</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">li</span></span>
<span class="line"><span style="color:#B392F0">  key</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{cat.id}</span></span>
<span class="line"><span style="color:#B392F0">  ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{</span><span style="color:#FFAB70">node</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> map</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> getMap</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">    // Add to the Map</span></span>
<span class="line"><span style="color:#E1E4E8">    map.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(cat, node);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // Remove from the Map</span></span>
<span class="line"><span style="color:#E1E4E8">      map.</span><span style="color:#B392F0">delete</span><span style="color:#E1E4E8">(cat);</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">  }}</span></span>
<span class="line"><span style="color:#E1E4E8">></span></span></code></pre>
<h3 id="æ›´æ–°-state-åç«‹å³è®¿é—®-ref-dom">æ›´æ–° state åç«‹å³è®¿é—® ref Dom</h3>
<p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒDOM èŠ‚ç‚¹å°šæœªåˆ›å»ºï¼Œå› æ­¤ ref.current å°†ä¸º nullã€‚åœ¨æ¸²æŸ“æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼ŒDOM èŠ‚ç‚¹è¿˜æ²¡æœ‰æ›´æ–°ã€‚æ‰€ä»¥è¯»å–å®ƒä»¬è¿˜ä¸ºæ—¶è¿‡æ—©, è¦è§£å†³æ­¤é—®é¢˜ï¼Œä½ å¯ä»¥å¼ºåˆ¶ React åŒæ­¥æ›´æ–°ï¼ˆâ€œåˆ·æ–°â€ï¼‰DOMã€‚ ä¸ºæ­¤ï¼Œä» <code>react-dom</code> å¯¼å…¥ <code>flushSync</code> å¹¶å°† state æ›´æ–°åŒ…è£¹ åˆ° <code>flushSync</code> è°ƒç”¨ä¸­ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#6A737D">//  flushSync ä¸­çš„ä»£ç æ‰§è¡Œåï¼Œç«‹å³åŒæ­¥æ›´æ–° DOM</span></span>
<span class="line"><span style="color:#B392F0">flushSync</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  setTodos</span><span style="color:#E1E4E8">([</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">todos, newTodo]);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"><span style="color:#E1E4E8">listRef.current.lastChild.</span><span style="color:#B392F0">scrollIntoView</span><span style="color:#E1E4E8">();</span></span></code></pre>
<h3 id="è®¿é—®å¦ä¸€ä¸ªç»„ä»¶çš„-dom-èŠ‚ç‚¹">è®¿é—®å¦ä¸€ä¸ªç»„ä»¶çš„ DOM èŠ‚ç‚¹</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¸å…è®¸ç»„ä»¶è®¿é—®å…¶ä»–ç»„ä»¶çš„ DOM èŠ‚ç‚¹ã€‚ç”šè‡³è‡ªå·±çš„å­ç»„ä»¶ä¹Ÿä¸è¡Œï¼Œæƒ³è¦ æš´éœ²å…¶ DOM èŠ‚ç‚¹çš„ç»„ä»¶å¿…é¡»é€‰æ‹©è¯¥è¡Œä¸ºã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#6A737D">// MyInput ç»„ä»¶æ˜¯ä½¿ç”¨ forwardRef å£°æ˜çš„ã€‚ è¿™è®©ä»ä¸Šé¢æ¥æ”¶çš„ inputRef ä½œä¸ºç¬¬äºŒä¸ªå‚æ•° ref ä¼ å…¥ç»„ä»¶</span></span>
<span class="line"><span style="color:#6A737D">// MyInput ç»„ä»¶å°†è‡ªå·±æ¥æ”¶åˆ°çš„ ref ä¼ é€’ç»™å®ƒå†…éƒ¨çš„ &#x3C;input></span></span>
<span class="line"><span style="color:#6A737D">// useImperativeHandleå¯ä»¥é™åˆ¶æš´éœ²çš„åŠŸèƒ½</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> MyInput</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> forwardRef</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">props</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">ref</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#85E89D">input</span><span style="color:#E1E4E8"> {</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">props} </span><span style="color:#B392F0">ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{ref} />;</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">MyInput</span><span style="color:#B392F0"> ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{inputRef} />;</span></span></code></pre>
<h3 id="ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å–å†™å…¥-ref">ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å–ã€å†™å…¥ ref</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> MyComponent</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#6A737D">  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥ ref</span></span>
<span class="line"><span style="color:#E1E4E8">  myRef.current </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 123</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#6A737D">  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å– ref</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">>{myOtherRef.current}&#x3C;/</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">>;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>å¯ä»¥åœ¨ äº‹ä»¶å¤„ç†ç¨‹åºæˆ–è€… Effect ä¸­è¯»å–å’Œå†™å…¥ refã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> MyComponent</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#B392F0">  useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // âœ… å¯ä»¥åœ¨ Effect ä¸­è¯»å–å’Œå†™å…¥ ref</span></span>
<span class="line"><span style="color:#E1E4E8">    myRef.current </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 123</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#F97583">  function</span><span style="color:#B392F0"> handleClick</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // âœ… å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¯»å–å’Œå†™å…¥ ref</span></span>
<span class="line"><span style="color:#B392F0">    doSomething</span><span style="color:#E1E4E8">(myOtherRef.current);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li>React çš„æ¸²æŸ“è¿‡ç¨‹éœ€è¦æ˜¯å¯é¢„æµ‹å’Œç¡®å®šçš„ã€‚å¦‚æœåœ¨æ¸²æŸ“æœŸé—´å…è®¸è¯»å–æˆ–å†™å…¥ refï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¸²æŸ“ç»“æœçš„ä¸ç¡®å®šæ€§</li>
<li>è¯»å–æˆ–å†™å…¥ ref å¯èƒ½ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´æ— é™å¾ªç¯</li>
<li>React é€šå¸¸ä¼šå¯¹å¤šä¸ªçŠ¶æ€æ›´æ–°è¿›è¡Œæ‰¹å¤„ç†ï¼Œä»¥æé«˜æ€§èƒ½ã€‚å¦‚æœåœ¨æ¸²æŸ“æœŸé—´å…è®¸è¯»å–æˆ–å†™å…¥ refï¼Œå¯èƒ½ä¼šç ´åè¿™ç§æ‰¹å¤„ç†æœºåˆ¶ã€‚å› ä¸º ref çš„å€¼ä¸å— React çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿæ§åˆ¶ï¼Œç›´æ¥è¯»å–æˆ–å†™å…¥ ref å¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„çŠ¶æ€å’Œæ¸²æŸ“ç»“æœã€‚</li>
<li>React ä¹Ÿæ”¯æŒå¼‚æ­¥æ›´æ–°ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨ setState æˆ– useState çš„å›è°ƒå‡½æ•°ä¸­è¿›è¡ŒçŠ¶æ€æ›´æ–°æ—¶ï¼Œè¿™äº›æ›´æ–°å¯èƒ½ä¼šè¢«å»¶è¿Ÿæ‰§è¡Œã€‚å¦‚æœåœ¨æ¸²æŸ“æœŸé—´è¯»å–æˆ–å†™å…¥ refï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¼‚æ­¥æ›´æ–°çš„ä¸ä¸€è‡´æ€§</li>
<li>ä¾¿äºé”™è¯¯è¿½è¸ªå’Œè°ƒè¯•ï¼Œæ˜ç¡®é”™è¯¯æ¥æºï¼Œ</li>
</ul>
<h3 id="é¿å…é‡å¤åˆ›å»º-ref-çš„å†…å®¹">é¿å…é‡å¤åˆ›å»º ref çš„å†…å®¹</h3>
<p>React ä¼šä¿å­˜ ref åˆå§‹å€¼ï¼Œå¹¶åœ¨åç»­çš„æ¸²æŸ“ä¸­å¿½ç•¥å®ƒ, å¦‚ <code>const playerRef = useRef(new VideoPlayer())</code>ï¼Œè™½ç„¶ new VideoPlayer() çš„ç»“æœåªä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨ï¼Œä½†æ˜¯ä¾ç„¶åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> Video</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> playerRef</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å†™å…¥æˆ–è¯»å– ref.current æ˜¯ä¸å…è®¸çš„ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºç»“æœæ€»æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”æ¡ä»¶åªåœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œï¼Œæ‰€ä»¥æ˜¯å®Œå…¨å¯é¢„æµ‹çš„ã€‚</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (playerRef.current </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    playerRef.current </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> VideoPlayer</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="è‡ªå®šä¹‰ç»„ä»¶çš„-ref">è‡ªå®šä¹‰ç»„ä»¶çš„ ref</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ç»„ä»¶ä¸ä¼šæš´éœ²å®ƒä»¬å†…éƒ¨ DOM èŠ‚ç‚¹çš„ refã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#6A737D">// ä¸€ä¸ªç»„ä»¶å¯ä»¥æŒ‡å®šå°†å®ƒçš„ ref â€œè½¬å‘â€ç»™ä¸€ä¸ªå­ç»„ä»¶</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> MyInput</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> forwardRef</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">props</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">ref</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#85E89D">input</span><span style="color:#E1E4E8"> {</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">props} </span><span style="color:#B392F0">ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{ref} />;</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="useimperativehandle">useImperativeHandle</h2>
<p><code>useImperativeHandle</code> å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ <code>ref</code> æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚<code>useImperativeHandle</code> åº”å½“ä¸ <a href="https://react.docschina.org/reference/react/forwardRef"><code>forwardRef</code></a> ä¸€èµ·ä½¿ç”¨ï¼š</p>
<h3 id="å‚è€ƒ-1">å‚è€ƒ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">useImperativeHandle</span><span style="color:#E1E4E8">(ref, createHandle, dependencies</span><span style="color:#F97583">?</span><span style="color:#E1E4E8">)</span></span></code></pre>
<p>å‚æ•°</p>
<ul>
<li><code>ref</code>ï¼šè¯¥ ref æ˜¯ä½ ä» forwardRef æ¸²æŸ“å‡½æ•° ä¸­è·å¾—çš„ç¬¬äºŒä¸ªå‚æ•°</li>
<li><code>create</code>Handleï¼šè¯¥å‡½æ•°æ— éœ€å‚æ•°ï¼Œå®ƒè¿”å›ä½ æƒ³è¦æš´éœ²çš„ ref çš„å¥æŸ„ã€‚è¯¥å¥æŸ„å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹ã€‚é€šå¸¸ï¼Œä½ ä¼šè¿”å›ä¸€ä¸ªåŒ…å«ä½ æƒ³æš´éœ²çš„æ–¹æ³•çš„å¯¹è±¡</li>
<li><code>dependencies</code>ï¼šcreateHandle ä»£ç ä¸­æ‰€ç”¨åˆ°çš„æ‰€æœ‰ååº”å¼çš„å€¼çš„åˆ—è¡¨ã€‚ å¦‚æœä¸€æ¬¡é‡æ–°æ¸²æŸ“å¯¼è‡´æŸäº›ä¾èµ–é¡¹å‘ç”Ÿäº†æ”¹å˜ï¼Œæˆ–ä½ æ²¡æœ‰æä¾›è¿™ä¸ªå‚æ•°åˆ—è¡¨ï¼ŒcreateHandle å°†ä¼šè¢«é‡æ–°æ‰§è¡Œï¼Œè€Œæ–°ç”Ÿæˆçš„å¥æŸ„åˆ™ä¼šè¢«åˆ†é…ç»™ ref</li>
</ul>
<p>è¿”å›å€¼
undefined</p>
<h3 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•</h3>
<p>çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ <code>inputRef.current.focus()</code>ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#6A737D">// è¯¥æ¸²æŸ“å‡½æ•°ä¼šå°† ref ä¼ é€’ç»™ &#x3C;input ref={ref}> å…ƒç´ ã€‚</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> FancyInput</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> forwardRef</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">props</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">ref</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> inputRef</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  useImperativeHandle</span><span style="color:#E1E4E8">(ref, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#B392F0">    focus</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      inputRef.current.</span><span style="color:#B392F0">focus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }));</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#85E89D">input</span><span style="color:#B392F0"> ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{inputRef} />;</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> Wrapper</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> inputRef</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> useRef</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">  // React ä¼šå°† &#x3C;FancyButton ref={ref}> å…ƒç´ çš„ ref ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ React.forwardRef å‡½æ•°ä¸­çš„æ¸²æŸ“å‡½æ•°ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">FancyInput</span><span style="color:#B392F0"> ref</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{inputRef} /></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> inputRef.current.</span><span style="color:#B392F0">focus</span><span style="color:#E1E4E8">()}>focus&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="createhandle-æ¡ä»¶æ‰§è¡Œ">createHandle æ¡ä»¶æ‰§è¡Œ</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ç»„å»ºé‡æ–°æ¸²æŸ“å <code>useImperativeHandle</code> ä¸­çš„ <code>createHandle</code> å‡ä¼šæ‰§è¡Œï¼Œä¸ºäº†ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¾èµ–é¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">useImperativeHandle</span><span style="color:#E1E4E8">(ref, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#E1E4E8">  count,</span></span>
<span class="line"><span style="color:#B392F0">  focus</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    inputRef.current.</span><span style="color:#B392F0">focus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}), [count]);</span></span></code></pre>
<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>ä¸è¦æ»¥ç”¨ ref</strong>ã€‚ ä½ åº”å½“ä»…åœ¨ä½ æ²¡æ³•é€šè¿‡ prop æ¥è¡¨è¾¾ å‘½ä»¤å¼ è¡Œä¸ºçš„æ—¶å€™æ‰ä½¿ç”¨ refï¼šä¾‹å¦‚ï¼Œæ»šåŠ¨åˆ°æŒ‡å®šèŠ‚ç‚¹ã€èšç„¦æŸä¸ªèŠ‚ç‚¹ã€è§¦å‘ä¸€æ¬¡åŠ¨ç”»ï¼Œä»¥åŠé€‰æ‹©æ–‡æœ¬ç­‰ç­‰</li>
<li><strong>å¦‚æœå¯ä»¥é€šè¿‡ prop å®ç°ï¼Œé‚£å°±ä¸åº”è¯¥ä½¿ç”¨ ref</strong>ï¼šä½ ä¸åº”è¯¥ä»ä¸€ä¸ª Model ç»„ä»¶æš´éœ²å‡º {open, close} è¿™æ ·çš„å‘½ä»¤å¼å¥æŸ„ï¼Œæœ€å¥½æ˜¯åƒ <modal isopen="{isOpen}"> è¿™æ ·ï¼Œå°† isOpen ä½œä¸ºä¸€ä¸ª propã€‚å‰¯ä½œç”¨ å¯ä»¥å¸®ä½ é€šè¿‡ prop æ¥æš´éœ²ä¸€äº›å‘½ä»¤å¼çš„è¡Œä¸ºã€‚</modal></li>
</ul> </div> <a class="flex gap-1 my-4 text-blue-600 cursor-pointer select-none" href="https://github.com/ckvv/ckvv.github.io/tree/main/content/react/react-hooks-ref.md"> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="w-4">
  <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
  <path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z" />
</svg>
Edit this page on GitHub
</a> <script src="https://giscus.app/client.js" data-repo="ckvv/ckvv.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzODQzNjA2OTQ=" data-category="Announcements" data-category-id="DIC_kwDOFujg9s4CpN2G" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async>
</script>  </main> </body></html>