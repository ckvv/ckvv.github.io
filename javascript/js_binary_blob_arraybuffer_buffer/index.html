<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=theme-color content="#ffffff"><meta name=color-scheme content="light dark"><meta name=description content="转载自知乎-外婆的彭湖湾
 前端较少涉及对二进制数据的处理，但即便如此，我们偶尔总能在角落里看见它们的身影，今天我们就来聊一聊JS的二进制家族：Blob、ArrayBuffer和Buffer（Buffer由Node.js提供）
概述     Blob: 前端的一个专门用于支持文件操作的二进制对象 ArrayBuffer：前端的一个通用的二进制缓冲区，类似数组，但在API和特性上却有诸多不同 Buffer：Node.js提供的一个二进制缓冲区，常用来处理I/O操作  这篇文章的内容主要就聊一聊这一家子的人际关系展开。
复杂的人际关系网.jpg
下面就来一一介绍
Blob    我们首先来介绍Blob，Blob是用来支持文件操作的。简单的说：在JS中，有两个构造函数 File 和 Blob, 而File继承了所有Blob的属性。
所以在我们看来，File对象可以看作一种特殊的Blob对象。
在前端工程中，我们在哪些操作中可以获得File对象呢？ 请看：
（备注：目前 File API规范的状态为Working Draft）
我们上面说了，File对象是一种特殊的Blob对象，那么它自然就可以直接调用Blob对象的方法。让我们看一看Blob具体有哪些方法，以及能够用它们实现哪些功能
Blob实战    通过window.URL.createObjectURL方法可以把一个blob转化为一个Blob URL，并且用做文件下载或者图片显示的链接。
Blob URL所实现的下载或者显示等功能，仅仅可以在单个浏览器内部进行。而不能在服务器上进行存储，亦或者说它没有在服务器端存储的意义。
下面是一个Blob的例子，可以看到它很短
blob:d3958f5c-0777-0845-9dcf-2cb28783acaf 和冗长的Base64格式的Data URL相比，Blob URL的长度显然不能够存储足够的信息，这也就意味着它只是类似于一个浏览器内部的“引用“。从这个角度看，Blob URL是一个浏览器自行制定的一个伪协议
Blob实现下载文件
我们可以通过window.URL.createObjectURL，接收一个Blob（File）对象，将其转化为Blob URL,然后赋给 a.download属性，然后在页面上点击这个链接就可以实现下载了
<!-- html部分 --> <a id=&#34;h&#34;>点此进行下载</a> <!-- js部分 --> <script> var blob = new Blob([&#34;Hello World&#34;]); var url = window."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="js聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer"><meta name=twitter:description content="转载自知乎-外婆的彭湖湾
 前端较少涉及对二进制数据的处理，但即便如此，我们偶尔总能在角落里看见它们的身影，今天我们就来聊一聊JS的二进制家族：Blob、ArrayBuffer和Buffer（Buffer由Node.js提供）
概述     Blob: 前端的一个专门用于支持文件操作的二进制对象 ArrayBuffer：前端的一个通用的二进制缓冲区，类似数组，但在API和特性上却有诸多不同 Buffer：Node.js提供的一个二进制缓冲区，常用来处理I/O操作  这篇文章的内容主要就聊一聊这一家子的人际关系展开。
复杂的人际关系网.jpg
下面就来一一介绍
Blob    我们首先来介绍Blob，Blob是用来支持文件操作的。简单的说：在JS中，有两个构造函数 File 和 Blob, 而File继承了所有Blob的属性。
所以在我们看来，File对象可以看作一种特殊的Blob对象。
在前端工程中，我们在哪些操作中可以获得File对象呢？ 请看：
（备注：目前 File API规范的状态为Working Draft）
我们上面说了，File对象是一种特殊的Blob对象，那么它自然就可以直接调用Blob对象的方法。让我们看一看Blob具体有哪些方法，以及能够用它们实现哪些功能
Blob实战    通过window.URL.createObjectURL方法可以把一个blob转化为一个Blob URL，并且用做文件下载或者图片显示的链接。
Blob URL所实现的下载或者显示等功能，仅仅可以在单个浏览器内部进行。而不能在服务器上进行存储，亦或者说它没有在服务器端存储的意义。
下面是一个Blob的例子，可以看到它很短
blob:d3958f5c-0777-0845-9dcf-2cb28783acaf 和冗长的Base64格式的Data URL相比，Blob URL的长度显然不能够存储足够的信息，这也就意味着它只是类似于一个浏览器内部的“引用“。从这个角度看，Blob URL是一个浏览器自行制定的一个伪协议
Blob实现下载文件
我们可以通过window.URL.createObjectURL，接收一个Blob（File）对象，将其转化为Blob URL,然后赋给 a.download属性，然后在页面上点击这个链接就可以实现下载了
<!-- html部分 --> <a id=&#34;h&#34;>点此进行下载</a> <!-- js部分 --> <script> var blob = new Blob([&#34;Hello World&#34;]); var url = window."><meta property="og:title" content="js聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer"><meta property="og:description" content="转载自知乎-外婆的彭湖湾
 前端较少涉及对二进制数据的处理，但即便如此，我们偶尔总能在角落里看见它们的身影，今天我们就来聊一聊JS的二进制家族：Blob、ArrayBuffer和Buffer（Buffer由Node.js提供）
概述     Blob: 前端的一个专门用于支持文件操作的二进制对象 ArrayBuffer：前端的一个通用的二进制缓冲区，类似数组，但在API和特性上却有诸多不同 Buffer：Node.js提供的一个二进制缓冲区，常用来处理I/O操作  这篇文章的内容主要就聊一聊这一家子的人际关系展开。
复杂的人际关系网.jpg
下面就来一一介绍
Blob    我们首先来介绍Blob，Blob是用来支持文件操作的。简单的说：在JS中，有两个构造函数 File 和 Blob, 而File继承了所有Blob的属性。
所以在我们看来，File对象可以看作一种特殊的Blob对象。
在前端工程中，我们在哪些操作中可以获得File对象呢？ 请看：
（备注：目前 File API规范的状态为Working Draft）
我们上面说了，File对象是一种特殊的Blob对象，那么它自然就可以直接调用Blob对象的方法。让我们看一看Blob具体有哪些方法，以及能够用它们实现哪些功能
Blob实战    通过window.URL.createObjectURL方法可以把一个blob转化为一个Blob URL，并且用做文件下载或者图片显示的链接。
Blob URL所实现的下载或者显示等功能，仅仅可以在单个浏览器内部进行。而不能在服务器上进行存储，亦或者说它没有在服务器端存储的意义。
下面是一个Blob的例子，可以看到它很短
blob:d3958f5c-0777-0845-9dcf-2cb28783acaf 和冗长的Base64格式的Data URL相比，Blob URL的长度显然不能够存储足够的信息，这也就意味着它只是类似于一个浏览器内部的“引用“。从这个角度看，Blob URL是一个浏览器自行制定的一个伪协议
Blob实现下载文件
我们可以通过window.URL.createObjectURL，接收一个Blob（File）对象，将其转化为Blob URL,然后赋给 a.download属性，然后在页面上点击这个链接就可以实现下载了
<!-- html部分 --> <a id=&#34;h&#34;>点此进行下载</a> <!-- js部分 --> <script> var blob = new Blob([&#34;Hello World&#34;]); var url = window."><meta property="og:type" content="article"><meta property="og:url" content="https://chenkai.life/javascript/js_binary_blob_arraybuffer_buffer/"><meta property="article:published_time" content="2021-07-09T15:37:56+08:00"><meta property="article:modified_time" content="2021-07-09T15:37:56+08:00"><title>js聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer · CK's Blog</title><link rel=canonical href=https://chenkai.life/javascript/js_binary_blob_arraybuffer_buffer/><link rel=stylesheet href=/css/coder.min.0e0f0ac9929898ae6625ca3789e3f9e2e630ead0a5e0f1fe96c1ba7d8774342c.css integrity="sha256-Dg8KyZKYmK5mJco3ieP54uYw6tCl4PH+lsG6fYd0NCw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.d8f89ef09509afb63b9b2595ee174e53cc51ce02a6f6a2179e1621f9389e4340.css integrity="sha256-2Pie8JUJr7Y7myWV7hdOU8xRzgKm9qIXnhYh+TieQ0A=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/custom.min.3f4eb8f4d446f83e5e55736560804f3204a00aa63779a50573c6f989f30989c8.css integrity="sha256-P0649NRG+D5eVXNlYIBPMgSgCqY3eaUFc8b5ifMJicg=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/favicon.ico><link rel=apple-touch-icon type=image/png sizes=256x256 href=/images/favicon-512x512.png><meta name=generator content="Hugo 0.72.0"><link rel=manifest href=/manifest.webmanifest></head><body class="preload-transitions colorscheme-auto"><div class=float-container><span id=dark-mode-toggle class=colorscheme-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-anheimoshi"/></svg></span></div><details id=table-of-contents-wapper><summary><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></summary><nav id=TableOfContents><ul><li><ul><li><a href=#概述><strong>概述</strong></a></li><li><a href=#blob><strong>Blob</strong></a></li><li><a href=#blob实战><strong>Blob实战</strong></a></li><li><a href=#arraybuffer><strong>ArrayBuffer</strong></a></li><li><a href=#arraybuffer实战>ArrayBuffer实战</a></li><li><a href=#buffer><strong>Buffer</strong></a></li><li><a href=#buffer实战>Buffer实战</a></li></ul></li></ul></nav></details><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>CK's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidan"/></svg></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/>Home</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/index.xml>RSS</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item id=search-content><input class=search-int type=text placeholder=Search>
<button class=search-btn data-type=github>GitHub</button>
<button class=search-btn data-type=google>Google</button></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://chenkai.life/javascript/js_binary_blob_arraybuffer_buffer/>js聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer</a></h1><div class=edit-link style=float:right;color:#0366d6><a class=title rel=noopener target=_blank href=https://github.com/chenkai0520/chenkai0520.github.io/edit/main/content/javascript/js_binary_Blob_ArrayBuffer_Buffer.md>编辑</a></div></header><div class=post-meta><div class=date><span class=posted-on><svg class="icon" aria-hidden="true"><use xlink:href="#icon-date"/></svg><time datetime=2021-07-09T15:37:56+08:00>2021-07-09</time></span></div><div class=tags><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian"/></svg><span class=tag><a href=/tags/js/>js</a></span></div></div><blockquote><p>转载自<a href=https://zhuanlan.zhihu.com/p/97768916>知乎-外婆的彭湖湾</a></p></blockquote><p>前端较少涉及对二进制数据的处理，但即便如此，我们偶尔总能在角落里看见它们的身影，今天我们就来聊一聊JS的二进制家族：Blob、ArrayBuffer和Buffer（Buffer由Node.js提供）</p><h2 id=概述><strong>概述</strong>
<a class=heading-link href=#%e6%a6%82%e8%bf%b0><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li><strong>Blob</strong>: 前端的一个专门用于支持文件操作的二进制对象</li><li><strong>ArrayBuffer</strong>：前端的一个通用的二进制缓冲区，类似数组，但在API和特性上却有诸多不同</li><li><strong>Buffer</strong>：Node.js提供的一个二进制缓冲区，常用来处理I/O操作</li></ul><p>这篇文章的内容主要就聊一聊这一家子的人际关系展开。</p><p><strong>复杂的人际关系网.jpg</strong></p><p><img src=https://pic2.zhimg.com/80/v2-ed143b043805e01fbbea5712c7e27789_1440w.jpg alt=img></p><p><strong>下面就来一一介绍</strong></p><h2 id=blob><strong>Blob</strong>
<a class=heading-link href=#blob><i class="fa fa-link" aria-hidden=true></i></a></h2><p>我们首先来介绍Blob，Blob是用来支持文件操作的。简单的说：在JS中，有两个构造函数 File 和 Blob, 而File继承了所有Blob的属性。</p><p>所以在我们看来，File对象可以看作一种特殊的Blob对象。</p><p>在前端工程中，我们在哪些操作中可以获得File对象呢？ 请看：</p><p><img src=https://pic1.zhimg.com/80/v2-e2c5fe863033cf886b841e44cee5b1ac_1440w.jpg alt=img></p><p>（备注：目前 File API规范的状态为Working Draft）</p><p>我们上面说了，File对象是一种特殊的Blob对象，那么它自然就可以直接调用Blob对象的方法。让我们看一看Blob具体有哪些方法，以及能够用它们实现哪些功能</p><p><img src=https://pic4.zhimg.com/80/v2-c2d271a9ab14c9c0803884a7877f3b4b_1440w.jpg alt=img></p><h2 id=blob实战><strong>Blob实战</strong>
<a class=heading-link href=#blob%e5%ae%9e%e6%88%98><i class="fa fa-link" aria-hidden=true></i></a></h2><p>通过window.URL.createObjectURL方法可以把一个blob转化为一个Blob URL，并且用做文件下载或者图片显示的链接。</p><p>Blob URL所实现的下载或者显示等功能，仅仅可以在单个浏览器内部进行。而不能在服务器上进行存储，亦或者说它没有在服务器端存储的意义。</p><p>下面是一个Blob的例子，可以看到它很短</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>blob:d3958f5c-0777-0845-9dcf-2cb28783acaf
</code></pre></div><p>和冗长的Base64格式的Data URL相比，Blob URL的长度显然不能够存储足够的信息，这也就意味着它只是类似于一个浏览器内部的“引用“。从这个角度看，Blob URL是一个浏览器自行制定的一个伪协议</p><p><strong>Blob实现下载文件</strong></p><p>我们可以通过window.URL.createObjectURL，接收一个Blob（File）对象，将其转化为Blob URL,然后赋给 a.download属性，然后在页面上点击这个链接就可以实现下载了</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- html部分 --&gt;</span>
&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;h&#34;</span>&gt;点此进行下载&lt;/<span style=color:#f92672>a</span>&gt;
<span style=color:#75715e>&lt;!-- js部分 --&gt;</span>
&lt;<span style=color:#f92672>script</span>&gt;
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>blob</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Blob</span>([<span style=color:#e6db74>&#34;Hello World&#34;</span>]);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>createObjectURL</span>(<span style=color:#a6e22e>blob</span>);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;h&#34;</span>);
  <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>download</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;helloworld.txt&#34;</span>;
  <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>;
&lt;/<span style=color:#f92672>script</span>&gt; 
</code></pre></div><p>(备注：download属性不兼容IE, 对IE可通过window.navigator.msSaveBlob方法或其他进行优化)</p><p><strong>运行结果</strong></p><p><img src=https://pic2.zhimg.com/80/v2-d7f55a0672650d794aadde67654839dd_1440w.jpg alt=img></p><p><strong>Blob实现图片本地显示</strong></p><p>window.URL.createObjectURL生成的Blob URL还可以赋给img.src，从而实现图片的显示</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- html部分 --&gt;</span>
&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;file&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;f&#39;</span> /&gt;
&lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;img&#39;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width: 200px;height:200px;&#34;</span> /&gt;
<span style=color:#75715e>&lt;!-- js部分 --&gt;</span>
&lt;<span style=color:#f92672>script</span>&gt;
  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;f&#39;</span>).<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;change&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>files</span>[<span style=color:#ae81ff>0</span>];
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;img&#39;</span>);
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>createObjectURL</span>(<span style=color:#a6e22e>file</span>);
    <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>;
    <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
        <span style=color:#75715e>// 释放一个之前通过调用 URL.createObjectURL创建的 URL 对象
</span><span style=color:#75715e></span>        window.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>revokeObjectURL</span>(<span style=color:#a6e22e>url</span>);
    }
  }, <span style=color:#66d9ef>false</span>);
&lt;/<span style=color:#f92672>script</span>&gt;
</code></pre></div><p><strong>运行结果</strong></p><p><img src=https://pic2.zhimg.com/80/v2-f32a444dba17ae1da39a2ffb6a600205_1440w.jpg alt=img></p><p><strong>Blob实现文件分片上传</strong></p><ul><li>通过Blob.slice(start,end)可以分割大Blob为多个小Blob</li><li>xhr.send是可以直接发送Blob对象的</li></ul><p>前端</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- html部分 --&gt;</span>
&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;file&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;f&#39;</span> /&gt;
<span style=color:#75715e>&lt;!-- js部分 --&gt;</span>
&lt;<span style=color:#f92672>script</span>&gt;
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>upload</span>(<span style=color:#a6e22e>blob</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>xhr</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>XMLHttpRequest</span>();
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>open</span>(<span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#e6db74>&#39;/ajax&#39;</span>, <span style=color:#66d9ef>true</span>);
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>setRequestHeader</span>(<span style=color:#e6db74>&#39;Content-Type&#39;</span>, <span style=color:#e6db74>&#39;text/plain&#39;</span>)
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>blob</span>);
}

document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;f&#39;</span>).<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;change&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>blob</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>files</span>[<span style=color:#ae81ff>0</span>];
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CHUNK_SIZE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>; .
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SIZE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>blob</span>.<span style=color:#a6e22e>size</span>;
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>CHUNK_SIZE</span>;
    <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>start</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>SIZE</span>) {
        <span style=color:#a6e22e>upload</span>(<span style=color:#a6e22e>blob</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>end</span>));
        <span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>end</span>;
        <span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>start</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>CHUNK_SIZE</span>;
    }
}, <span style=color:#66d9ef>false</span>);
&lt;/<span style=color:#f92672>script</span>&gt;
</code></pre></div><p>Node端(Koa)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>async</span> (<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>next</span>) =&gt; {
    <span style=color:#a6e22e>await</span> <span style=color:#a6e22e>next</span>();
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>path</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;/ajax&#39;</span>) {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>req</span>;
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>await</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>req</span>);
        <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>;
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>body</span>);
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;---------------&#39;</span>);
    }
});
</code></pre></div><p><strong>文件内容</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>According to the Zhanjiang commerce bureau, the actual amount of foreign capital 
utilized in Zhanjiang from January to October this year was
</code></pre></div><p><strong>运行结果</strong></p><p><img src=https://pic2.zhimg.com/80/v2-c71d6f70afd5281d6a72ae4c00c1c5c1_1440w.jpg alt=img></p><p><strong>本地读取文件内容</strong></p><p>如果想要读取Blob或者文件对象并转化为其他格式的数据，可以借助FileReader对象的API进行操作</p><ul><li><strong>FileReader.readAsText(Blob)</strong>：将Blob转化为文本字符串</li><li><strong>FileReader.readAsArrayBuffer(Blob)</strong>： 将Blob转为ArrayBuffer格式数据</li><li><strong>FileReader.readAsDataURL()</strong>: 将Blob转化为Base64格式的Data URL</li></ul><p>下面我们尝试把一个文件的内容通过字符串的方式读取出来</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;file&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;f&#39;</span> /&gt;
&lt;<span style=color:#f92672>script</span>&gt;
  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;f&#39;</span>).<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;change&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>files</span>[<span style=color:#ae81ff>0</span>];
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>reader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FileReader</span>();
    <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>result</span>;
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>content</span>);
    }
    <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>readAsText</span>(<span style=color:#a6e22e>file</span>);
  }, <span style=color:#66d9ef>false</span>);
&lt;/<span style=color:#f92672>script</span>&gt;
</code></pre></div><p><strong>运行结果</strong></p><p><img src=https://pic2.zhimg.com/80/v2-ae3abdb43d38fa1c00c74bccc05ebe6d_1440w.jpg alt=img></p><p>上面介绍了Blob的用法，我们不难发现，Blob是针对文件的，或者可以说它就是一个文件对象，同时呢我们发现Blob欠缺对二进制数据的细节操作能力，比如如果如果要具体修改某一部分的二进制数据，Blob显然就不够用了，而这种细粒度的功能则可以由下面介绍的ArrayBuffer来完成。</p><h2 id=arraybuffer><strong>ArrayBuffer</strong>
<a class=heading-link href=#arraybuffer><i class="fa fa-link" aria-hidden=true></i></a></h2><p>让我们用一张图看下ArrayBuffer的大体的功能</p><p><img src=https://pic3.zhimg.com/80/v2-049e1458ef1f93fc5fe9e84c04eb6186_1440w.jpg alt=img></p><p>同时要说明，ArrayBuffer跟JS的原生数组有很大的区别，如图所示</p><p><img src=https://pic1.zhimg.com/80/v2-d10e0403bc9c226254414d76dd03c218_1440w.jpg alt=img></p><p>下面一一进行细节的介绍</p><h2 id=arraybuffer实战>ArrayBuffer实战
<a class=heading-link href=#arraybuffer%e5%ae%9e%e6%88%98><i class="fa fa-link" aria-hidden=true></i></a></h2><p><strong>通过ArrayBuffer的格式读取本地数据</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;f&#39;</span>).<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;change&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>files</span>[<span style=color:#ae81ff>0</span>];
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fileReader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FileReader</span>();
  <span style=color:#a6e22e>fileReader</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fileReader</span>.<span style=color:#a6e22e>result</span>;
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>)
  }
  <span style=color:#a6e22e>fileReader</span>.<span style=color:#a6e22e>readAsArrayBuffer</span>(<span style=color:#a6e22e>file</span>);
}, <span style=color:#66d9ef>false</span>);
</code></pre></div><p>运行结果</p><p><img src=https://pic2.zhimg.com/80/v2-ba295128148f636fa1dd4fa6fe190c21_1440w.jpg alt=img></p><p><strong>通过ArrayBuffer的格式读取Ajax请求数据</strong></p><ul><li>通过xhr.responseType = &ldquo;arraybuffer&rdquo; 指定响应的数据类型</li><li>在onload回调里打印xhr.response</li></ul><p><strong>前端</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>xhr</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>XMLHttpRequest</span>();
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>open</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;ajax&#34;</span>, <span style=color:#66d9ef>true</span>);
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>responseType</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arraybuffer&#34;</span>;
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>response</span>)
}
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>send</span>();
</code></pre></div><p><strong>Node端</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Koa</span>();
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>async</span> (<span style=color:#a6e22e>ctx</span>) =&gt; {
  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/ajax&#39;</span>) {
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hello world&#39;</span>;
    <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>;
  }
}).<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>3000</span>)
</code></pre></div><p><strong>运行结果</strong></p><p><img src=https://pic1.zhimg.com/80/v2-d2251b3fd8ca016fd810cae76fba9b10_1440w.jpg alt=img></p><p><strong>通过TypeArray对ArrayBuffer进行写操作</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>typedArray1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Int8Array</span>(<span style=color:#ae81ff>8</span>);
<span style=color:#a6e22e>typedArray1</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>typedArray2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Int8Array</span>(<span style=color:#a6e22e>typedArray1</span>);
<span style=color:#a6e22e>typedArray2</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>42</span>;

<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>typedArray1</span>);
<span style=color:#75715e>//  output: Int8Array [32, 0, 0, 0, 0, 0, 0, 0]
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>typedArray2</span>);
<span style=color:#75715e>//  output: Int8Array [32, 42, 0, 0, 0, 0, 0, 0]
</span></code></pre></div><p><strong>通过DataView对ArrayBuffer进行写操作</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ArrayBuffer</span>(<span style=color:#ae81ff>16</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>view</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DataView</span>(<span style=color:#a6e22e>buffer</span>);
<span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setInt8</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>42</span>);
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>getInt8</span>(<span style=color:#ae81ff>2</span>));
<span style=color:#75715e>// 输出: 42
</span></code></pre></div><h2 id=buffer><strong>Buffer</strong>
<a class=heading-link href=#buffer><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Buffer是Node.js提供的对象，前端没有。 它一般应用于IO操作，例如接收前端请求数据时候，可以通过以下的Buffer的API对接收到的前端数据进行整合</p><p><img src=https://pic1.zhimg.com/80/v2-93aae2f807bf379e2749db194047ada4_1440w.jpg alt=img></p><h2 id=buffer实战>Buffer实战
<a class=heading-link href=#buffer%e5%ae%9e%e6%88%98><i class="fa fa-link" aria-hidden=true></i></a></h2><p><strong>例子如下</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// Node端（Koa）
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Koa</span>();
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>async</span> (<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>next</span>) =&gt; {
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>path</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;/ajax&#39;</span>) {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>chunks</span> <span style=color:#f92672>=</span> [];
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>req</span>;
        <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, <span style=color:#a6e22e>buf</span> =&gt; {
            <span style=color:#a6e22e>chunks</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>buf</span>);
        })
        <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;end&#39;</span>, () =&gt; {
            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>chunks</span>);
            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>toString</span>())
        })
    }
});
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>3000</span>)

<span style=color:#75715e>// 前端
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>xhr</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>XMLHttpRequest</span>();
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>open</span>(<span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;ajax&#34;</span>, <span style=color:#66d9ef>true</span>);
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>setRequestHeader</span>(<span style=color:#e6db74>&#39;Content-Type&#39;</span>, <span style=color:#e6db74>&#39;text/plain&#39;</span>)
<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>send</span>(<span style=color:#e6db74>&#34;asdasdsadfsdfsadasdas&#34;</span>);
</code></pre></div><p><strong>运行结果</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>// Node端输出
asdasdsadfsdfsadasdas
</code></pre></div><div id=cusdis_thread data-host=https://cusdis.com data-app-id=c2b015f9-9a4b-4997-b66f-f9c6ca26ebdd data-page-id=e4a554dab7e3293d2d1812301e5155f6 data-page-url=https://chenkai.life/javascript/js_binary_blob_arraybuffer_buffer/ data-page-title=js聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer data-iframe=/js/cusdis/iframe.umd.js data-style=/js/cusdis/style.css></div></article></section></div></main><script src=/js/coder.min.a350362441276ec5c1671926420497bb8e52b63ead1d51d3c9bc4342d0039526.js integrity="sha256-o1A2JEEnbsXBZxkmQgSXu45Stj6tHVHTybxDQtADlSY="></script><script src=/js/custom.js></script><script src=/js/font.min.js></script></body><script>if('serviceWorker'in navigator){navigator.serviceWorker.register('/service-worker.js');}</script></html>